(()=>{var t={6454(t,e,n){"use strict";const i=n(3918),r=n(2923),s=n(8904);t.exports={XMLParser:r,XMLValidator:i,XMLBuilder:s}},3085(t){t.exports=function(t){return"function"==typeof t?t:Array.isArray(t)?e=>{for(const n of t){if("string"==typeof n&&e===n)return!0;if(n instanceof RegExp&&n.test(e))return!0}}:()=>!1}},5334(t,e){"use strict";const n=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",i="["+n+"]["+n+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*",r=new RegExp("^"+i+"$");e.isExist=function(t){return void 0!==t},e.isEmptyObject=function(t){return 0===Object.keys(t).length},e.merge=function(t,e,n){if(e){const i=Object.keys(e),r=i.length;for(let s=0;s<r;s++)t[i[s]]="strict"===n?[e[i[s]]]:e[i[s]]}},e.getValue=function(t){return e.isExist(t)?t:""},e.isName=function(t){return!(null==r.exec(t))},e.getAllMatches=function(t,e){const n=[];let i=e.exec(t);for(;i;){const r=[];r.startIndex=e.lastIndex-i[0].length;const s=i.length;for(let t=0;t<s;t++)r.push(i[t]);n.push(r),i=e.exec(t)}return n},e.nameRegexp=i},3918(t,e,n){"use strict";const i=n(5334),r={allowBooleanAttributes:!1,unpairedTags:[]};function s(t){return" "===t||"\t"===t||"\n"===t||"\r"===t}function a(t,e){const n=e;for(;e<t.length;e++)if("?"==t[e]||" "==t[e]){const i=t.substr(n,e-n);if(e>5&&"xml"===i)return d("InvalidXml","XML declaration allowed only at the start of the document.",p(t,e));if("?"==t[e]&&">"==t[e+1]){e++;break}continue}return e}function o(t,e){if(t.length>e+5&&"-"===t[e+1]&&"-"===t[e+2]){for(e+=3;e<t.length;e++)if("-"===t[e]&&"-"===t[e+1]&&">"===t[e+2]){e+=2;break}}else if(t.length>e+8&&"D"===t[e+1]&&"O"===t[e+2]&&"C"===t[e+3]&&"T"===t[e+4]&&"Y"===t[e+5]&&"P"===t[e+6]&&"E"===t[e+7]){let n=1;for(e+=8;e<t.length;e++)if("<"===t[e])n++;else if(">"===t[e]&&(n--,0===n))break}else if(t.length>e+9&&"["===t[e+1]&&"C"===t[e+2]&&"D"===t[e+3]&&"A"===t[e+4]&&"T"===t[e+5]&&"A"===t[e+6]&&"["===t[e+7])for(e+=8;e<t.length;e++)if("]"===t[e]&&"]"===t[e+1]&&">"===t[e+2]){e+=2;break}return e}function l(t,e){let n="",i="",r=!1;for(;e<t.length;e++){if('"'===t[e]||"'"===t[e])""===i?i=t[e]:i!==t[e]||(i="");else if(">"===t[e]&&""===i){r=!0;break}n+=t[e]}return""===i&&{value:n,index:e,tagClosed:r}}e.validate=function(t,e){e=Object.assign({},r,e);const n=[];let i=!1,c=!1;"\ufeff"===t[0]&&(t=t.substr(1));for(let r=0;r<t.length;r++)if("<"===t[r]&&"?"===t[r+1]){if(r+=2,r=a(t,r),r.err)return r}else{if("<"!==t[r]){if(s(t[r]))continue;return d("InvalidChar","char '"+t[r]+"' is not expected.",p(t,r))}{let f=r;if(r++,"!"===t[r]){r=o(t,r);continue}{let g=!1;"/"===t[r]&&(g=!0,r++);let b="";for(;r<t.length&&">"!==t[r]&&" "!==t[r]&&"\t"!==t[r]&&"\n"!==t[r]&&"\r"!==t[r];r++)b+=t[r];if(b=b.trim(),"/"===b[b.length-1]&&(b=b.substring(0,b.length-1),r--),!m(b)){let e;return e=0===b.trim().length?"Invalid space after '<'.":"Tag '"+b+"' is an invalid name.",d("InvalidTag",e,p(t,r))}const E=l(t,r);if(!1===E)return d("InvalidAttr","Attributes for '"+b+"' have open quote.",p(t,r));let y=E.value;if(r=E.index,"/"===y[y.length-1]){const n=r-y.length;y=y.substring(0,y.length-1);const s=h(y,e);if(!0!==s)return d(s.err.code,s.err.msg,p(t,n+s.err.line));i=!0}else if(g){if(!E.tagClosed)return d("InvalidTag","Closing tag '"+b+"' doesn't have proper closing.",p(t,r));if(y.trim().length>0)return d("InvalidTag","Closing tag '"+b+"' can't have attributes or invalid starting.",p(t,f));if(0===n.length)return d("InvalidTag","Closing tag '"+b+"' has not been opened.",p(t,f));{const e=n.pop();if(b!==e.tagName){let n=p(t,e.tagStartPos);return d("InvalidTag","Expected closing tag '"+e.tagName+"' (opened in line "+n.line+", col "+n.col+") instead of closing tag '"+b+"'.",p(t,f))}0==n.length&&(c=!0)}}else{const s=h(y,e);if(!0!==s)return d(s.err.code,s.err.msg,p(t,r-y.length+s.err.line));if(!0===c)return d("InvalidXml","Multiple possible root nodes found.",p(t,r));-1!==e.unpairedTags.indexOf(b)||n.push({tagName:b,tagStartPos:f}),i=!0}for(r++;r<t.length;r++)if("<"===t[r]){if("!"===t[r+1]){r++,r=o(t,r);continue}if("?"!==t[r+1])break;if(r=a(t,++r),r.err)return r}else if("&"===t[r]){const e=u(t,r);if(-1==e)return d("InvalidChar","char '&' is not expected.",p(t,r));r=e}else if(!0===c&&!s(t[r]))return d("InvalidXml","Extra text at the end",p(t,r));"<"===t[r]&&r--}}}return i?1==n.length?d("InvalidTag","Unclosed tag '"+n[0].tagName+"'.",p(t,n[0].tagStartPos)):!(n.length>0)||d("InvalidXml","Invalid '"+JSON.stringify(n.map(t=>t.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):d("InvalidXml","Start tag expected.",1)};const c=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function h(t,e){const n=i.getAllMatches(t,c),r={};for(let t=0;t<n.length;t++){if(0===n[t][1].length)return d("InvalidAttr","Attribute '"+n[t][2]+"' has no space in starting.",g(n[t]));if(void 0!==n[t][3]&&void 0===n[t][4])return d("InvalidAttr","Attribute '"+n[t][2]+"' is without value.",g(n[t]));if(void 0===n[t][3]&&!e.allowBooleanAttributes)return d("InvalidAttr","boolean attribute '"+n[t][2]+"' is not allowed.",g(n[t]));const i=n[t][2];if(!f(i))return d("InvalidAttr","Attribute '"+i+"' is an invalid name.",g(n[t]));if(r.hasOwnProperty(i))return d("InvalidAttr","Attribute '"+i+"' is repeated.",g(n[t]));r[i]=1}return!0}function u(t,e){if(";"===t[++e])return-1;if("#"===t[e])return function(t,e){let n=/\d/;for("x"===t[e]&&(e++,n=/[\da-fA-F]/);e<t.length;e++){if(";"===t[e])return e;if(!t[e].match(n))break}return-1}(t,++e);let n=0;for(;e<t.length;e++,n++)if(!(t[e].match(/\w/)&&n<20)){if(";"===t[e])break;return-1}return e}function d(t,e,n){return{err:{code:t,msg:e,line:n.line||n,col:n.col}}}function f(t){return i.isName(t)}function m(t){return i.isName(t)}function p(t,e){const n=t.substring(0,e).split(/\r?\n/);return{line:n.length,col:n[n.length-1].length+1}}function g(t){return t.startIndex+t[1].length}},8904(t,e,n){"use strict";const i=n(2788),r=n(3085),s={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(t,e){return e},attributeValueProcessor:function(t,e){return e},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function a(t){this.options=Object.assign({},s,t),!0===this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=r(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=c),this.processTextOrObjNode=o,this.options.format?(this.indentate=l,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}function o(t,e,n,i){const r=this.j2x(t,n+1,i.concat(e));return void 0!==t[this.options.textNodeName]&&1===Object.keys(t).length?this.buildTextValNode(t[this.options.textNodeName],e,r.attrStr,n):this.buildObjectNode(r.val,e,r.attrStr,n)}function l(t){return this.options.indentBy.repeat(t)}function c(t){return!(!t.startsWith(this.options.attributeNamePrefix)||t===this.options.textNodeName)&&t.substr(this.attrPrefixLen)}a.prototype.build=function(t){return this.options.preserveOrder?i(t,this.options):(Array.isArray(t)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(t={[this.options.arrayNodeName]:t}),this.j2x(t,0,[]).val)},a.prototype.j2x=function(t,e,n){let i="",r="";const s=n.join(".");for(let a in t)if(Object.prototype.hasOwnProperty.call(t,a))if(void 0===t[a])this.isAttribute(a)&&(r+="");else if(null===t[a])this.isAttribute(a)||a===this.options.cdataPropName?r+="":"?"===a[0]?r+=this.indentate(e)+"<"+a+"?"+this.tagEndChar:r+=this.indentate(e)+"<"+a+"/"+this.tagEndChar;else if(t[a]instanceof Date)r+=this.buildTextValNode(t[a],a,"",e);else if("object"!=typeof t[a]){const n=this.isAttribute(a);if(n&&!this.ignoreAttributesFn(n,s))i+=this.buildAttrPairStr(n,""+t[a]);else if(!n)if(a===this.options.textNodeName){let e=this.options.tagValueProcessor(a,""+t[a]);r+=this.replaceEntitiesValue(e)}else r+=this.buildTextValNode(t[a],a,"",e)}else if(Array.isArray(t[a])){const i=t[a].length;let s="",o="";for(let l=0;l<i;l++){const i=t[a][l];if(void 0===i);else if(null===i)"?"===a[0]?r+=this.indentate(e)+"<"+a+"?"+this.tagEndChar:r+=this.indentate(e)+"<"+a+"/"+this.tagEndChar;else if("object"==typeof i)if(this.options.oneListGroup){const t=this.j2x(i,e+1,n.concat(a));s+=t.val,this.options.attributesGroupName&&i.hasOwnProperty(this.options.attributesGroupName)&&(o+=t.attrStr)}else s+=this.processTextOrObjNode(i,a,e,n);else if(this.options.oneListGroup){let t=this.options.tagValueProcessor(a,i);t=this.replaceEntitiesValue(t),s+=t}else s+=this.buildTextValNode(i,a,"",e)}this.options.oneListGroup&&(s=this.buildObjectNode(s,a,o,e)),r+=s}else if(this.options.attributesGroupName&&a===this.options.attributesGroupName){const e=Object.keys(t[a]),n=e.length;for(let r=0;r<n;r++)i+=this.buildAttrPairStr(e[r],""+t[a][e[r]])}else r+=this.processTextOrObjNode(t[a],a,e,n);return{attrStr:i,val:r}},a.prototype.buildAttrPairStr=function(t,e){return e=this.options.attributeValueProcessor(t,""+e),e=this.replaceEntitiesValue(e),this.options.suppressBooleanAttributes&&"true"===e?" "+t:" "+t+'="'+e+'"'},a.prototype.buildObjectNode=function(t,e,n,i){if(""===t)return"?"===e[0]?this.indentate(i)+"<"+e+n+"?"+this.tagEndChar:this.indentate(i)+"<"+e+n+this.closeTag(e)+this.tagEndChar;{let r="</"+e+this.tagEndChar,s="";return"?"===e[0]&&(s="?",r=""),!n&&""!==n||-1!==t.indexOf("<")?!1!==this.options.commentPropName&&e===this.options.commentPropName&&0===s.length?this.indentate(i)+`\x3c!--${t}--\x3e`+this.newLine:this.indentate(i)+"<"+e+n+s+this.tagEndChar+t+this.indentate(i)+r:this.indentate(i)+"<"+e+n+s+">"+t+r}},a.prototype.closeTag=function(t){let e="";return-1!==this.options.unpairedTags.indexOf(t)?this.options.suppressUnpairedNode||(e="/"):e=this.options.suppressEmptyNode?"/":`></${t}`,e},a.prototype.buildTextValNode=function(t,e,n,i){if(!1!==this.options.cdataPropName&&e===this.options.cdataPropName)return this.indentate(i)+`<![CDATA[${t}]]>`+this.newLine;if(!1!==this.options.commentPropName&&e===this.options.commentPropName)return this.indentate(i)+`\x3c!--${t}--\x3e`+this.newLine;if("?"===e[0])return this.indentate(i)+"<"+e+n+"?"+this.tagEndChar;{let r=this.options.tagValueProcessor(e,t);return r=this.replaceEntitiesValue(r),""===r?this.indentate(i)+"<"+e+n+this.closeTag(e)+this.tagEndChar:this.indentate(i)+"<"+e+n+">"+r+"</"+e+this.tagEndChar}},a.prototype.replaceEntitiesValue=function(t){if(t&&t.length>0&&this.options.processEntities)for(let e=0;e<this.options.entities.length;e++){const n=this.options.entities[e];t=t.replace(n.regex,n.val)}return t},t.exports=a},2788(t){function e(t,a,o,l){let c="",h=!1;for(let u=0;u<t.length;u++){const d=t[u],f=n(d);if(void 0===f)continue;let m="";if(m=0===o.length?f:`${o}.${f}`,f===a.textNodeName){let t=d[f];r(m,a)||(t=a.tagValueProcessor(f,t),t=s(t,a)),h&&(c+=l),c+=t,h=!1;continue}if(f===a.cdataPropName){h&&(c+=l),c+=`<![CDATA[${d[f][0][a.textNodeName]}]]>`,h=!1;continue}if(f===a.commentPropName){c+=l+`\x3c!--${d[f][0][a.textNodeName]}--\x3e`,h=!0;continue}if("?"===f[0]){const t=i(d[":@"],a),e="?xml"===f?"":l;let n=d[f][0][a.textNodeName];n=0!==n.length?" "+n:"",c+=e+`<${f}${n}${t}?>`,h=!0;continue}let p=l;""!==p&&(p+=a.indentBy);const g=l+`<${f}${i(d[":@"],a)}`,b=e(d[f],a,m,p);-1!==a.unpairedTags.indexOf(f)?a.suppressUnpairedNode?c+=g+">":c+=g+"/>":b&&0!==b.length||!a.suppressEmptyNode?b&&b.endsWith(">")?c+=g+`>${b}${l}</${f}>`:(c+=g+">",b&&""!==l&&(b.includes("/>")||b.includes("</"))?c+=l+a.indentBy+b+l:c+=b,c+=`</${f}>`):c+=g+"/>",h=!0}return c}function n(t){const e=Object.keys(t);for(let n=0;n<e.length;n++){const i=e[n];if(t.hasOwnProperty(i)&&":@"!==i)return i}}function i(t,e){let n="";if(t&&!e.ignoreAttributes)for(let i in t){if(!t.hasOwnProperty(i))continue;let r=e.attributeValueProcessor(i,t[i]);r=s(r,e),!0===r&&e.suppressBooleanAttributes?n+=` ${i.substr(e.attributeNamePrefix.length)}`:n+=` ${i.substr(e.attributeNamePrefix.length)}="${r}"`}return n}function r(t,e){let n=(t=t.substr(0,t.length-e.textNodeName.length-1)).substr(t.lastIndexOf(".")+1);for(let i in e.stopNodes)if(e.stopNodes[i]===t||e.stopNodes[i]==="*."+n)return!0;return!1}function s(t,e){if(t&&t.length>0&&e.processEntities)for(let n=0;n<e.entities.length;n++){const i=e.entities[n];t=t.replace(i.regex,i.val)}return t}t.exports=function(t,n){let i="";return n.format&&n.indentBy.length>0&&(i="\n"),e(t,n,"",i)}},9400(t,e,n){const i=n(5334);function r(t,e){let n="";for(;e<t.length&&"'"!==t[e]&&'"'!==t[e];e++)n+=t[e];if(n=n.trim(),-1!==n.indexOf(" "))throw new Error("External entites are not supported");const i=t[e++];let r="";for(;e<t.length&&t[e]!==i;e++)r+=t[e];return[n,r,e]}function s(t,e){return"!"===t[e+1]&&"-"===t[e+2]&&"-"===t[e+3]}function a(t,e){return"!"===t[e+1]&&"E"===t[e+2]&&"N"===t[e+3]&&"T"===t[e+4]&&"I"===t[e+5]&&"T"===t[e+6]&&"Y"===t[e+7]}function o(t,e){return"!"===t[e+1]&&"E"===t[e+2]&&"L"===t[e+3]&&"E"===t[e+4]&&"M"===t[e+5]&&"E"===t[e+6]&&"N"===t[e+7]&&"T"===t[e+8]}function l(t,e){return"!"===t[e+1]&&"A"===t[e+2]&&"T"===t[e+3]&&"T"===t[e+4]&&"L"===t[e+5]&&"I"===t[e+6]&&"S"===t[e+7]&&"T"===t[e+8]}function c(t,e){return"!"===t[e+1]&&"N"===t[e+2]&&"O"===t[e+3]&&"T"===t[e+4]&&"A"===t[e+5]&&"T"===t[e+6]&&"I"===t[e+7]&&"O"===t[e+8]&&"N"===t[e+9]}function h(t){if(i.isName(t))return t;throw new Error(`Invalid entity name ${t}`)}t.exports=function(t,e){const n={};if("O"!==t[e+3]||"C"!==t[e+4]||"T"!==t[e+5]||"Y"!==t[e+6]||"P"!==t[e+7]||"E"!==t[e+8])throw new Error("Invalid Tag instead of DOCTYPE");{e+=9;let i=1,u=!1,d=!1,f="";for(;e<t.length;e++)if("<"!==t[e]||d)if(">"===t[e]){if(d?"-"===t[e-1]&&"-"===t[e-2]&&(d=!1,i--):i--,0===i)break}else"["===t[e]?u=!0:f+=t[e];else{if(u&&a(t,e)){let i,s;e+=7,[i,s,e]=r(t,e+1),-1===s.indexOf("&")&&(n[h(i)]={regx:RegExp(`&${i};`,"g"),val:s})}else if(u&&o(t,e))e+=8;else if(u&&l(t,e))e+=8;else if(u&&c(t,e))e+=9;else{if(!s)throw new Error("Invalid DOCTYPE");d=!0}i++,f=""}if(0!==i)throw new Error("Unclosed DOCTYPE")}return{entities:n,i:e}}},460(t,e){const n={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(t,e){return e},attributeValueProcessor:function(t,e){return e},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(t,e,n){return t}};e.buildOptions=function(t){return Object.assign({},n,t)},e.defaultOptions=n},7680(t,e,n){"use strict";const i=n(5334),r=n(3832),s=n(9400),a=n(7983),o=n(3085);function l(t){const e=Object.keys(t);for(let n=0;n<e.length;n++){const i=e[n];this.lastEntities[i]={regex:new RegExp("&"+i+";","g"),val:t[i]}}}function c(t,e,n,i,r,s,a){if(void 0!==t&&(this.options.trimValues&&!i&&(t=t.trim()),t.length>0)){a||(t=this.replaceEntitiesValue(t));const i=this.options.tagValueProcessor(e,t,n,r,s);return null==i?t:typeof i!=typeof t||i!==t?i:this.options.trimValues||t.trim()===t?w(t,this.options.parseTagValue,this.options.numberParseOptions):t}}function h(t){if(this.options.removeNSPrefix){const e=t.split(":"),n="/"===t.charAt(0)?"/":"";if("xmlns"===e[0])return"";2===e.length&&(t=n+e[1])}return t}const u=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function d(t,e,n){if(!0!==this.options.ignoreAttributes&&"string"==typeof t){const n=i.getAllMatches(t,u),r=n.length,s={};for(let t=0;t<r;t++){const i=this.resolveNameSpace(n[t][1]);if(this.ignoreAttributesFn(i,e))continue;let r=n[t][4],a=this.options.attributeNamePrefix+i;if(i.length)if(this.options.transformAttributeName&&(a=this.options.transformAttributeName(a)),"__proto__"===a&&(a="#__proto__"),void 0!==r){this.options.trimValues&&(r=r.trim()),r=this.replaceEntitiesValue(r);const t=this.options.attributeValueProcessor(i,r,e);s[a]=null==t?r:typeof t!=typeof r||t!==r?t:w(r,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(s[a]=!0)}if(!Object.keys(s).length)return;if(this.options.attributesGroupName){const t={};return t[this.options.attributesGroupName]=s,t}return s}}const f=function(t){t=t.replace(/\r\n?/g,"\n");const e=new r("!xml");let n=e,i="",a="";for(let o=0;o<t.length;o++)if("<"===t[o])if("/"===t[o+1]){const e=E(t,">",o,"Closing Tag is not closed.");let r=t.substring(o+2,e).trim();if(this.options.removeNSPrefix){const t=r.indexOf(":");-1!==t&&(r=r.substr(t+1))}this.options.transformTagName&&(r=this.options.transformTagName(r)),n&&(i=this.saveTextToParentTag(i,n,a));const s=a.substring(a.lastIndexOf(".")+1);if(r&&-1!==this.options.unpairedTags.indexOf(r))throw new Error(`Unpaired tag can not be used as closing tag: </${r}>`);let l=0;s&&-1!==this.options.unpairedTags.indexOf(s)?(l=a.lastIndexOf(".",a.lastIndexOf(".")-1),this.tagsNodeStack.pop()):l=a.lastIndexOf("."),a=a.substring(0,l),n=this.tagsNodeStack.pop(),i="",o=e}else if("?"===t[o+1]){let e=y(t,o,!1,"?>");if(!e)throw new Error("Pi Tag is not closed.");if(i=this.saveTextToParentTag(i,n,a),this.options.ignoreDeclaration&&"?xml"===e.tagName||this.options.ignorePiTags);else{const t=new r(e.tagName);t.add(this.options.textNodeName,""),e.tagName!==e.tagExp&&e.attrExpPresent&&(t[":@"]=this.buildAttributesMap(e.tagExp,a,e.tagName)),this.addChild(n,t,a)}o=e.closeIndex+1}else if("!--"===t.substr(o+1,3)){const e=E(t,"--\x3e",o+4,"Comment is not closed.");if(this.options.commentPropName){const r=t.substring(o+4,e-2);i=this.saveTextToParentTag(i,n,a),n.add(this.options.commentPropName,[{[this.options.textNodeName]:r}])}o=e}else if("!D"===t.substr(o+1,2)){const e=s(t,o);this.docTypeEntities=e.entities,o=e.i}else if("!["===t.substr(o+1,2)){const e=E(t,"]]>",o,"CDATA is not closed.")-2,r=t.substring(o+9,e);i=this.saveTextToParentTag(i,n,a);let s=this.parseTextData(r,n.tagname,a,!0,!1,!0,!0);null==s&&(s=""),this.options.cdataPropName?n.add(this.options.cdataPropName,[{[this.options.textNodeName]:r}]):n.add(this.options.textNodeName,s),o=e+2}else{let s=y(t,o,this.options.removeNSPrefix),l=s.tagName;const c=s.rawTagName;let h=s.tagExp,u=s.attrExpPresent,d=s.closeIndex;this.options.transformTagName&&(l=this.options.transformTagName(l)),n&&i&&"!xml"!==n.tagname&&(i=this.saveTextToParentTag(i,n,a,!1));const f=n;if(f&&-1!==this.options.unpairedTags.indexOf(f.tagname)&&(n=this.tagsNodeStack.pop(),a=a.substring(0,a.lastIndexOf("."))),l!==e.tagname&&(a+=a?"."+l:l),this.isItStopNode(this.options.stopNodes,a,l)){let e="";if(h.length>0&&h.lastIndexOf("/")===h.length-1)"/"===l[l.length-1]?(l=l.substr(0,l.length-1),a=a.substr(0,a.length-1),h=l):h=h.substr(0,h.length-1),o=s.closeIndex;else if(-1!==this.options.unpairedTags.indexOf(l))o=s.closeIndex;else{const n=this.readStopNodeData(t,c,d+1);if(!n)throw new Error(`Unexpected end of ${c}`);o=n.i,e=n.tagContent}const i=new r(l);l!==h&&u&&(i[":@"]=this.buildAttributesMap(h,a,l)),e&&(e=this.parseTextData(e,l,a,!0,u,!0,!0)),a=a.substr(0,a.lastIndexOf(".")),i.add(this.options.textNodeName,e),this.addChild(n,i,a)}else{if(h.length>0&&h.lastIndexOf("/")===h.length-1){"/"===l[l.length-1]?(l=l.substr(0,l.length-1),a=a.substr(0,a.length-1),h=l):h=h.substr(0,h.length-1),this.options.transformTagName&&(l=this.options.transformTagName(l));const t=new r(l);l!==h&&u&&(t[":@"]=this.buildAttributesMap(h,a,l)),this.addChild(n,t,a),a=a.substr(0,a.lastIndexOf("."))}else{const t=new r(l);this.tagsNodeStack.push(n),l!==h&&u&&(t[":@"]=this.buildAttributesMap(h,a,l)),this.addChild(n,t,a),n=t}i="",o=d}}else i+=t[o];return e.child};function m(t,e,n){const i=this.options.updateTag(e.tagname,n,e[":@"]);!1===i||("string"==typeof i?(e.tagname=i,t.addChild(e)):t.addChild(e))}const p=function(t){if(this.options.processEntities){for(let e in this.docTypeEntities){const n=this.docTypeEntities[e];t=t.replace(n.regx,n.val)}for(let e in this.lastEntities){const n=this.lastEntities[e];t=t.replace(n.regex,n.val)}if(this.options.htmlEntities)for(let e in this.htmlEntities){const n=this.htmlEntities[e];t=t.replace(n.regex,n.val)}t=t.replace(this.ampEntity.regex,this.ampEntity.val)}return t};function g(t,e,n,i){return t&&(void 0===i&&(i=0===e.child.length),void 0!==(t=this.parseTextData(t,e.tagname,n,!1,!!e[":@"]&&0!==Object.keys(e[":@"]).length,i))&&""!==t&&e.add(this.options.textNodeName,t),t=""),t}function b(t,e,n){const i="*."+n;for(const n in t){const r=t[n];if(i===r||e===r)return!0}return!1}function E(t,e,n,i){const r=t.indexOf(e,n);if(-1===r)throw new Error(i);return r+e.length-1}function y(t,e,n,i=">"){const r=function(t,e,n=">"){let i,r="";for(let s=e;s<t.length;s++){let e=t[s];if(i)e===i&&(i="");else if('"'===e||"'"===e)i=e;else if(e===n[0]){if(!n[1])return{data:r,index:s};if(t[s+1]===n[1])return{data:r,index:s}}else"\t"===e&&(e=" ");r+=e}}(t,e+1,i);if(!r)return;let s=r.data;const a=r.index,o=s.search(/\s/);let l=s,c=!0;-1!==o&&(l=s.substring(0,o),s=s.substring(o+1).trimStart());const h=l;if(n){const t=l.indexOf(":");-1!==t&&(l=l.substr(t+1),c=l!==r.data.substr(t+1))}return{tagName:l,tagExp:s,closeIndex:a,attrExpPresent:c,rawTagName:h}}function v(t,e,n){const i=n;let r=1;for(;n<t.length;n++)if("<"===t[n])if("/"===t[n+1]){const s=E(t,">",n,`${e} is not closed`);if(t.substring(n+2,s).trim()===e&&(r--,0===r))return{tagContent:t.substring(i,n),i:s};n=s}else if("?"===t[n+1])n=E(t,"?>",n+1,"StopNode is not closed.");else if("!--"===t.substr(n+1,3))n=E(t,"--\x3e",n+3,"StopNode is not closed.");else if("!["===t.substr(n+1,2))n=E(t,"]]>",n,"StopNode is not closed.")-2;else{const i=y(t,n,">");i&&((i&&i.tagName)===e&&"/"!==i.tagExp[i.tagExp.length-1]&&r++,n=i.closeIndex)}}function w(t,e,n){if(e&&"string"==typeof t){const e=t.trim();return"true"===e||"false"!==e&&a(t,n)}return i.isExist(t)?t:""}t.exports=class{constructor(t){this.options=t,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"Â¢"},pound:{regex:/&(pound|#163);/g,val:"Â£"},yen:{regex:/&(yen|#165);/g,val:"Â¥"},euro:{regex:/&(euro|#8364);/g,val:"â‚¬"},copyright:{regex:/&(copy|#169);/g,val:"Â©"},reg:{regex:/&(reg|#174);/g,val:"Â®"},inr:{regex:/&(inr|#8377);/g,val:"â‚¹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(t,e)=>String.fromCharCode(Number.parseInt(e,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(t,e)=>String.fromCharCode(Number.parseInt(e,16))}},this.addExternalEntities=l,this.parseXml=f,this.parseTextData=c,this.resolveNameSpace=h,this.buildAttributesMap=d,this.isItStopNode=b,this.replaceEntitiesValue=p,this.readStopNodeData=v,this.saveTextToParentTag=g,this.addChild=m,this.ignoreAttributesFn=o(this.options.ignoreAttributes)}}},2923(t,e,n){const{buildOptions:i}=n(460),r=n(7680),{prettify:s}=n(5629),a=n(3918);t.exports=class{constructor(t){this.externalEntities={},this.options=i(t)}parse(t,e){if("string"==typeof t);else{if(!t.toString)throw new Error("XML data is accepted in String or Bytes[] form.");t=t.toString()}if(e){!0===e&&(e={});const n=a.validate(t,e);if(!0!==n)throw Error(`${n.err.msg}:${n.err.line}:${n.err.col}`)}const n=new r(this.options);n.addExternalEntities(this.externalEntities);const i=n.parseXml(t);return this.options.preserveOrder||void 0===i?i:s(i,this.options)}addEntity(t,e){if(-1!==e.indexOf("&"))throw new Error("Entity value can't have '&'");if(-1!==t.indexOf("&")||-1!==t.indexOf(";"))throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if("&"===e)throw new Error("An entity with value '&' is not permitted");this.externalEntities[t]=e}}},5629(t,e){"use strict";function n(t,e,a){let o;const l={};for(let c=0;c<t.length;c++){const h=t[c],u=i(h);let d="";if(d=void 0===a?u:a+"."+u,u===e.textNodeName)void 0===o?o=h[u]:o+=""+h[u];else{if(void 0===u)continue;if(h[u]){let t=n(h[u],e,d);const i=s(t,e);h[":@"]?r(t,h[":@"],d,e):1!==Object.keys(t).length||void 0===t[e.textNodeName]||e.alwaysCreateTextNode?0===Object.keys(t).length&&(e.alwaysCreateTextNode?t[e.textNodeName]="":t=""):t=t[e.textNodeName],void 0!==l[u]&&l.hasOwnProperty(u)?(Array.isArray(l[u])||(l[u]=[l[u]]),l[u].push(t)):e.isArray(u,d,i)?l[u]=[t]:l[u]=t}}}return"string"==typeof o?o.length>0&&(l[e.textNodeName]=o):void 0!==o&&(l[e.textNodeName]=o),l}function i(t){const e=Object.keys(t);for(let t=0;t<e.length;t++){const n=e[t];if(":@"!==n)return n}}function r(t,e,n,i){if(e){const r=Object.keys(e),s=r.length;for(let a=0;a<s;a++){const s=r[a];i.isArray(s,n+"."+s,!0,!0)?t[s]=[e[s]]:t[s]=e[s]}}}function s(t,e){const{textNodeName:n}=e,i=Object.keys(t).length;return 0===i||!(1!==i||!t[n]&&"boolean"!=typeof t[n]&&0!==t[n])}e.prettify=function(t,e){return n(t,e)}},3832(t){"use strict";t.exports=class{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,e){"__proto__"===t&&(t="#__proto__"),this.child.push({[t]:e})}addChild(t){"__proto__"===t.tagname&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,":@":t[":@"]}):this.child.push({[t.tagname]:t.child})}}},7983(t){const e=/^[-+]?0x[a-fA-F0-9]+$/,n=/^([\-\+])?(0*)([0-9]*(\.[0-9]*)?)$/,i={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};t.exports=function(t,r={}){if(r=Object.assign({},i,r),!t||"string"!=typeof t)return t;let s=t.trim();if(void 0!==r.skipLike&&r.skipLike.test(s))return t;if("0"===t)return 0;if(r.hex&&e.test(s))return function(t){if(parseInt)return parseInt(t,16);if(Number.parseInt)return Number.parseInt(t,16);if(window&&window.parseInt)return window.parseInt(t,16);throw new Error("parseInt, Number.parseInt, window.parseInt are not supported")}(s);if(-1!==s.search(/[eE]/)){const e=s.match(/^([-\+])?(0*)([0-9]*(\.[0-9]*)?[eE][-\+]?[0-9]+)$/);if(e){if(r.leadingZeros)s=(e[1]||"")+e[3];else if("0"!==e[2]||"."!==e[3][0])return t;return r.eNotation?Number(s):t}return t}{const e=n.exec(s);if(e){const n=e[1],i=e[2];let o=(a=e[3])&&-1!==a.indexOf(".")?("."===(a=a.replace(/0+$/,""))?a="0":"."===a[0]?a="0"+a:"."===a[a.length-1]&&(a=a.substr(0,a.length-1)),a):a;if(!r.leadingZeros&&i.length>0&&n&&"."!==s[2])return t;if(!r.leadingZeros&&i.length>0&&!n&&"."!==s[1])return t;if(r.leadingZeros&&i===t)return 0;{const e=Number(s),a=""+e;return-1!==a.search(/[eE]/)?r.eNotation?e:t:-1!==s.indexOf(".")?"0"===a&&""===o||a===o||n&&a==="-"+o?e:t:i?o===a||n+o===a?e:t:s===a||s===n+a?e:t}}return t}var a}},3664(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.generateXmlFromDtd=function(t){const e=(new i.DTDParser).parseString(function(t){const e=t.replace(/<\?xml[\s\S]*?\?>/gi,"").trim(),n=e.match(/<!DOCTYPE[\s\S]*?\[([\s\S]*?)\]\s*>/i);return n?.[1]?n[1].trim():e}(t));if(0===e.getElementDeclMap().size)throw new Error("No <!ELEMENT ...> declarations found in DTD.");return r(function(t){const e=[...t.getElementDeclMap().keys()],n=new Set;for(const i of e){const e=t.getContentModel(i);if(e)for(const i of e.getChildren())t.getElementDeclMap().has(i)&&n.add(i)}for(const t of e)if(!n.has(t))return t;return e[0]}(e),e,new Set,0)};const i=n(9817);function r(t,e,n,s){const a="  ".repeat(s),o=function(t,e){const n=e.getElementAttributesMap(t);if(!n||0===n.size)return"";const i=[];return n.forEach((t,e)=>{const n=t.getDefaultDecl(),r=t.getDefaultValue();var s;"#IMPLIED"!==n&&("#REQUIRED"!==n?r.length>0&&i.push(`${e}="${s=r,s.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;")}"`):i.push(`${e}=""`))}),i.length>0?` ${i.join(" ")}`:""}(t,e),l=e.getContentModel(t);if(n.has(t))return`${a}<${t}${o}/>`;if(!l||l.getType()===i.ContentModelType.EMPTY)return`${a}<${t}${o}/>`;if(l.getType()===i.ContentModelType.PCDATA)return`${a}<${t}${o}>text</${t}>`;const c=new Set(n);c.add(t);const h=[...l.getChildren()].filter(t=>e.getElementDeclMap().has(t));return 0===h.length?l.getType()===i.ContentModelType.ANY||l.getType()===i.ContentModelType.MIXED?`${a}<${t}${o}>text</${t}>`:`${a}<${t}${o}/>`:`${a}<${t}${o}>\n${h.map(t=>r(t,e,c,s+1)).join("\n")}\n${a}</${t}>`}},4265(t,e,n){"use strict";var i,r=this&&this.__createBinding||(Object.create?function(t,e,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(e,n);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,i,r)}:function(t,e,n,i){void 0===i&&(i=n),t[i]=e[n]}),s=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),a=this&&this.__importStar||(i=function(t){return i=Object.getOwnPropertyNames||function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[e.length]=n);return e},i(t)},function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n=i(t),a=0;a<n.length;a++)"default"!==n[a]&&r(e,t,n[a]);return s(e,t),e});Object.defineProperty(e,"__esModule",{value:!0}),e.activate=function(t){console.log("XML Tree Viewer is now active!");const e=t=>".xml"===l.extname(t).toLowerCase(),n=new h.XmlTreeDataProvider;o.window.createTreeView("xmlTreeViewerSidebar",{treeDataProvider:n,showCollapseAll:!0});const i=()=>{const t=o.window.activeTextEditor;t&&e(t.document.fileName)?n.refresh(t.document.getText()):n.refresh(void 0)};t.subscriptions.push(o.window.onDidChangeActiveTextEditor(()=>i())),t.subscriptions.push(o.workspace.onDidSaveTextDocument(t=>{e(t.fileName)&&i()})),t.subscriptions.push(o.workspace.onDidChangeTextDocument(t=>{const i=o.window.activeTextEditor;i&&t.document===i.document&&e(t.document.fileName)&&n.refresh(t.document.getText())}));const r=o.commands.registerCommand("xmlTreeViewer.openTreeView",()=>{const e=o.window.activeTextEditor;if(!e)return void o.window.showWarningMessage("No active editor. Open an XML or DTD file first.");const n=e.document;if(!(t=>{const e=l.extname(t).toLowerCase();return".xml"===e||".dtd"===e})(n.fileName))return void o.window.showWarningMessage("Active file is not an XML or DTD file.");const i=n.getText(),r=l.basename(n.fileName);c.XmlTreePanel.createOrShow(t.extensionUri,i,r)}),s=o.commands.registerCommand("xmlTreeViewer.refreshSidebar",()=>{i()});t.subscriptions.push(r,s),i()},e.deactivate=function(){};const o=a(n(1398)),l=a(n(6928)),c=n(5417),h=n(4083)},3030(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.generateMermaidMarkup=function(t){const e=["graph TD"];let n=0;function i(t){return t.replace(/"/g,"#quot;").replace(/</g,"#lt;").replace(/>/g,"#gt;").replace(/&/g,"#amp;")}(function t(r,s){const a="N"+n++,o=function(t){let e=i(t.tagName);const n=Object.entries(t.attributes);return n.length>0&&(e+=`<br/>${n.map(([t,e])=>`${i(t)}=${i(e)}`).join("<br/>")}`),t.textContent&&0===t.children.length&&(e+=`<br/><b>${i(t.textContent)}</b>`),e}(r);0===r.children.length&&r.textContent?e.push(`    ${a}("${o}")`):(r.children.length,e.push(`    ${a}["${o}"]`)),void 0!==s&&e.push(`    ${s} --\x3e ${a}`);for(const e of r.children)t(e,a)})(t),e.push(""),e.push("    classDef root fill:#4a90d9,stroke:#2c5f8a,color:#fff,font-weight:bold"),e.push("    classDef branch fill:#5ba85b,stroke:#3d7a3d,color:#fff"),e.push("    classDef leaf fill:#f5a623,stroke:#c4841d,color:#fff"),e.push("    class N0 root");const r=[],s=[];return function t(e,n,i=!0){const a=n.current++;i||(e.children.length>0?r.push(`N${a}`):s.push(`N${a}`));for(const i of e.children)t(i,n,!1)}(t,{current:0}),r.length>0&&e.push(`    class ${r.join(",")} branch`),s.length>0&&e.push(`    class ${s.join(",")} leaf`),e.join("\n")}},4083(t,e,n){"use strict";var i,r=this&&this.__createBinding||(Object.create?function(t,e,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(e,n);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,i,r)}:function(t,e,n,i){void 0===i&&(i=n),t[i]=e[n]}),s=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),a=this&&this.__importStar||(i=function(t){return i=Object.getOwnPropertyNames||function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[e.length]=n);return e},i(t)},function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n=i(t),a=0;a<n.length;a++)"default"!==n[a]&&r(e,t,n[a]);return s(e,t),e});Object.defineProperty(e,"__esModule",{value:!0}),e.XmlTreeItem=e.XmlTreeDataProvider=void 0;const o=a(n(1398)),l=n(9234);e.XmlTreeDataProvider=class{constructor(){this._onDidChangeTreeData=new o.EventEmitter,this.onDidChangeTreeData=this._onDidChangeTreeData.event}refresh(t){if(t)try{this._rootNode=(0,l.parseXml)(t)}catch{this._rootNode=void 0}else this._rootNode=void 0;this._onDidChangeTreeData.fire()}getTreeItem(t){return t}getChildren(t){return this._rootNode?t?t.xmlNode.children.map(t=>this._createTreeItem(t)):[this._createTreeItem(this._rootNode)]:[]}_createTreeItem(t){const e=t.children.length>0?o.TreeItemCollapsibleState.Expanded:o.TreeItemCollapsibleState.None;return new c(t,e)}};class c extends o.TreeItem{constructor(t,e){let n=t.tagName;const i=Object.entries(t.attributes);i.length>0&&(n+=` [${i.map(([t,e])=>`${t}="${e}"`).join(" ")}]`),super(n,e),this.xmlNode=t,this.collapsibleState=e,t.textContent&&0===t.children.length&&(this.description=t.textContent),t.children.length>0?this.iconPath=new o.ThemeIcon("symbol-class"):t.textContent?this.iconPath=new o.ThemeIcon("symbol-string"):this.iconPath=new o.ThemeIcon("symbol-field"),this.tooltip=this._buildTooltip()}_buildTooltip(){let t=`<${this.xmlNode.tagName}>`;const e=Object.entries(this.xmlNode.attributes);if(e.length>0){t+="\n\nAttributes:";for(const[n,i]of e)t+=`\n  ${n} = "${i}"`}return this.xmlNode.textContent&&(t+=`\n\nValue: ${this.xmlNode.textContent}`),this.xmlNode.children.length>0&&(t+=`\n\nChildren: ${this.xmlNode.children.length}`),t}}e.XmlTreeItem=c},5417(t,e,n){"use strict";var i,r=this&&this.__createBinding||(Object.create?function(t,e,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(e,n);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,i,r)}:function(t,e,n,i){void 0===i&&(i=n),t[i]=e[n]}),s=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),a=this&&this.__importStar||(i=function(t){return i=Object.getOwnPropertyNames||function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[e.length]=n);return e},i(t)},function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n=i(t),a=0;a<n.length;a++)"default"!==n[a]&&r(e,t,n[a]);return s(e,t),e});Object.defineProperty(e,"__esModule",{value:!0}),e.XmlTreePanel=void 0;const o=a(n(1398)),l=a(n(6982)),c=n(9234),h=n(3030),u=n(3664);class d{static createOrShow(t,e,n){const i=o.ViewColumn.Beside;if(d.currentPanel)return d.currentPanel._panel.reveal(i),void d.currentPanel._update(e,n);const r=o.window.createWebviewPanel("xmlTreeViewer",`XML Tree: ${n}`,i,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[t]});d.currentPanel=new d(r,e,n)}constructor(t,e,n){this._disposables=[],this._pendingImageSaves=new Map,this._panel=t,this._update(e,n),this._panel.onDidDispose(()=>this.dispose(),null,this._disposables),this._panel.webview.onDidReceiveMessage(async t=>{const e=t=>setTimeout(()=>{const e=this._pendingImageSaves.get(t);if(e){this._pendingImageSaves.delete(t);try{e.timeout&&clearTimeout(e.timeout)}catch{}this._panel.webview.postMessage({type:"saveMermaidImageError",message:"Image export timed out. Try again."})}},6e4);if("saveMermaidImageAbort"===t.type){const e=this._pendingImageSaves.get(t.saveId);return e?.timeout&&clearTimeout(e.timeout),void this._pendingImageSaves.delete(t.saveId)}if("requestSaveMermaidImage"===t.type){const t=n.replace(/\.(xml|dtd)$/i,"-diagram.png"),i=await o.window.showSaveDialog({defaultUri:o.Uri.file(t),filters:{"PNG Image":["png"]}});if(!i){const t={type:"saveMermaidImageCancelled"};return void this._panel.webview.postMessage(t)}const r=l.randomBytes(8).toString("hex");this._pendingImageSaves.set(r,{uri:i,received:0,chunks:[],timeout:e(r)});const s={type:"saveMermaidImageSession",saveId:r};return void this._panel.webview.postMessage(s)}if("saveMermaidImageChunk"===t.type){const n=this._pendingImageSaves.get(t.saveId);if(!n){const t={type:"saveMermaidImageError",message:"No active save session. Try again."};return void this._panel.webview.postMessage(t)}if(n.timeout&&clearTimeout(n.timeout),n.timeout=e(t.saveId),!Number.isFinite(t.index)||!Number.isFinite(t.total)||t.total<=0||t.index<0||t.index>=t.total){n.timeout&&clearTimeout(n.timeout),this._pendingImageSaves.delete(t.saveId);const e={type:"saveMermaidImageError",message:"Invalid image data received."};return void this._panel.webview.postMessage(e)}if(void 0===n.total)n.total=t.total,n.chunks=new Array(t.total);else if(n.total!==t.total){n.timeout&&clearTimeout(n.timeout),this._pendingImageSaves.delete(t.saveId);const e={type:"saveMermaidImageError",message:"Image transfer interrupted. Try again."};return void this._panel.webview.postMessage(e)}if(void 0===n.chunks[t.index]&&(n.received+=1),n.chunks[t.index]=t.chunk,void 0!==n.total&&n.received===n.total)try{const t=n.chunks.join(""),e=Buffer.from(t,"base64"),i=Buffer.from([137,80,78,71,13,10,26,10]);if(e.length<8||!e.subarray(0,8).equals(i))throw new Error("Corrupted PNG data");await o.workspace.fs.writeFile(n.uri,e),o.window.showInformationMessage(`Diagram saved to ${n.uri.fsPath}`);const r={type:"saveMermaidImageSaved"};this._panel.webview.postMessage(r)}catch(t){const e={type:"saveMermaidImageError",message:t?.message||"Failed to save image."};this._panel.webview.postMessage(e)}finally{n.timeout&&clearTimeout(n.timeout),this._pendingImageSaves.delete(t.saveId)}return}if("saveMermaidImage"===t.type&&t.pngDataUrl){const e=n.replace(/\.(xml|dtd)$/i,"-diagram.png"),i=await o.window.showSaveDialog({defaultUri:o.Uri.file(e),filters:{"PNG Image":["png"]}});if(i){const e=t.pngDataUrl.replace(/^data:image\/png;base64,/,"");await o.workspace.fs.writeFile(i,Buffer.from(e,"base64")),o.window.showInformationMessage(`Diagram saved to ${i.fsPath}`)}return}},null,this._disposables)}dispose(){d.currentPanel=void 0;for(const t of this._pendingImageSaves.values())t.timeout&&clearTimeout(t.timeout);for(this._pendingImageSaves.clear(),this._panel.dispose();this._disposables.length;){const t=this._disposables.pop();t&&t.dispose()}}_update(t,e){if(this._panel.title=`XML Tree: ${e}`,e.toLowerCase().endsWith(".dtd"))try{const n=(0,u.generateXmlFromDtd)(t);this._panel.webview.html=this._getDtdHtml(n,e)}catch(t){this._panel.webview.html=this._getErrorHtml("DTD Parse Error: "+t.message)}else try{const n=(0,c.parseXml)(t),i=(0,c.generateTextTree)(n),r=(0,h.generateMermaidMarkup)(n),s=f(n);this._panel.webview.html=this._getHtml(i,r,s,e)}catch(t){this._panel.webview.html=this._getErrorHtml(t.message)}}_getDtdHtml(t,e){const n=l.randomBytes(16).toString("hex");return`<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src 'unsafe-inline'; script-src 'nonce-${n}';">\n  <title>DTD to XML Preview</title>\n  <style>\n    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #1a1a2e; color: #e0e0e0; padding: 0; }\n    .header { background: linear-gradient(135deg, #16213e, #0f3460); padding: 16px 24px; border-bottom: 2px solid #533483; display: flex; align-items: center; gap: 12px; }\n    .header h1 { font-size: 18px; font-weight: 600; color: #e94560; }\n    .header .filename { color: #a8a8b3; font-size: 14px; font-weight: 400; }\n    .content { padding: 24px; }\n    .xml-preview { background: #0f0f23; border: 1px solid #2a2a4a; border-radius: 8px; padding: 20px; overflow-x: auto; font-family: 'Cascadia Code', 'Fira Code', 'JetBrains Mono', 'Consolas', monospace; font-size: 14px; line-height: 1.8; white-space: pre; color: #c5c8c6; }\n    .controls { display: flex; gap: 8px; margin-bottom: 16px; }\n    .btn { padding: 8px 16px; border: 1px solid #533483; background: #16213e; color: #e0e0e0; border-radius: 6px; cursor: pointer; font-size: 13px; transition: all 0.2s; }\n    .btn.primary { background: #e94560; border-color: #e94560; color: #fff; }\n    .btn.primary:hover { background: #c73a52; }\n    .btn:hover { background: #533483; color: #fff; }\n    .toast { position: fixed; bottom: 20px; right: 20px; background: #5ba85b; color: #fff; padding: 12px 24px; border-radius: 8px; font-size: 14px; opacity: 0; transition: opacity 0.3s; z-index: 1000; }\n    .toast.show { opacity: 1; }\n  </style>\n</head>\n<body>\n  <div class="header">\n    <h1>DTD â†’ XML Skeleton</h1>\n    <span class="filename">${e}</span>\n  </div>\n  <div class="content">\n    <div class="controls">\n      <button class="btn primary" id="copyXmlBtn">ðŸ“‹ Copy XML</button>\n    </div>\n    <div class="xml-preview" id="xmlPreview">${t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}</div>\n  </div>\n  <div class="toast" id="toast">Copied to clipboard!</div>\n  <script nonce="${n}">\n    (function() {\n      document.getElementById('copyXmlBtn').addEventListener('click', function() {\n        var xml = "" +\n          "" +\n          "${t.replace(/\\/g,"\\\\").replace(/`/g,"\\`").replace(/\$/g,"\\$")}";\n        navigator.clipboard.writeText(xml);\n        var toast = document.getElementById('toast');\n        toast.textContent = 'XML copied to clipboard!';\n        toast.classList.add('show');\n        setTimeout(function() { toast.classList.remove('show'); }, 2000);\n      });\n    })();\n  <\/script>\n</body>\n</html>`}_getErrorHtml(t){return`<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8">\n  <style>\n    body { font-family: var(--vscode-font-family); padding: 20px; background: #1e1e1e; color: #d4d4d4; }\n    .error { color: #f44747; border: 1px solid #f44747; padding: 16px; border-radius: 8px; background: #2d1515; }\n  </style>\n</head>\n<body>\n  <div class="error">\n    <h2>âš  XML Parse Error</h2>\n    <p>${t}</p>\n  </div>\n</body>\n</html>`}_getHtml(t,e,n,i){const r=l.randomBytes(16).toString("hex"),s=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),a=JSON.stringify(n,null,2);return`<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src 'unsafe-inline'; script-src 'nonce-${r}' https://cdn.jsdelivr.net; img-src data: blob:; font-src data:; connect-src https://cdn.jsdelivr.net;">\n  <title>XML Tree Viewer</title>\n  <style>\n    * { box-sizing: border-box; margin: 0; padding: 0; }\n\n    body {\n      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n      background: #1a1a2e;\n      color: #e0e0e0;\n      padding: 0;\n      overflow-x: hidden;\n    }\n\n    .header {\n      background: linear-gradient(135deg, #16213e, #0f3460);\n      padding: 16px 24px;\n      border-bottom: 2px solid #533483;\n      display: flex;\n      align-items: center;\n      gap: 12px;\n      position: sticky;\n      top: 0;\n      z-index: 100;\n    }\n\n    .header h1 { font-size: 18px; font-weight: 600; color: #e94560; }\n    .header .filename { color: #a8a8b3; font-size: 14px; font-weight: 400; }\n\n    .tabs {\n      display: flex;\n      background: #16213e;\n      border-bottom: 1px solid #2a2a4a;\n      flex-wrap: wrap;\n    }\n\n    .tab {\n      padding: 12px 24px;\n      cursor: pointer;\n      font-size: 14px;\n      font-weight: 500;\n      color: #a8a8b3;\n      border-bottom: 3px solid transparent;\n      transition: all 0.2s ease;\n      user-select: none;\n    }\n\n    .tab:hover { color: #e0e0e0; background: rgba(233, 69, 96, 0.1); }\n    .tab.active { color: #e94560; border-bottom-color: #e94560; }\n\n    .content { padding: 24px; min-height: calc(100vh - 110px); }\n    .panel { display: none; }\n    .panel.active { display: block; }\n\n    /* Parsed Tree */\n    .text-tree {\n      background: #0f0f23;\n      border: 1px solid #2a2a4a;\n      border-radius: 8px;\n      padding: 20px;\n      overflow-x: auto;\n      font-family: 'Cascadia Code', 'Fira Code', 'JetBrains Mono', 'Consolas', monospace;\n      font-size: 13px;\n      line-height: 1.8;\n      white-space: pre;\n      color: #c5c8c6;\n    }\n\n    .text-tree .tag { color: #e94560; }\n    .text-tree .attr { color: #f5a623; }\n    .text-tree .value { color: #5ba85b; }\n    .text-tree .connector { color: #533483; }\n\n    /* Mermaid Diagram */\n    .mermaid-container {\n      background: #ffffff;\n      border-radius: 8px;\n      padding: 24px;\n      overflow: auto;\n      min-height: 400px;\n    }\n\n    .mermaid-wrapper {\n      transform-origin: top left;\n      transition: transform 0.2s;\n    }\n\n    /* JSON Object View */\n    .json-tree {\n      background: #0f0f23;\n      border: 1px solid #2a2a4a;\n      border-radius: 8px;\n      padding: 20px;\n      overflow-x: auto;\n      font-family: 'Cascadia Code', 'Fira Code', 'JetBrains Mono', 'Consolas', monospace;\n      font-size: 13px;\n      line-height: 1.6;\n    }\n\n    .json-item { padding-left: 20px; }\n\n    .json-key { color: #e94560; }\n    .json-string { color: #5ba85b; }\n    .json-number { color: #f5a623; }\n    .json-bracket { color: #a8a8b3; }\n    .json-null { color: #888; }\n    .json-bool { color: #c678dd; }\n\n    .json-toggle {\n      cursor: pointer;\n      user-select: none;\n      display: inline-block;\n      width: 16px;\n      color: #888;\n      font-size: 11px;\n    }\n\n    .json-toggle:hover { color: #e94560; }\n\n    .json-collapsible { }\n    .json-collapsible.collapsed > .json-item { display: none; }\n    .json-collapsible.collapsed > .json-summary { display: inline; }\n\n    .json-summary {\n      display: none;\n      color: #666;\n      font-style: italic;\n    }\n\n    /* Controls */\n    .controls { display: flex; gap: 8px; margin-bottom: 16px; flex-wrap: wrap; }\n\n    .btn {\n      padding: 8px 16px;\n      border: 1px solid #533483;\n      background: #16213e;\n      color: #e0e0e0;\n      border-radius: 6px;\n      cursor: pointer;\n      font-size: 13px;\n      transition: all 0.2s;\n    }\n\n    .btn:hover { background: #533483; color: #fff; }\n    .btn.primary { background: #e94560; border-color: #e94560; color: #fff; }\n    .btn.primary:hover { background: #c73a52; }\n\n    .zoom-controls { display: flex; align-items: center; gap: 8px; margin-bottom: 16px; flex-wrap: wrap; }\n    .zoom-level { color: #a8a8b3; font-size: 13px; min-width: 50px; text-align: center; }\n\n    .toast {\n      position: fixed; bottom: 20px; right: 20px;\n      background: #5ba85b; color: #fff;\n      padding: 12px 24px; border-radius: 8px;\n      font-size: 14px; opacity: 0; transition: opacity 0.3s; z-index: 1000;\n    }\n    .toast.show { opacity: 1; }\n\n    .split-view {\n      display: grid;\n      grid-template-columns: 1fr 1fr;\n      gap: 16px;\n      height: calc(100vh - 160px);\n    }\n\n    .split-view .text-tree,\n    .split-view .mermaid-container { height: 100%; overflow: auto; }\n\n    @media (max-width: 800px) {\n      .split-view { grid-template-columns: 1fr; }\n    }\n\n    .loading {\n      text-align: center;\n      padding: 60px;\n      color: #a8a8b3;\n      font-size: 16px;\n    }\n\n    .loading .spinner {\n      display: inline-block;\n      width: 40px; height: 40px;\n      border: 4px solid #2a2a4a;\n      border-top: 4px solid #e94560;\n      border-radius: 50%;\n      animation: spin 1s linear infinite;\n      margin-bottom: 16px;\n    }\n\n    @keyframes spin { to { transform: rotate(360deg); } }\n  </style>\n</head>\n<body>\n  <div class="header">\n    <h1>ðŸŒ³ XML Tree Viewer</h1>\n    <span class="filename">${i}</span>\n  </div>\n\n  <div class="tabs">\n    <div class="tab active" data-tab="parsed">ðŸ“‹ Parsed Tree</div>\n    <div class="tab" data-tab="object">ðŸ”£ Object View</div>\n    <div class="tab" data-tab="diagram">ðŸ”€ Graphical Tree</div>\n    <div class="tab" data-tab="split">ðŸ“Š Split View</div>\n  </div>\n\n  <div class="content">\n    \x3c!-- Parsed Tree Panel --\x3e\n    <div id="parsed" class="panel active">\n      <div class="controls">\n        <button class="btn primary" id="copyTreeBtn">ðŸ“‹ Copy Tree</button>\n      </div>\n      <div class="text-tree" id="textTreeContent">${m(s)}</div>\n    </div>\n\n    \x3c!-- Object View Panel --\x3e\n    <div id="object" class="panel">\n      <div class="controls">\n        <button class="btn primary" id="copyJsonBtn">ðŸ“‹ Copy JSON</button>\n        <button class="btn" id="expandAllBtn">â–¶ Expand All</button>\n        <button class="btn" id="collapseAllBtn">â—€ Collapse All</button>\n      </div>\n      <div class="json-tree" id="jsonTreeContent"></div>\n    </div>\n\n    \x3c!-- Graphical Diagram Panel --\x3e\n    <div id="diagram" class="panel">\n      <div class="zoom-controls">\n        <button class="btn" id="zoomOutBtn">âˆ’</button>\n        <span class="zoom-level" id="zoomLevel">100%</span>\n        <button class="btn" id="zoomInBtn">+</button>\n        <button class="btn" id="resetZoomBtn">Reset</button>\n        <button class="btn primary" id="copyMermaidBtn">ðŸ“‹ Copy Mermaid Code</button>\n        <button class="btn primary" id="saveMermaidImageBtn">ðŸ’¾ Save as Image</button>\n      </div>\n      <div class="mermaid-container" id="mermaidContainer">\n        <div class="loading" id="mermaidLoading">\n          <div class="spinner"></div>\n          <div>Rendering diagram...</div>\n        </div>\n        <div class="mermaid-wrapper" id="mermaidWrapper" style="display:none;"></div>\n      </div>\n    </div>\n\n    \x3c!-- Split View Panel --\x3e\n    <div id="split" class="panel">\n      <div class="split-view">\n        <div class="text-tree">${m(s)}</div>\n        <div class="mermaid-container">\n          <div class="mermaid-wrapper" id="mermaidWrapperSplit"></div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div class="toast" id="toast">Copied to clipboard!</div>\n\n  <script nonce="${r}" src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"><\/script>\n  <script nonce="${r}">\n    (function() {\n      var vscode = acquireVsCodeApi();\n      var mermaidCode = ${JSON.stringify(e)};\n      var textTreeRaw = ${JSON.stringify(t)};\n      var jsonObjectData = ${JSON.stringify(n)};\n      var jsonStringForCopy = ${JSON.stringify(a)};\n      var currentZoom = 1;\n      var mermaidRendered = false;\n      var isSavingImage = false;\n\n      // Listen for extension host messages (save workflow).\n      window.addEventListener('message', function(event) {\n        var msg = event.data;\n        if (!msg || !msg.type) return;\n\n        if (msg.type === 'saveMermaidImageSession' && msg.saveId) {\n          streamMermaidPngToExtension(msg.saveId);\n          return;\n        }\n\n        if (msg.type === 'saveMermaidImageCancelled') {\n          isSavingImage = false;\n          showToast('Save cancelled.');\n          return;\n        }\n\n        if (msg.type === 'saveMermaidImageSaved') {\n          isSavingImage = false;\n          showToast('Image saved.');\n          return;\n        }\n\n        if (msg.type === 'saveMermaidImageError') {\n          isSavingImage = false;\n          showToast(msg.message || 'Failed to save image.');\n          return;\n        }\n      });\n\n      // ============================================================\n      // Tab switching\n      // ============================================================\n      function switchTab(tabName) {\n        document.querySelectorAll('.tab').forEach(function(t) { t.classList.remove('active'); });\n        document.querySelectorAll('.panel').forEach(function(p) { p.classList.remove('active'); });\n        document.querySelector('[data-tab="' + tabName + '"]').classList.add('active');\n        document.getElementById(tabName).classList.add('active');\n\n        if (tabName === 'diagram' || tabName === 'split') {\n          renderMermaid();\n        }\n      }\n\n      // Add click listeners to tabs\n      document.querySelectorAll('.tab').forEach(function(tab) {\n        tab.addEventListener('click', function() {\n          var tabName = this.getAttribute('data-tab');\n          switchTab(tabName);\n        });\n      });\n\n      // ============================================================\n      // Mermaid Rendering\n      // ============================================================\n      async function renderMermaid() {\n        if (mermaidRendered) return;\n        try {\n          mermaid.initialize({\n            startOnLoad: false,\n            theme: 'default',\n            securityLevel: 'loose',\n            flowchart: {\n              useMaxWidth: false,\n              htmlLabels: true,\n              curve: 'basis',\n              rankSpacing: 50,\n              nodeSpacing: 30,\n            }\n          });\n\n          var result = await mermaid.render('mermaid-svg', mermaidCode);\n          document.getElementById('mermaidWrapper').innerHTML = result.svg;\n          document.getElementById('mermaidWrapper').style.display = 'block';\n          document.getElementById('mermaidLoading').style.display = 'none';\n\n          var splitWrapper = document.getElementById('mermaidWrapperSplit');\n          if (splitWrapper) { splitWrapper.innerHTML = result.svg; }\n\n          mermaidRendered = true;\n        } catch (err) {\n          document.getElementById('mermaidLoading').innerHTML =\n            '<div style="color:#f44747;">Error rendering diagram: ' + err.message + '</div>' +\n            '<pre style="color:#888;margin-top:12px;font-size:12px;white-space:pre-wrap;">' +\n            mermaidCode.replace(/</g, '&lt;') + '</pre>';\n        }\n      }\n\n      // ============================================================\n      // JSON Object Tree Rendering\n      // ============================================================\n      function renderJsonTree(data, container, depth) {\n        depth = depth || 0;\n        if (data === null || data === undefined) {\n          container.innerHTML += '<span class="json-null">null</span>';\n          return;\n        }\n        if (Array.isArray(data)) {\n          renderArray(data, container, depth);\n        } else if (typeof data === 'object') {\n          renderObject(data, container, depth);\n        } else if (typeof data === 'string') {\n          container.innerHTML += '<span class="json-string">"' + escHtml(data) + '"</span>';\n        } else if (typeof data === 'number') {\n          container.innerHTML += '<span class="json-number">' + data + '</span>';\n        } else if (typeof data === 'boolean') {\n          container.innerHTML += '<span class="json-bool">' + data + '</span>';\n        }\n      }\n\n      function renderObject(obj, container, depth) {\n        var keys = Object.keys(obj);\n        var wrapper = document.createElement('div');\n        wrapper.className = 'json-collapsible';\n\n        var toggle = document.createElement('span');\n        toggle.className = 'json-toggle';\n        toggle.textContent = 'â–¼';\n        toggle.addEventListener('click', function() { toggleNode(wrapper, toggle); });\n\n        var header = document.createElement('span');\n        header.innerHTML = '<span class="json-bracket">{' + keys.length + '}</span>';\n\n        var summary = document.createElement('span');\n        summary.className = 'json-summary';\n        summary.textContent = ' {...}';\n\n        wrapper.appendChild(toggle);\n        wrapper.appendChild(header);\n        wrapper.appendChild(summary);\n\n        for (var i = 0; i < keys.length; i++) {\n          var key = keys[i];\n          var item = document.createElement('div');\n          item.className = 'json-item';\n\n          var keySpan = document.createElement('span');\n          keySpan.className = 'json-key';\n          keySpan.textContent = '"' + key + '"';\n          item.appendChild(keySpan);\n\n          item.appendChild(document.createTextNode(': '));\n\n          var val = obj[key];\n          if (val !== null && typeof val === 'object') {\n            var nested = document.createElement('span');\n            renderJsonTree(val, nested, depth + 1);\n            item.appendChild(nested);\n          } else {\n            var valSpan = document.createElement('span');\n            if (typeof val === 'string') {\n              valSpan.className = 'json-string';\n              valSpan.textContent = '"' + val + '"';\n            } else if (typeof val === 'number') {\n              valSpan.className = 'json-number';\n              valSpan.textContent = String(val);\n            } else if (typeof val === 'boolean') {\n              valSpan.className = 'json-bool';\n              valSpan.textContent = String(val);\n            } else {\n              valSpan.className = 'json-null';\n              valSpan.textContent = 'null';\n            }\n            item.appendChild(valSpan);\n          }\n          wrapper.appendChild(item);\n        }\n        container.appendChild(wrapper);\n      }\n\n      function renderArray(arr, container, depth) {\n        var wrapper = document.createElement('div');\n        wrapper.className = 'json-collapsible';\n\n        var toggle = document.createElement('span');\n        toggle.className = 'json-toggle';\n        toggle.textContent = 'â–¼';\n        toggle.addEventListener('click', function() { toggleNode(wrapper, toggle); });\n\n        var header = document.createElement('span');\n        header.innerHTML = '<span class="json-bracket">[' + arr.length + ']</span>';\n\n        var summary = document.createElement('span');\n        summary.className = 'json-summary';\n        summary.textContent = ' [...]';\n\n        wrapper.appendChild(toggle);\n        wrapper.appendChild(header);\n        wrapper.appendChild(summary);\n\n        for (var i = 0; i < arr.length; i++) {\n          var item = document.createElement('div');\n          item.className = 'json-item';\n\n          var idx = document.createElement('span');\n          idx.className = 'json-number';\n          idx.textContent = String(i);\n          item.appendChild(idx);\n\n          item.appendChild(document.createTextNode(': '));\n\n          var val = arr[i];\n          if (val !== null && typeof val === 'object') {\n            var nested = document.createElement('span');\n            renderJsonTree(val, nested, depth + 1);\n            item.appendChild(nested);\n          } else {\n            var valSpan = document.createElement('span');\n            if (typeof val === 'string') {\n              valSpan.className = 'json-string';\n              valSpan.textContent = '"' + val + '"';\n            } else if (typeof val === 'number') {\n              valSpan.className = 'json-number';\n              valSpan.textContent = String(val);\n            } else {\n              valSpan.className = 'json-null';\n              valSpan.textContent = String(val);\n            }\n            item.appendChild(valSpan);\n          }\n          wrapper.appendChild(item);\n        }\n        container.appendChild(wrapper);\n      }\n\n      function toggleNode(wrapper, toggle) {\n        wrapper.classList.toggle('collapsed');\n        toggle.textContent = wrapper.classList.contains('collapsed') ? 'â–¶' : 'â–¼';\n      }\n\n      function escHtml(s) {\n        return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');\n      }\n\n      function expandAll() {\n        document.querySelectorAll('.json-collapsible.collapsed').forEach(function(el) {\n          el.classList.remove('collapsed');\n        });\n        document.querySelectorAll('.json-toggle').forEach(function(el) {\n          el.textContent = 'â–¼';\n        });\n      }\n\n      function collapseAll() {\n        document.querySelectorAll('.json-collapsible').forEach(function(el) {\n          el.classList.add('collapsed');\n        });\n        document.querySelectorAll('.json-toggle').forEach(function(el) {\n          el.textContent = 'â–¶';\n        });\n      }\n\n      // Build JSON tree on load\n      var jsonContainer = document.getElementById('jsonTreeContent');\n      renderJsonTree(jsonObjectData, jsonContainer, 0);\n\n      // ============================================================\n      // Zoom functions\n      // ============================================================\n      function zoomDiagram(delta) {\n        currentZoom = Math.max(0.3, Math.min(3, currentZoom + delta));\n        var wrapper = document.getElementById('mermaidWrapper');\n        if (wrapper) { wrapper.style.transform = 'scale(' + currentZoom + ')'; }\n        document.getElementById('zoomLevel').textContent = Math.round(currentZoom * 100) + '%';\n      }\n\n      function resetZoom() {\n        currentZoom = 1;\n        var wrapper = document.getElementById('mermaidWrapper');\n        if (wrapper) { wrapper.style.transform = 'scale(1)'; }\n        document.getElementById('zoomLevel').textContent = '100%';\n      }\n\n      // ============================================================\n      // Copy functions\n      // ============================================================\n      function copyTextTree() {\n        navigator.clipboard.writeText(textTreeRaw);\n        showToast('Tree copied to clipboard!');\n      }\n\n      function copyMermaid() {\n        navigator.clipboard.writeText(mermaidCode);\n        showToast('Mermaid code copied to clipboard!');\n      }\n\n      function requestSaveMermaidAsImage() {\n        if (isSavingImage) return;\n\n        var wrapper = document.getElementById('mermaidWrapper');\n        var svgEl = wrapper ? wrapper.querySelector('svg') : null;\n        if (!svgEl) {\n          showToast('No diagram to save. Switch to Graphical Tree first.');\n          return;\n        }\n\n        isSavingImage = true;\n        vscode.postMessage({ type: 'requestSaveMermaidImage' });\n        showToast('Choose where to save the image...');\n      }\n\n      function sanitizeSvgForExport(svgEl) {\n        var svg = svgEl.cloneNode(true);\n        var foreignObjects = svg.querySelectorAll ? svg.querySelectorAll('foreignObject') : [];\n        if (foreignObjects && foreignObjects.length) {\n          foreignObjects.forEach(function(el) { el.remove(); });\n        }\n\n        if (!svg.getAttribute('xmlns')) { svg.setAttribute('xmlns', 'http://www.w3.org/2000/svg'); }\n        if (!svg.getAttribute('xmlns:xlink')) { svg.setAttribute('xmlns:xlink', 'http://www.w3.org/1999/xlink'); }\n        return svg;\n      }\n\n      function computeSvgBounds(svgEl) {\n        var bbox = null;\n        try {\n          bbox = svgEl.getBBox();\n        } catch (e) {\n          bbox = null;\n        }\n\n        if (!bbox || !isFinite(bbox.width) || !isFinite(bbox.height) || bbox.width <= 0 || bbox.height <= 0) {\n          var viewBox = svgEl.getAttribute('viewBox');\n          if (viewBox) {\n            var parts = viewBox.trim().split(/\\s+/).map(function(v) { return Number(v); });\n            if (parts.length === 4 && parts.every(function(v) { return isFinite(v); }) && parts[2] > 0 && parts[3] > 0) {\n              bbox = { x: parts[0], y: parts[1], width: parts[2], height: parts[3] };\n            }\n          }\n        }\n\n        if (!bbox || !isFinite(bbox.width) || !isFinite(bbox.height) || bbox.width <= 0 || bbox.height <= 0) {\n          var rect = svgEl.getBoundingClientRect();\n          if (rect && isFinite(rect.width) && isFinite(rect.height) && rect.width > 0 && rect.height > 0) {\n            bbox = { x: 0, y: 0, width: rect.width, height: rect.height };\n          }\n        }\n\n        if (!bbox || !isFinite(bbox.width) || !isFinite(bbox.height) || bbox.width <= 0 || bbox.height <= 0) {\n          bbox = { x: 0, y: 0, width: 1024, height: 768 };\n        }\n\n        return {\n          x: Math.floor(bbox.x || 0),\n          y: Math.floor(bbox.y || 0),\n          width: Math.max(1, Math.ceil(bbox.width)),\n          height: Math.max(1, Math.ceil(bbox.height)),\n        };\n      }\n\n      async function renderMermaidSvgForExport() {\n        // Mermaid diagrams rendered with htmlLabels/foreignObject frequently fail to load as an <img>\n        // when serialized. For export, render a "plain SVG" version with htmlLabels disabled.\n        var sandbox = document.getElementById('mermaidExportSandbox');\n        if (!sandbox) {\n          sandbox = document.createElement('div');\n          sandbox.id = 'mermaidExportSandbox';\n          sandbox.style.position = 'fixed';\n          sandbox.style.left = '-10000px';\n          sandbox.style.top = '-10000px';\n          sandbox.style.width = '1px';\n          sandbox.style.height = '1px';\n          sandbox.style.opacity = '0';\n          sandbox.style.pointerEvents = 'none';\n          sandbox.style.overflow = 'visible';\n          document.body.appendChild(sandbox);\n        }\n\n        // Keep styles similar to on-screen rendering but disable htmlLabels.\n        mermaid.initialize({\n          startOnLoad: false,\n          theme: 'default',\n          securityLevel: 'loose',\n          flowchart: {\n            useMaxWidth: false,\n            htmlLabels: false,\n            curve: 'basis',\n            rankSpacing: 50,\n            nodeSpacing: 30,\n          }\n        });\n\n        // Strip HTML from labels for the export render (avoids foreignObject/HTML serialization issues).\n        var exportCode = mermaidCode.replace(/<br\\s*\\/?>/gi, ' ').replace(/<\\/?b>/gi, '');\n\n        var exportId = 'mermaid-export-' + Date.now().toString(16) + Math.random().toString(16).slice(2);\n        var result = await mermaid.render(exportId, exportCode);\n        sandbox.innerHTML = result.svg;\n\n        var svgEl = sandbox.querySelector('svg');\n        if (!svgEl) {\n          throw new Error('Could not generate export SVG.');\n        }\n        return svgEl;\n      }\n\n      async function streamMermaidPngToExtension(saveId) {\n        var wrapper = document.getElementById('mermaidWrapper');\n        var svgOnScreen = wrapper ? wrapper.querySelector('svg') : null;\n        if (!svgOnScreen) {\n          isSavingImage = false;\n          showToast('No diagram to save. Switch to Graphical Tree first.');\n          vscode.postMessage({ type: 'saveMermaidImageAbort', saveId: saveId });\n          return;\n        }\n\n        var svgEl;\n        var usedFallbackSvg = false;\n        try {\n          svgEl = await renderMermaidSvgForExport();\n        } catch (e) {\n          // Fall back to the currently rendered SVG if export render fails.\n          svgEl = svgOnScreen;\n          usedFallbackSvg = true;\n        }\n\n        var bbox = computeSvgBounds(svgEl);\n        var width = bbox.width;\n        var height = bbox.height;\n\n        // Cap exported image size to keep message sizes reasonable and avoid huge PNGs.\n        var maxDim = 4096;\n        var targetW = width;\n        var targetH = height;\n        if (targetW > maxDim || targetH > maxDim) {\n          var ratio = Math.min(maxDim / targetW, maxDim / targetH);\n          targetW = Math.max(1, Math.floor(targetW * ratio));\n          targetH = Math.max(1, Math.floor(targetH * ratio));\n        }\n\n        try {\n          var svg = sanitizeSvgForExport(svgEl);\n\n          // Ensure the exported SVG is cropped to content bounds.\n          svg.setAttribute('viewBox', bbox.x + ' ' + bbox.y + ' ' + bbox.width + ' ' + bbox.height);\n          svg.setAttribute('width', String(width));\n          svg.setAttribute('height', String(height));\n\n          // Add a white background so the PNG isn't transparent.\n          var bg = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n          bg.setAttribute('x', String(bbox.x));\n          bg.setAttribute('y', String(bbox.y));\n          bg.setAttribute('width', String(bbox.width));\n          bg.setAttribute('height', String(bbox.height));\n          bg.setAttribute('fill', '#ffffff');\n          svg.insertBefore(bg, svg.firstChild);\n\n          var svgString = new XMLSerializer().serializeToString(svg);\n          var svgDataUrl = 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(svgString);\n\n          // Prefer blob URLs when possible (faster / less memory), but fall back to data: URLs.\n          var blobUrl = null;\n          try {\n            var svgBlob = new Blob([svgString], { type: 'image/svg+xml;charset=utf-8' });\n            blobUrl = URL.createObjectURL(svgBlob);\n          } catch (e) {\n            blobUrl = null;\n          }\n\n          var img = new Image();\n          var triedFallback = false;\n          img.onload = function() {\n            if (blobUrl) { URL.revokeObjectURL(blobUrl); }\n\n            try {\n              var canvas = document.createElement('canvas');\n              canvas.width = targetW;\n              canvas.height = targetH;\n              var ctx = canvas.getContext('2d');\n              if (!ctx) {\n                isSavingImage = false;\n                showToast('Canvas not supported.');\n                vscode.postMessage({ type: 'saveMermaidImageAbort', saveId: saveId });\n                return;\n              }\n\n              ctx.fillStyle = '#ffffff';\n              ctx.fillRect(0, 0, targetW, targetH);\n              ctx.drawImage(img, 0, 0, targetW, targetH);\n\n              var pngDataUrl = canvas.toDataURL('image/png');\n              var base64 = (pngDataUrl.split(',')[1] || '');\n              if (!base64) {\n                isSavingImage = false;\n                showToast('Export failed: could not encode PNG.');\n                vscode.postMessage({ type: 'saveMermaidImageAbort', saveId: saveId });\n                return;\n              }\n\n              sendBase64InChunks(saveId, base64);\n            } catch (e) {\n              isSavingImage = false;\n              showToast('Export failed: ' + (e && e.message ? e.message : 'Could not draw to canvas.'));\n              vscode.postMessage({ type: 'saveMermaidImageAbort', saveId: saveId });\n            }\n          };\n\n          img.onerror = function() {\n            if (!triedFallback && blobUrl) {\n              triedFallback = true;\n              try { URL.revokeObjectURL(blobUrl); } catch (e) {}\n              img.src = svgDataUrl;\n              return;\n            }\n\n            if (blobUrl) { try { URL.revokeObjectURL(blobUrl); } catch (e) {} }\n            isSavingImage = false;\n            showToast(usedFallbackSvg ? 'Export failed: could not load fallback SVG.' : 'Export failed: could not load SVG.');\n            vscode.postMessage({ type: 'saveMermaidImageAbort', saveId: saveId });\n          };\n\n          img.src = blobUrl || svgDataUrl;\n        } catch (e) {\n          isSavingImage = false;\n          showToast('Export failed: ' + (e && e.message ? e.message : 'Unexpected error.'));\n          vscode.postMessage({ type: 'saveMermaidImageAbort', saveId: saveId });\n        }\n      }\n\n      function sendBase64InChunks(saveId, base64) {\n        // Chunked transfer prevents corruption when the PNG is larger than the webview IPC limit.\n        // Keep this comfortably under common IPC limits (varies by VS Code/electron).\n        var chunkSize = 16000; // characters\n        var total = Math.ceil(base64.length / chunkSize);\n        var index = 0;\n\n        function sendNext() {\n          if (index >= total) return;\n          var chunk = base64.slice(index * chunkSize, (index + 1) * chunkSize);\n          vscode.postMessage({ type: 'saveMermaidImageChunk', saveId: saveId, index: index, total: total, chunk: chunk });\n          index += 1;\n          if (index < total) { setTimeout(sendNext, 0); }\n        }\n\n        sendNext();\n      }\n\n      function copyJsonObject() {\n        navigator.clipboard.writeText(jsonStringForCopy);\n        showToast('JSON copied to clipboard!');\n      }\n\n      function showToast(message) {\n        var toast = document.getElementById('toast');\n        toast.textContent = message;\n        toast.classList.add('show');\n        setTimeout(function() { toast.classList.remove('show'); }, 2000);\n      }\n\n      // ============================================================\n      // Button event listeners\n      // ============================================================\n      document.getElementById('copyTreeBtn').addEventListener('click', copyTextTree);\n      document.getElementById('copyJsonBtn').addEventListener('click', copyJsonObject);\n      document.getElementById('expandAllBtn').addEventListener('click', expandAll);\n      document.getElementById('collapseAllBtn').addEventListener('click', collapseAll);\n      document.getElementById('zoomOutBtn').addEventListener('click', function() { zoomDiagram(-0.1); });\n      document.getElementById('zoomInBtn').addEventListener('click', function() { zoomDiagram(0.1); });\n      document.getElementById('resetZoomBtn').addEventListener('click', resetZoom);\n      document.getElementById('copyMermaidBtn').addEventListener('click', copyMermaid);\n      document.getElementById('saveMermaidImageBtn').addEventListener('click', requestSaveMermaidAsImage);\n\n    })();\n  <\/script>\n</body>\n</html>`}}function f(t){const e={};if(0===t.children.length&&t.textContent)return t.textContent;const n={};for(const e of t.children)n[e.tagName]||(n[e.tagName]=[]),n[e.tagName].push(e);for(const[t,i]of Object.entries(n))1===i.length?e[t]=f(i[0]):e[t]=i.map(t=>f(t));for(const[n,i]of Object.entries(t.attributes))e[`_${n}`]=i;return t.textContent&&t.children.length>0&&(e["#text"]=t.textContent),e}function m(t){return t.replace(/(&lt;\/?[\w:.-]+(?:\s[^&]*?)?&gt;)/g,'<span class="tag">$1</span>').replace(/([\w]+)=(&quot;[^&]*?&quot;)/g,'<span class="attr">$1</span>=<span class="value">$2</span>').replace(/(â†’\s*&quot;[^&]*?&quot;)/g,'<span class="value">$1</span>').replace(/([â”œâ””â”‚â”€]+)/g,'<span class="connector">$1</span>')}e.XmlTreePanel=d},9234(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parseXml=function(t){const e=r(new i.XMLParser({ignoreAttributes:!1,attributeNamePrefix:"@_",textNodeName:"#text",preserveOrder:!0,commentPropName:"#comment",trimValues:!0}).parse(t));return 1===e.length?e[0]:{tagName:"(document)",attributes:{},textContent:"",children:e}},e.generateTextTree=function t(e,n="",i=!0,r=!0){let s="";const a=r?"":i?"â””â”€â”€ ":"â”œâ”€â”€ ",o=r?"":i?"    ":"â”‚   ";let l=`<${e.tagName}>`;const c=Object.entries(e.attributes).map(([t,e])=>`${t}="${e}"`).join(" ");c&&(l=`<${e.tagName} ${c}>`),e.textContent&&0===e.children.length&&(l+=` â†’ "${e.textContent}"`),s+=`${n}${a}${l}\n`;for(let i=0;i<e.children.length;i++){s+=t(e.children[i],n+o,i===e.children.length-1,!1)}return s};const i=n(6454);function r(t){const e=[];for(const n of t)for(const t of Object.keys(n)){if("?xml"===t)continue;if(":@"===t)continue;if("#text"===t)continue;const i={tagName:t,attributes:{},textContent:"",children:[]};if(n[":@"])for(const[t,e]of Object.entries(n[":@"])){const n=t.replace("@_","");i.attributes[n]=String(e)}const s=n[t];if(Array.isArray(s))for(const t of s)if(void 0!==t["#text"])i.textContent=String(t["#text"]);else{const e=r([t]);i.children.push(...e)}e.push(i)}return e}},112(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CData=void 0;const i=n(2176);class r{value;constructor(t){this.value=t}setValue(t){this.value=t}getValue(){return this.value}getNodeType(){return i.Constants.CDATA_SECTION_NODE}toString(){return"<![CDATA["+this.value+"]]>"}equals(t){return t instanceof r&&this.value===t.value}}e.CData=r},8922(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Catalog=void 0;const i=n(3024),r=n(6760),s=n(1882),a=n(9350),o=n(2823);class l{systemCatalog;publicCatalog;uriCatalog;dtdCatalog;uriRewrites;systemRewrites;workDir;base;constructor(t){if(!(0,r.isAbsolute)(t))throw new Error("Catalog file must be absolute: "+t);if(!(0,i.existsSync)(t))throw new Error("Catalog file "+t+" not found");this.systemCatalog=new Map,this.publicCatalog=new Map,this.uriCatalog=new Map,this.dtdCatalog=new Map,this.uriRewrites=new Array,this.systemRewrites=new Array,this.workDir=(0,r.dirname)(t),this.base="";let e=new s.DOMBuilder,n=new a.SAXParser;n.setContentHandler(e),n.parseFile(t);let o=e.getDocument();if(!o)throw new Error("Catalog file "+t+" is empty");let l=o.getRoot();if(!l)throw new Error("Catalog file "+t+" is empty");if("catalog"!==l.getName())throw new Error("Catalog root element must be <catalog>");this.recurse(l)}recurse(t){for(let e of t.getChildren()){let t=this.base,n=e.getAttribute("xml:base");if(n&&(this.base=n.getValue(),this.base.endsWith("/")||(this.base+="/"),(0,r.isAbsolute)(this.base)||(this.base=(0,r.resolve)(this.workDir,this.base)),!(0,i.existsSync)(this.base)))throw new Error("Invalid xml:base: "+this.base);if("public"===e.getName()){let t=e.getAttribute("publicId");if(!t)throw new Error("publicId attribute is required for <public>");let n=t.getValue();if(n.startsWith("urn:publicid:")&&(n=this.unwrapUrn(n)),!this.publicCatalog.has(n)){let t=e.getAttribute("uri");if(!t)throw new Error("uri attribute is required for <public>");let s=this.makeAbsolute(t.getValue());if((0,i.existsSync)(s)&&(this.publicCatalog.set(n,s),s.endsWith(".dtd")||s.endsWith(".ent")||s.endsWith(".mod"))){let t=(0,r.basename)(s);this.dtdCatalog.has(t)||this.dtdCatalog.set(t,s)}}}if("system"===e.getName()){let t=e.getAttribute("uri");if(!t)throw new Error("uri attribute is required for <system>");let n=this.makeAbsolute(t.getValue());if((0,i.existsSync)(n)){let t=e.getAttribute("systemId");if(!t)throw new Error("systemId attribute is required for <system>");if(this.systemCatalog.set(t.getValue(),n),n.endsWith(".dtd")){let t=(0,r.basename)(n);this.dtdCatalog.has(t)||this.dtdCatalog.set(t,n)}}}if("uri"===e.getName()){let t=e.getAttribute("uri");if(!t)throw new Error("uri attribute is required for <uri>");let n=this.makeAbsolute(t.getValue());if((0,i.existsSync)(n)){let t=e.getAttribute("name");if(!t)throw new Error("name attribute is required for <uri>");if(this.uriCatalog.set(t.getValue(),n),n.endsWith(".dtd")||n.endsWith(".ent")||n.endsWith(".mod")){let t=(0,r.basename)(n);this.dtdCatalog.has(t)||this.dtdCatalog.set(t,n)}}}if("rewriteURI"===e.getName()){let t=e.getAttribute("rewritePrefix");if(!t)throw new Error("rewritePrefix attribute is required for <rewriteURI>");let n=this.makeAbsolute(t.getValue()),i=e.getAttribute("uriStartString");if(!i)throw new Error("uriStartString attribute is required for <rewriteURI>");let r=[i.getValue(),n];this.uriRewrites.includes(r)||this.uriRewrites.push(r)}if("rewriteSystem"===e.getName()){let t=e.getAttribute("rewritePrefix");if(!t)throw new Error("rewritePrefix attribute is required for <rewriteSystem>");let n=this.makeAbsolute(t.getValue()),i=e.getAttribute("systemIdStartString");if(!i)throw new Error("systemIdStartString attribute is required for <rewriteSystem>");let r=[i.getValue(),n];this.systemRewrites.includes(r)||this.systemRewrites.push(r)}if("nextCatalog"===e.getName()){let t=e.getAttribute("catalog");if(!t)throw new Error("catalog attribute is required for <nextCatalog>");let n=this.makeAbsolute(t.getValue()),i=new l(n),r=i.getSystemCatalog();r.forEach((t,e)=>{this.systemCatalog.has(e)||this.systemCatalog.set(e,t)}),r=i.getPublicCatalog(),r.forEach((t,e)=>{this.publicCatalog.has(e)||this.publicCatalog.set(e,t)}),r=i.getUriCatalog(),r.forEach((t,e)=>{this.uriCatalog.has(e)||this.uriCatalog.set(e,t)}),r=i.getDtdCatalog(),r.forEach((t,e)=>{this.dtdCatalog.has(e)||this.dtdCatalog.set(e,t)});let s=i.getUriRewrites();s.forEach(t=>{this.uriRewrites.includes(t)||this.uriRewrites.push(t)}),s=i.getSystemRewrites(),s.forEach(t=>{this.systemRewrites.includes(t)||this.systemRewrites.push(t)})}this.recurse(e),this.base=t}}makeAbsolute(t){let e=this.base+t;return(0,r.isAbsolute)(e)?this.base+t:""!==this.base?(0,r.resolve)(this.base,t):(0,r.resolve)(this.workDir,t)}unwrapUrn(t){if(!t.startsWith("urn:publicid:"))return t;let e=t.trim().substring(13);return e=o.XMLUtils.replaceAll(e,"+"," "),e=o.XMLUtils.replaceAll(e,":","//"),e=o.XMLUtils.replaceAll(e,";","::"),e=o.XMLUtils.replaceAll(e,"%2B","+"),e=o.XMLUtils.replaceAll(e,"%3A",":"),e=o.XMLUtils.replaceAll(e,"%2F","/"),e=o.XMLUtils.replaceAll(e,"%3B",";"),e=o.XMLUtils.replaceAll(e,"%27","'"),e=o.XMLUtils.replaceAll(e,"%3F","?"),e=o.XMLUtils.replaceAll(e,"%23","#"),o.XMLUtils.replaceAll(e,"%25","%")}getSystemCatalog(){return this.systemCatalog}getPublicCatalog(){return this.publicCatalog}getUriCatalog(){return this.uriCatalog}getDtdCatalog(){return this.dtdCatalog}getUriRewrites(){return this.uriRewrites}getSystemRewrites(){return this.systemRewrites}resolveEntity(t,e){if(t){let e=this.matchPublic(t);if(e)return e}return this.matchSystem(e)}matchSystem(t){if(t){for(let e of this.systemRewrites)t.startsWith(e[0])&&(t=e[1]+t.substring(e[0].length));if(this.systemCatalog.has(t))return this.systemCatalog.get(t);let e=(0,r.basename)(t);if(this.dtdCatalog.has(e))return this.dtdCatalog.get(e)}}matchPublic(t){if(t.startsWith("urn:publicid:")&&(t=this.unwrapUrn(t)),this.publicCatalog.has(t))return this.publicCatalog.get(t)}matchURI(t){if(t){for(let e of this.uriRewrites)t.startsWith(e[0])&&(t=e[1]+t.substring(e[0].length));if(this.uriCatalog.has(t))return this.uriCatalog.get(t)}}}e.Catalog=l},2176(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Constants=void 0,e.Constants=class{static DOCUMENT_NODE=0;static ELEMENT_NODE=1;static ATTRIBUTE_NODE=2;static CDATA_SECTION_NODE=3;static COMMENT_NODE=4;static PROCESSING_INSTRUCTION_NODE=5;static TEXT_NODE=6;static ENTITY_DECL_NODE=7;static XML_DECLARATION_NODE=8;static ATTRIBUTE_LIST_DECL_NODE=9;static DOCUMENT_TYPE_NODE=10;static ATTRIBUTE_DECL_NODE=11;static ELEMENT_DECL_NODE=12;static INTERNAL_SUBSET_NODE=13;static NOTATION_DECL_NODE=14;static RELAXNG_NS_URI="http://relaxng.org/ns/structure/1.0";static RELAXNG_COMPATIBILITY_NS_URI="http://relaxng.org/ns/compatibility/annotations/1.0";static XML_SCHEMA_INSTANCE_NS_URI="http://www.w3.org/2001/XMLSchema-instance"}},1882(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DOMBuilder=void 0;const i=n(112),r=n(2192),s=n(9850),a=n(7871),o=n(9162),l=n(6245),c=n(3429),h=n(2714),u=n(2823),d=n(449),f=n(8717);e.DOMBuilder=class{inCdData=!1;currentCData=new i.CData("");document;stack=[];catalog;dtdParser;grammar;initialize(){this.document=new l.XMLDocument,this.stack=new Array,this.inCdData=!1}setGrammar(t){this.grammar=t,t instanceof f.DTDGrammar&&(this.dtdParser?this.dtdParser.setGrammar(t):this.dtdParser=new d.DTDParser(t))}setCatalog(t){this.catalog=t}getDocument(){return this.document}startDocument(){}endDocument(){}xmlDeclaration(t,e,n){let i=new o.XMLDeclaration(t,e,n);this.document?.setXmlDeclaration(i)}startElement(t,e){let n=new h.XMLElement(t);e.forEach(t=>{n.setAttribute(t)}),this.stack.length>0?this.stack[this.stack.length-1].addElement(n):this.document?.setRoot(n),this.stack.push(n)}endElement(t){this.stack.pop()}internalSubset(t){let e=this.document?.getDocumentType();e&&e.setInternalSubset(t)}characters(t){if(this.inCdData)return void this.currentCData.setValue(this.currentCData.getValue()+t);let e=new s.TextNode(t);this.stack.length>0?this.stack[this.stack.length-1].addTextNode(e):this.document?.addTextNode(e)}ignorableWhitespace(t){let e=new s.TextNode(t);this.stack.length>0?this.stack[this.stack.length-1].addTextNode(e):this.document?.addTextNode(e)}comment(t){let e=new a.XMLComment(t);this.stack.length>0?this.stack[this.stack.length-1].addComment(e):this.document?.addComment(e)}processingInstruction(t,e){let n=new r.ProcessingInstruction(t,e);this.stack.length>0?this.stack[this.stack.length-1].addProcessingInstruction(n):this.document?.addProcessingInstruction(n)}parseXmlModel(t){let e=new Map,n=[],i="";for(;-1!=t.indexOf("=");){let e=0;for(;e<t.length;e++){let n=t[e];if(u.XMLUtils.isXmlSpace(n)||"="===n)break}for(;e<t.length;e++){let n=t[e];if(""!==i||"'"!==n&&'"'!==n){if(n===i)break}else i=n}let r=t.substring(0,e+1).trim();n.push(r),t=t.substring(r.length).trim(),i=""}return n.forEach(t=>{let n=t.indexOf("=");if(-1===n)throw new Error("Malformed attributes list");let i=t.substring(0,n).trim(),r=t.substring(n+2,t.length-1);e.set(i,r)}),e}startCDATA(){this.currentCData=new i.CData(""),this.inCdData=!0}endCDATA(){if(!(this.stack.length>0))throw new Error("CData section outside of root element");this.stack[this.stack.length-1].addCData(this.currentCData),this.inCdData=!1}startDTD(t,e,n){let i=new c.XMLDocumentType(t,e,n);if(this.document?.setDocumentType(i),this.catalog){const t=this.catalog.resolveEntity(e,n);if(t){this.dtdParser||(this.dtdParser=new d.DTDParser);const e=this.dtdParser.parseDTD(t);this.setGrammar(e)}}}endDTD(){}getGrammar(){return this.grammar}skippedEntity(t){const e=this.grammar?.resolveEntity(t);if(e&&e.length>0)this.characters(e);else{if(this.grammar instanceof f.DTDGrammar){const e=this.grammar.getEntity(t);if(e&&e.isExternal()&&this.dtdParser)try{const t=this.dtdParser.loadExternalEntity(e.getPublicId(),e.getSystemId(),!0);if(t.length>0)return e.setValue(t),void this.characters(t)}catch(e){throw new Error(`Could not resolve external entity "${t}": ${e.message}`)}}this.characters("&"+t+";")}}}},6964(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FileReader=void 0;const i=n(3024),r=n(7975);class s{fileHandle;encoding;blockSize;fileSize;position;firstRead;decoder;filePath;constructor(t,e){this.filePath=t;let n=(0,i.statSync)(t,{bigint:!1,throwIfNoEntry:!0});this.fileSize=n.size,this.blockSize=n.blksize&&n.blksize>0?n.blksize:8192,this.fileHandle=(0,i.openSync)(t,"r"),this.encoding=e||s.detectEncoding(t),this.position=0,this.firstRead=!0,this.initializeDecoder()}static detectEncoding(t){const e=(0,i.openSync)(t,"r"),n=Buffer.alloc(3),r=(0,i.readSync)(e,n,0,3,0);if((0,i.closeSync)(e),0===r)return"utf8";const s=n.subarray(0,r),a=Buffer.from([239,187,191]),o=Buffer.from([255,254]),l=Buffer.from([254,255]);return s.length>=a.length&&0===s.compare(a,0,a.length,0,a.length)?"utf8":s.length>=o.length&&0===s.compare(o,0,o.length,0,o.length)||s.length>=l.length&&0===s.compare(l,0,l.length,0,l.length)?"utf16le":"utf8"}getEncoding(){return this.encoding}setEncoding(t){this.encoding=t,this.initializeDecoder(),this.firstRead=!0}read(){let t,e=Buffer.alloc(this.blockSize),n=this.blockSize<=this.fileSize-this.position?this.blockSize:this.fileSize-this.position,r=(0,i.readSync)(this.fileHandle,e,0,n,this.position);this.position+=r;try{if(this.decoder){const n=this.position<this.fileSize;t=this.decoder.decode(e.subarray(0,r),{stream:n})}else t=e.toString(this.encoding,0,r)}catch(t){const e=t.message||"invalid byte sequence";throw new Error(`Invalid ${this.encoding} data in "${this.filePath}": ${e}`)}return this.firstRead?this.handleInitialChunk(t):t}handleInitialChunk(t){return this.firstRead=!1,!this.decoder&&t.length>0&&65279===t.codePointAt(0)?t.substring(1):t}dataAvailable(){return this.position<this.fileSize}getFileSize(){return this.fileSize}closeFile(){(0,i.closeSync)(this.fileHandle)}initializeDecoder(){"utf8"===this.encoding?this.decoder=new r.TextDecoder("utf-8",{fatal:!0}):"utf16le"===this.encoding?this.decoder=new r.TextDecoder("utf-16le",{fatal:!0}):this.decoder=void 0}}e.FileReader=s},7060(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Indenter=void 0;const i=n(2176),r=n(9850),s=n(2823);e.Indenter=class{numSpaces;indentLevel;constructor(t,e){this.numSpaces=t,this.indentLevel=void 0!==e?e:1}setSpaces(t){this.numSpaces=t}setLevel(t){this.indentLevel=t}indent(t){let e=t.getAttribute("xml:space");e&&"preserve"===e.getValue()||(this.hasText(t)||this.indentElement(t),this.indentLevel++,t.getChildren().forEach(t=>{this.indent(t)}),this.indentLevel--)}indentElement(t){let e="\n",n="\n";for(let t=0;t<this.indentLevel*this.numSpaces;t++)e+=" ";for(let t=0;t<(this.indentLevel-1)*this.numSpaces;t++)n+=" ";let i=new Array;t.getContent().forEach(t=>{t instanceof r.TextNode||(i.push(new r.TextNode(e)),i.push(t))}),0!==i.length&&i.push(new r.TextNode(n)),t.setContent(i)}hasText(t){let e=!1;return t.getContent().forEach(t=>{if(t.getNodeType()===i.Constants.TEXT_NODE){let n=t.getValue(),i=n.length;for(let t=0;t<i;t++)if(!s.XMLUtils.isXmlSpace(n.charAt(t))){e=!0;break}}}),e}}},9080(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NeedMoreDataError=void 0;class n extends Error{constructor(){super("Need more data to continue parsing"),Object.setPrototypeOf(this,n.prototype)}}e.NeedMoreDataError=n},2192(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ProcessingInstruction=void 0;const i=n(2176);class r{target;data;constructor(t,e){this.target=t,this.data=e}getTarget(){return this.target}getData(){return this.data}setData(t){this.data=t}getNodeType(){return i.Constants.PROCESSING_INSTRUCTION_NODE}toString(){return"<?"+this.target+" "+this.data+"?>"}equals(t){return t instanceof r&&this.target===t.target&&this.data===t.data}}e.ProcessingInstruction=r},8271(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RelaxNGParser=void 0;const i=n(3024),r=n(6760),s=n(3136),a=n(2176),o=n(1882),l=n(9350),c=n(2966),h=n(2714);class u{catalog;baseDir;root;defaultPrefix="";defaultNamespace=a.Constants.RELAXNG_NS_URI;definitions=new Map;elements=[];divsRemoved=!1;constructor(t,e){const n=(0,r.isAbsolute)(t)?t:(0,r.resolve)(t);this.baseDir=(0,r.dirname)(n);const i=new o.DOMBuilder,s=new l.SAXParser;e&&(this.catalog=e,s.setCatalog(this.catalog)),s.setContentHandler(i),s.parseFile(n);const c=i.getDocument()?.getRoot();if(!c)throw new Error(`RelaxNG schema "${n}" could not be parsed`);this.root=c,this.defaultPrefix=this.getPrefix(this.root);const h=this.root.getAttribute("xmlns");if(h)this.defaultNamespace=h.getValue();else if(this.defaultPrefix){const t=this.root.getAttribute(`xmlns:${this.defaultPrefix}`);t&&(this.defaultNamespace=t.getValue())}this.defaultNamespace||(this.defaultNamespace=a.Constants.RELAXNG_NS_URI),this.removeForeign(this.root),this.replaceExternalRef(this.root),this.replaceIncludes(this.root);do{this.divsRemoved=!1,this.removeDivs(this.root)}while(this.divsRemoved);this.nameAttribute(this.root,new Map)}getElements(){const t=new Map;this.definitions=new Map,this.harvestDefinitions(this.root),this.elements=[],this.harvestElements(this.root);for(const e of this.elements){const n=this.findChildByLocalName(e,"name");if(!n)continue;const i=this.extractNameInfo(n);if(!i)continue;const r=new Map,s=new Set;this.collectAttributeDefaultsFromPattern(e,r,s,!0),0!==r.size&&this.storeElementDefaults(t,i,r)}return t}storeElementDefaults(t,e,n){if(t.set(e.lexicalName,this.cloneAttributeDefaultMap(n)),t.has(e.localName)||t.set(e.localName,this.cloneAttributeDefaultMap(n)),e.namespace){const i=this.buildAttributeKey(e.localName,e.namespace);t.set(i,this.cloneAttributeDefaultMap(n))}}cloneAttributeDefaultMap(t){const e=new Map;return t.forEach((t,n)=>{e.set(n,{localName:t.localName,namespace:t.namespace,lexicalName:t.lexicalName,value:t.value})}),e}collectAttributeDefaultsFromPattern(t,e,n,i){const r=this.getLocalNameFromElement(t);if("attribute"===r)return void this.addAttributeDefault(t,e);if("ref"===r||"parentRef"===r){const r=t.getAttribute("name"),s=r?.getValue();if(!s||n.has(s))return;n.add(s);const a=this.definitions.get(s);return void(a&&this.collectAttributeDefaultsFromPattern(a,e,n,i))}let s=i;if("element"===r){if(!i)return;s=!1}for(const i of t.getChildren())i.getNodeType()===a.Constants.ELEMENT_NODE&&this.collectAttributeDefaultsFromPattern(i,e,n,s)}addAttributeDefault(t,e){const n=this.findDefaultValue(t);if(void 0===n)return;const i=this.findChildByLocalName(t,"name");if(!i)return;const r=this.extractNameInfo(i);if(!r)return;const s={localName:r.localName,namespace:r.namespace,lexicalName:r.lexicalName,value:n};this.setAttributeDefault(e,s)}extractNameInfo(t){const e=t.getText().trim();if(!e)return;const n=t.getAttribute("ns");let i=n?n.getValue():void 0,r=e;const s=e.indexOf(":");return-1===s||(r=e.substring(s+1),i)||"xml"===e.substring(0,s)&&(i="http://www.w3.org/XML/1998/namespace"),{lexicalName:e,localName:r,namespace:i&&i.length>0?i:void 0}}findDefaultValue(t){for(const e of t.getAttributes())if("defaultValue"===this.getLocalNameFromString(e.getName()))return e.getValue();return this.findDefaultValueFromChildren(t)}findDefaultValueFromChildren(t){const e=[];for(const n of t.getChildren())n.getNodeType()===a.Constants.ELEMENT_NODE&&e.push(n);for(;e.length>0;){const t=e.pop();if("defaultValue"===this.getLocalNameFromElement(t))return t.getText().trim();for(const n of t.getChildren())n.getNodeType()===a.Constants.ELEMENT_NODE&&e.push(n)}}setAttributeDefault(t,e){const n=this.buildAttributeKey(e.localName,e.namespace),i=[];t.forEach((t,r)=>{if(t.localName!==e.localName)return;const s=t.namespace===e.namespace;s&&r===n||(s||e.namespace&&!t.namespace)&&i.push(r)});for(const e of i)t.delete(e);t.set(n,{localName:e.localName,namespace:e.namespace,lexicalName:e.lexicalName,value:e.value})}buildAttributeKey(t,e){return e?e+"|"+t:t}removeForeign(t){const e=[];for(const n of t.getContent()){const t=n.getNodeType();if(t!==a.Constants.TEXT_NODE&&t!==a.Constants.PROCESSING_INSTRUCTION_NODE){if(t===a.Constants.ELEMENT_NODE){const t=n;if(!this.isRelaxNGElement(t)){this.isCompatibilityAnnotation(t)&&e.push(t);continue}this.removeForeign(t),e.push(t)}}else e.push(n)}t.setContent(e)}replaceExternalRef(t){const e=[];for(const n of t.getContent()){const t=n.getNodeType();if(t===a.Constants.TEXT_NODE){const t=n;this.isBlankText(t)||e.push(n);continue}if(t!==a.Constants.PROCESSING_INSTRUCTION_NODE){if(t===a.Constants.ELEMENT_NODE){const t=n;if("externalRef"===this.getLocalNameFromElement(t)){const n=t.getAttribute("href"),i=n?.getValue()??"",r=this.resolveHref(i);if(!r)throw new Error(`RelaxNG externalRef target not found: ${i}`);const s=new u(r,this.catalog);e.push(s.getRootElement());continue}this.replaceIncludes(t),e.push(t)}}else e.push(n)}t.setContent(e)}replaceIncludes(t){const e=[];for(const n of t.getContent()){const t=n.getNodeType();if(t===a.Constants.TEXT_NODE){const t=n;this.isBlankText(t)||e.push(n);continue}if(t!==a.Constants.PROCESSING_INSTRUCTION_NODE){if(t===a.Constants.ELEMENT_NODE){const t=n;if("include"===this.getLocalNameFromElement(t)){const n=t.getAttribute("href"),i=n?.getValue()??"",r=this.resolveHref(i);if(!r)throw new Error(`RelaxNG include target not found: ${i}`);const s=new u(r,this.catalog),a=this.createRelaxNGElement("div");a.addElement(s.getRootElement());for(const e of t.getChildren())a.addElement(e);e.push(a);continue}this.replaceIncludes(t),e.push(t)}}else e.push(n)}t.setContent(e)}removeDivs(t){const e=[];for(const n of t.getContent())if(n.getNodeType()===a.Constants.ELEMENT_NODE){const t=n;"div"===this.getLocalNameFromElement(t)?(e.push(...t.getContent()),this.divsRemoved=!0):e.push(t)}else e.push(n);t.setContent(e);for(const e of t.getChildren())this.removeDivs(e)}harvestDefinitions(t){if("define"===this.getLocalNameFromElement(t)){const e=t.getAttribute("name"),n=e?.getValue();if(n)if(this.definitions.has(n)){const e=this.definitions.get(n),i=[...e.getContent(),...t.getContent()];e.setContent(i)}else this.definitions.set(n,t)}for(const e of t.getChildren())this.harvestDefinitions(e)}harvestElements(t){"element"===this.getLocalNameFromElement(t)&&this.findChildByLocalName(t,"name")&&this.elements.push(t);for(const e of t.getChildren())this.harvestElements(e)}nameAttribute(t,e){const n=this.augmentNamespaceContext(e,t),i=this.getLocalNameFromElement(t),r="element"===i,s="attribute"===i;if((r||s)&&t.hasAttribute("name")){const e=t.getAttribute("name")?.getValue()??"",i=this.createRelaxNGElement("name");i.addString(e);const a=t.getAttribute("ns");if(a)i.setAttribute(new c.XMLAttribute("ns",a.getValue())),t.removeAttribute("ns");else{const t=this.resolveNamespaceBinding(e,n,r,s);t&&i.setAttribute(new c.XMLAttribute("ns",t))}t.removeAttribute("name");const o=[i,...t.getContent()];t.setContent(o)}for(const e of t.getChildren())this.nameAttribute(e,n)}augmentNamespaceContext(t,e){const n=new Map(t);for(const t of e.getAttributes()){const e=t.getName();if("xmlns"!==e){if(e.startsWith("xmlns:")){const i=e.substring(6);n.set(i,t.getValue())}}else n.set("",t.getValue())}return n.has("xml")||n.set("xml","http://www.w3.org/XML/1998/namespace"),n}resolveNamespaceBinding(t,e,n,i){const r=t.indexOf(":");if(-1===r){if(n)return e.get("")??void 0;if(i)return;return e.get("")??void 0}const s=t.substring(0,r);return e.get(s)}resolveHref(t){if(!t)return;let e=t;if(e.startsWith("file://"))try{e=(0,s.fileURLToPath)(e)}catch{return}const n=[];if(this.catalog){const t=this.catalog.matchSystem(e),i=this.catalog.matchURI(e);n.push(t),n.push(i)}n.push(e);for(const t of n){const e=this.normalizeResolvedPath(t);if(e)return e}}normalizeResolvedPath(t){if(!t)return;let e=t;if(e.startsWith("file://"))try{e=(0,s.fileURLToPath)(e)}catch{return}if((0,r.isAbsolute)(e))return(0,i.existsSync)(e)?e:void 0;const n=(0,r.resolve)(this.baseDir,e);return(0,i.existsSync)(n)?n:void 0}createRelaxNGElement(t){const e=this.defaultPrefix?`${this.defaultPrefix}:${t}`:t;return new h.XMLElement(e)}isBlankText(t){return 0===t.getValue().trim().length}getLocalNameFromElement(t){return this.getLocalNameFromString(t.getName())}getLocalNameFromString(t){const e=t.indexOf(":");return-1===e?t:t.substring(e+1)}getPrefix(t){const e=t.getName(),n=e.indexOf(":");return-1===n?"":e.substring(0,n)}isCompatibilityAnnotation(t){return"defaultValue"===this.getLocalNameFromElement(t)}isRelaxNGElement(t){const e=this.getPrefix(t);if(this.defaultPrefix){if(e!==this.defaultPrefix)return!1}else if(e)return!1;const n=t.getAttribute("xmlns");if(n){const t=n.getValue();if(t&&t!==this.defaultNamespace&&t!==a.Constants.RELAXNG_NS_URI)return!1}if(this.defaultPrefix){const e=t.getAttribute(`xmlns:${this.defaultPrefix}`);if(e){const t=e.getValue();if(t&&t!==this.defaultNamespace&&t!==a.Constants.RELAXNG_NS_URI)return!1}}return!0}findChildByLocalName(t,e){for(const n of t.getChildren())if(this.getLocalNameFromElement(n)===e)return n}getRootElement(){return this.root}}e.RelaxNGParser=u},9350(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SAXParser=void 0;const i=n(3024),r=n(6760),s=n(3136),a=n(2176),o=n(6964),l=n(9080),c=n(8271),h=n(6110),u=n(5235),d=n(2966),f=n(2823),m=n(3020),p=n(8717),g=n(449);class b{static SUPPORTED_ENCODINGS=new Map([["UTF-8","UTF-8"],["UTF-16","UTF-16"],["UTF-16LE","UTF-16LE"],["UTF-16BE","UTF-16BE"]]);static ENCODING_NAME_PATTERN=/^[A-Za-z][A-Za-z0-9._-]*$/;contentHandler;reader;pointer;buffer="";elementStack;elementNameStack=[];childrenNames=[];characterRun;rootParsed;xmlVersion;currentFile;catalog;validating=!1;relaxNGDefaultAttributes=new Map;schemaDefaultAttributes=new Map;processedSchemaLocations=new Set;failedSchemaLocations=new Set;namespaceContextStack=[];processedNamespaces=new Set;failedNamespaces=new Set;isRelaxNG=!1;static DEFAULT_VIRTUAL_FILENAME="__inmemory__.xml";streamingMode=!1;sourceEnded=!1;documentStarted=!1;documentEnded=!1;inCDATASection=!1;pendingCR=!1;readingFromFile=!1;internalSubsetApplied=!1;xmlDeclarationParsed=!1;leadingContentBeforeXmlDeclaration=!1;schemaLoadingEnabled=!0;constructor(){this.characterRun="",this.elementStack=0,this.elementNameStack=[],this.childrenNames=[],this.pointer=0,this.rootParsed=!1,this.xmlVersion="1.0",this.streamingMode=!1,this.sourceEnded=!1,this.documentStarted=!1,this.documentEnded=!1,this.inCDATASection=!1,this.pendingCR=!1,this.readingFromFile=!1,this.internalSubsetApplied=!1,this.xmlDeclarationParsed=!1,this.leadingContentBeforeXmlDeclaration=!1,this.schemaLoadingEnabled=!0}setContentHandler(t){this.contentHandler=t,this.catalog&&this.contentHandler.setCatalog(this.catalog)}setCatalog(t){this.catalog=t,this.contentHandler?.setCatalog(t)}setValidating(t){this.validating=t}setSchemaLoadingEnabled(t){this.schemaLoadingEnabled=t}parseFile(t,e){if(!this.contentHandler)throw new Error("ContentHandler not set");const n=(0,r.isAbsolute)(t)?t:(0,r.resolve)(t),i=e??o.FileReader.detectEncoding(n),s=new o.FileReader(n,i);this.initializeParsing(s,n),this.processSynchronous()}parseString(t,e){if(!this.contentHandler)throw new Error("ContentHandler not set");const n=new u.StringReader(t),i=this.resolveVirtualPath(e);this.initializeParsing(n,i),this.processSynchronous()}parseStream(t,e){if(!this.contentHandler)return Promise.reject(new Error("ContentHandler not set"));const n=e?.encoding??"utf8",i=new h.StreamReader(n),r=this.resolveVirtualPath(e);return this.initializeParsing(i,r),new Promise((e,r)=>{const s=()=>{t.removeListener("data",o),t.removeListener("end",c),t.removeListener("error",h)},a=t=>{try{this.processStreaming(t),this.documentEnded?(s(),this.reader?.closeFile(),e()):t&&(s(),this.reader?.closeFile(),r(new Error("Malformed XML document: unexpected end of stream")))}catch(t){if(t instanceof l.NeedMoreDataError)return;s(),this.reader?.closeFile(),r(t)}},o=t=>{i.enqueue(t),a(!1)},c=()=>{i.markFinished(),a(!0)},h=t=>{s(),this.reader?.closeFile(),r(t)};t.setEncoding(n),t.on("data",o),t.once("end",c),t.once("error",h)})}initializeParsing(t,e){this.reader=t;const n=(0,r.resolve)(process.cwd(),b.DEFAULT_VIRTUAL_FILENAME);this.currentFile=e||n,this.relaxNGDefaultAttributes=new Map,this.schemaDefaultAttributes=new Map,this.processedSchemaLocations=new Set,this.failedSchemaLocations=new Set,this.namespaceContextStack=[],this.processedNamespaces=new Set,this.failedNamespaces=new Set,this.isRelaxNG=!1,this.pointer=0,this.buffer="",this.elementStack=0,this.elementNameStack=[],this.childrenNames=[],this.characterRun="",this.rootParsed=!1,this.xmlVersion="1.0",this.streamingMode=t instanceof h.StreamReader,this.sourceEnded=!1,this.documentStarted=!1,this.documentEnded=!1,this.inCDATASection=!1,this.pendingCR=!1,this.readingFromFile=t instanceof o.FileReader,this.internalSubsetApplied=!1,this.xmlDeclarationParsed=!1,this.leadingContentBeforeXmlDeclaration=!1,this.contentHandler?.initialize()}processSynchronous(){if(this.reader)try{for(;!this.documentEnded&&(this.readDocument(),this.documentEnded||this.tryReadMore()););this.ensureDocumentClosed()}finally{this.reader.closeFile()}}processStreaming(t){if(this.reader)for(;;){try{this.readDocument()}catch(t){if(t instanceof l.NeedMoreDataError)return;throw t}if(this.documentEnded)return;let e;try{e=this.tryReadMore()}catch(t){if(t instanceof l.NeedMoreDataError)return;throw t}if(!e)return void(t&&this.ensureDocumentClosed())}}resolveVirtualPath(t){if(t?.virtualPath){const e=t.virtualPath;return(0,r.isAbsolute)(e)?e:(0,r.resolve)(e)}const e=t?.pseudoFileName??b.DEFAULT_VIRTUAL_FILENAME;if(t?.basePath){const n=(0,r.isAbsolute)(t.basePath)?t.basePath:(0,r.resolve)(t.basePath);return(0,r.resolve)(n,e)}return(0,r.resolve)(process.cwd(),e)}tryReadMore(){if(!this.reader||this.sourceEnded)return!1;if(this.reader instanceof h.StreamReader){if(this.reader.dataAvailable()){const t=this.reader.read();return""===t?(this.reader.isFinished()&&(this.sourceEnded=!0,this.flushPendingCR()),!1):(this.appendToBuffer(t),!0)}if(this.reader.isFinished())return this.sourceEnded=!0,this.flushPendingCR(),!1;throw new l.NeedMoreDataError}if(this.reader.dataAvailable()){const t=this.reader.read();return""===t?(this.sourceEnded=!0,this.flushPendingCR(),!1):(this.appendToBuffer(t),!0)}const t=this.reader.read();return""===t?(this.sourceEnded=!0,this.flushPendingCR(),!1):(this.appendToBuffer(t),!0)}appendToBuffer(t){if(0===t.length)return;let e=t;this.pendingCR&&(e="\r"+e,this.pendingCR=!1),e.endsWith("\r")&&(this.pendingCR=!0,e=e.substring(0,e.length-1)),e=e.replaceAll("\r\n","\n").replaceAll("\r","\n"),this.buffer+=e}flushPendingCR(){this.pendingCR&&(this.buffer+="\n",this.pendingCR=!1)}ensureDocumentClosed(){if(!this.documentEnded){if(!this.sourceEnded){if(this.streamingMode)throw new l.NeedMoreDataError;throw new Error("Malformed XML document: unexpected end of input")}if(0!==this.elementStack)throw new Error("Malformed XML document: unclosed elements");if(this.cleanCharacterRun(),!this.rootParsed)throw new Error("Malformed XML document: missing document element");this.rootParsed&&!this.documentEnded&&(this.contentHandler?.endDocument(),this.documentEnded=!0)}}ensureLookahead(t){if(!(this.buffer.length-this.pointer>=t)){for(;this.buffer.length-this.pointer<t&&this.tryReadMore(););if(this.buffer.length-this.pointer<t){if(this.sourceEnded)return;if(this.streamingMode)throw new l.NeedMoreDataError}}}readDocument(){if(this.reader){for(this.documentStarted||(this.contentHandler?.startDocument(),this.documentStarted=!0);;){if(this.pointer>=this.buffer.length){if(!this.tryReadMore())break;continue}if(this.inCDATASection){const t=this.buffer.indexOf("]]>",this.pointer);if(-1===t){const t=this.buffer.substring(this.pointer);if(f.XMLUtils.ensureValidXmlCharacters(this.xmlVersion,t,"CDATA section"),this.characterRun+=t,this.pointer=this.buffer.length,!this.tryReadMore()){if(this.sourceEnded)throw new Error("Malformed XML document: unterminated CDATA section");if(this.streamingMode)throw new l.NeedMoreDataError}continue}const e=this.buffer.substring(this.pointer,t);f.XMLUtils.ensureValidXmlCharacters(this.xmlVersion,e,"CDATA section"),this.characterRun+=e,this.pointer=t,this.endCDATA();continue}if(this.lookingAt("<?xml ")||this.lookingAt("<?xml\t")||this.lookingAt("<?xml\r")||this.lookingAt("<?xml\n")){if(this.rootParsed&&this.elementStack>0)throw new Error("Malformed XML declaration: declaration cannot appear inside the document element");this.parseXMLDeclaration();continue}if(this.lookingAt("<!DOCTYPE")){this.parseDoctype();continue}if(this.lookingAt("\x3c!--")){this.parseComment();continue}if(this.lookingAt("<?")){this.parseProcessingInstruction();continue}if(this.lookingAt("</")){this.endElement();continue}if(this.lookingAt("<![CDATA[")){this.startCDATA();continue}if(this.lookingAt("]]>")){if(!this.inCDATASection)throw new Error('Malformed XML document: "]]>" cannot appear in character data');this.endCDATA();continue}if(this.lookingAt("&")){if(!this.rootParsed||0===this.elementStack)throw new Error("Malformed XML document: text found outside the document element");this.parseEntityReference();continue}if(this.lookingAt("<")){if(this.rootParsed&&0===this.elementStack)throw new Error("Malformed XML document: multiple root elements");this.startElement();continue}const t=this.buffer.codePointAt(this.pointer);f.XMLUtils.ensureValidXmlCodePoint(this.xmlVersion,t,"character data");const e=String.fromCodePoint(t);if(!this.rootParsed&&!f.XMLUtils.isXmlSpace(e))throw new Error("Malformed XML document: text found in prolog");if(this.xmlDeclarationParsed||this.rootParsed||!f.XMLUtils.isXmlSpace(e)||(this.leadingContentBeforeXmlDeclaration=!0),this.rootParsed&&0===this.elementStack&&!f.XMLUtils.isXmlSpace(e))throw new Error("Malformed XML document: text found after root element");if(this.characterRun+=e,this.pointer+=e.length,!this.inCDATASection&&this.characterRun.endsWith("]]>"))throw new Error('Malformed XML document: "]]>" cannot appear in character data')}if(this.sourceEnded)this.ensureDocumentClosed();else if(this.streamingMode)throw new l.NeedMoreDataError}}parseEntityReference(){this.cleanCharacterRun(),this.pointer++;let t="";for(;;){if(this.ensureLookahead(1),this.pointer>=this.buffer.length){if(this.sourceEnded)throw new Error("Malformed XML document: unterminated entity reference");if(this.streamingMode)throw new l.NeedMoreDataError}if(";"===this.buffer.charAt(this.pointer))break;t+=this.buffer.charAt(this.pointer++)}const e=this.contentHandler?.getGrammar(),n=e?.resolveEntity(t);if("lt"===t)this.contentHandler?.characters("<");else if("gt"===t)this.contentHandler?.characters(">");else if("amp"===t)this.contentHandler?.characters("&");else if("apos"===t)this.contentHandler?.characters("'");else if("quot"===t)this.contentHandler?.characters('"');else if(t.startsWith("#x")){const e=Number.parseInt(t.substring(2),16);f.XMLUtils.ensureValidXmlCodePoint(this.xmlVersion,e,`character reference &#x${t.substring(2)};`);const n=String.fromCodePoint(e);this.contentHandler?.characters(n)}else{if(!t.startsWith("#")){if(void 0!==n){this.pointer++;const i=this.buffer.substring(this.pointer),r=this.expandEntityReplacement(n,e,0,new Set([t]));return f.XMLUtils.ensureValidXmlCharacters(this.xmlVersion,r,`expanded entity &${t};`),this.buffer=r+i,void(this.pointer=0)}throw new Error(`Malformed XML document: undefined general entity &${t};`)}{const e=Number.parseInt(t.substring(1),10);f.XMLUtils.ensureValidXmlCodePoint(this.xmlVersion,e,`character reference &#${t.substring(1)};`);const n=String.fromCodePoint(e);this.contentHandler?.characters(n)}}this.pointer++,this.buffer=this.buffer.substring(this.pointer),this.pointer=0}startElement(){this.cleanCharacterRun();const t=this.pointer;let e=!1;try{this.pointer++;let t="";for(;;){if(this.ensureLookahead(1),this.pointer>=this.buffer.length){if(this.sourceEnded)throw new Error("Malformed XML document: unterminated start tag");if(this.streamingMode)throw new l.NeedMoreDataError}if(f.XMLUtils.isXmlSpace(this.buffer.charAt(this.pointer))||this.lookingAt(">")||this.lookingAt("/>"))break;t+=this.buffer.charAt(this.pointer++)}if(this.validating&&!f.XMLUtils.isValidXMLName(t))throw new Error("Invalid XML name: "+t);let n="",i=!1,r="";for(;;){if(this.ensureLookahead(1),this.pointer>=this.buffer.length){if(this.sourceEnded)throw new Error("Malformed XML document: unterminated start tag");if(this.streamingMode)throw new l.NeedMoreDataError}const t=this.buffer.charAt(this.pointer);if(('"'===t||"'"===t)&&(i&&t===r?(i=!1,r=""):i||(i=!0,r=t)),!i&&">"===t)break;if(!i&&"/"===t&&this.lookingAt("/>"))break;n+=t,this.pointer++}n=n.trim();let s=this.parseAttributes(n);const a=this.namespaceContextStack.length>0?this.namespaceContextStack[this.namespaceContextStack.length-1]:void 0,o=this.buildNamespaceContext(s,a);this.handleSchemaLocationAttributes(s,o),this.namespaceContextStack.push(o),e=!0,this.handleNamespaceDeclarations(s,o,a);const c=this.contentHandler?.getGrammar(),h=c instanceof p.DTDGrammar?c:void 0;s.forEach(t=>{const e=this.decodeAttributeEntities(t,h);f.XMLUtils.ensureValidXmlCharacters(this.xmlVersion,e,"attribute value")}),s=this.normalizeDTDAttributes(t,s);let u=[];if(s.forEach((t,e)=>{let n=new d.XMLAttribute(e,t);u.push(n)}),this.validating){u.forEach(t=>{if(!f.XMLUtils.isValidXMLName(t.getName()))throw new Error("Invalid XML attribute name: "+t.getName())});const e=this.contentHandler?.getGrammar();if(e){let n=e.validateAttributes(t,s);if(!1===n.isValid){let e="";throw n.errors.forEach(t=>{e+=t.message+"\n"}),new Error("Validation failed for element "+t+":\n"+e)}}}u=this.getDefaultAttributes(t,u),this.ensureLookahead(1);let m=!1;const g=this.buffer.charAt(this.pointer);if("/"===g){if(this.ensureLookahead(2),">"!==this.buffer.charAt(this.pointer+1))throw new Error('Malformed XML document: expected "/>" to close start tag for '+t);m=!0}else{if(">"!==g)throw new Error('Malformed XML document: unexpected character "'+g+'" at end of start tag');m=!1}this.childrenNames.length>0&&this.childrenNames[this.childrenNames.length-1].push(t),this.childrenNames.push([]),this.contentHandler?.startElement(t,u),this.elementStack++,this.elementNameStack.push(t),this.rootParsed||(this.rootParsed=!0),m?(this.cleanCharacterRun(),this.validateElement(t),this.contentHandler?.endElement(t),this.elementStack--,this.elementNameStack.pop(),this.childrenNames.pop(),e&&this.namespaceContextStack.length>0&&(this.namespaceContextStack.pop(),e=!1),this.pointer+=2):this.pointer++,this.buffer=this.buffer.substring(this.pointer),this.pointer=0}catch(n){throw n instanceof l.NeedMoreDataError&&(this.pointer=t),e&&this.namespaceContextStack.length>0&&this.namespaceContextStack.pop(),n}}endElement(){this.cleanCharacterRun(),this.pointer+=2;let t="";for(;;){if(this.ensureLookahead(1),this.pointer>=this.buffer.length){if(this.sourceEnded)throw new Error("Malformed XML document: unterminated end tag");if(this.streamingMode)throw new l.NeedMoreDataError}if(this.lookingAt(">")||f.XMLUtils.isXmlSpace(this.buffer.charAt(this.pointer)))break;t+=this.buffer.charAt(this.pointer),this.pointer++}for(;;){if(this.ensureLookahead(1),this.pointer>=this.buffer.length){if(this.sourceEnded)throw new Error("Malformed XML document: unterminated end tag");if(this.streamingMode)throw new l.NeedMoreDataError}if(!f.XMLUtils.isXmlSpace(this.buffer.charAt(this.pointer)))break;this.pointer++}if(!this.lookingAt(">"))throw new Error('Well-formedness error: expected ">" in end tag "</'+t+'"');if(0===this.elementNameStack.length)throw new Error('Mismatched element tags: found closing tag "'+t+'" but no elements are open');const e=this.elementNameStack.pop();if(t!==e)throw new Error('Mismatched element tags: expected closing tag for "'+e+'" but found "'+t+'"');this.validating&&!this.isRelaxNG&&this.validateElement(t),this.contentHandler?.endElement(t),this.elementStack--,this.childrenNames.length>0&&this.childrenNames.pop(),this.namespaceContextStack.length>0&&this.namespaceContextStack.pop(),this.pointer++,this.buffer=this.buffer.substring(this.pointer),this.pointer=0}validateElement(t){const e=this.contentHandler?.getGrammar();if(e){const n=this.childrenNames.length>0?this.childrenNames[this.childrenNames.length-1]:[],i=e.validateElement(t,n);if(!i.isValid){const e=i.errors.map(t=>t.message).join("; ");throw new Error('Element validation failed for element "'+t+'": '+e)}}}getDefaultAttributes(t,e){const n=this.contentHandler?.getGrammar(),i=this.namespaceContextStack.length>0?this.namespaceContextStack[this.namespaceContextStack.length-1]:new Map,r=new Set,s=new Set;if(e.forEach(t=>{const e=t.getName();r.add(e);const n=this.splitQualifiedName(e);let a;n.prefix&&(a=i.get(n.prefix));const o=this.buildSchemaAttributeKey(n.localName,a);s.add(o)}),n){const i=n.getDefaultAttributes(t);if(i){const a=n instanceof p.DTDGrammar?n:void 0,o=a?.getElementAttributesMap(t);i.forEach((t,n)=>{const i=this.splitQualifiedName(n),l=this.buildSchemaAttributeKey(i.localName,void 0);if(s.has(l)||r.has(n))return;let c;if(a){const e=this.decodeAttributeEntities(t,a),i=o?.get(n);c=this.normalizeAttributeValue(t,e,i)}else c=this.normalizeAttributeValue(t,t);e.push(new d.XMLAttribute(n,c)),r.add(n),s.add(l)})}}const a=this.splitQualifiedName(t),o=this.getNamespaceUriForElement(t);if(o){const t=o+"|"+a.localName;this.appendSchemaDefaultsForElement(this.schemaDefaultAttributes.get(t),e,r,s,o,a,i)}if(this.appendSchemaDefaultsForElement(this.schemaDefaultAttributes.get(a.localName),e,r,s,o,a,i),a.localName!==t&&this.appendSchemaDefaultsForElement(this.schemaDefaultAttributes.get(t),e,r,s,o,a,i),this.isRelaxNG){if(o){const t=o+"|"+a.localName;this.appendSchemaDefaultsForElement(this.relaxNGDefaultAttributes.get(t),e,r,s,o,a,i)}this.appendSchemaDefaultsForElement(this.relaxNGDefaultAttributes.get(a.localName),e,r,s,o,a,i),a.localName!==t&&this.appendSchemaDefaultsForElement(this.relaxNGDefaultAttributes.get(t),e,r,s,o,a,i)}return e}appendSchemaDefaultsForElement(t,e,n,i,r,s,a){t&&t.forEach(t=>{const o=this.buildSchemaAttributeKey(t.localName,t.namespace);if(i.has(o))return;const l=this.resolveSchemaAttributeQualifiedName(t,r,s,a);if(n.has(l))return;const c=this.normalizeAttributeValue(t.value,t.value);e.push(new d.XMLAttribute(l,c)),n.add(l),i.add(o)})}resolveSchemaAttributeQualifiedName(t,e,n,i){const r=t.lexicalName,s=t.namespace,a=this.splitQualifiedName(r);if(a.prefix){const e=i.get(a.prefix);if(!s&&e)return r;if(s&&e===s)return r;if(s){const e=this.findNamespacePrefix(s,i);if(e)return e+":"+t.localName}return t.localName}if(s){const r=this.findNamespacePrefix(s,i);if(r)return r+":"+t.localName;if(e&&s===e&&n.prefix)return n.prefix+":"+t.localName}return t.lexicalName}findNamespacePrefix(t,e){for(const n of e.entries()){const e=n[0];if(n[1]===t&&""!==e)return e}}buildSchemaAttributeKey(t,e){return e?e+"|"+t:t}buildNamespaceContext(t,e){const n=e?new Map(e):new Map;return t.forEach((t,e)=>{if("xmlns"===e)n.set("",t);else if(e.startsWith("xmlns:")&&e.length>6){const i=e.substring(6);n.set(i,t)}}),n.has("xml")||n.set("xml","http://www.w3.org/XML/1998/namespace"),n}handleNamespaceDeclarations(t,e,n){if(t.forEach((t,e)=>{if("xmlns"===e){const e=t.trim(),i=n?n.get(""):void 0;return void(""!==e&&e!==i&&this.tryLoadSchemaForNamespace(e))}if(!e.startsWith("xmlns:")||e.length<=6)return;const i=e.substring(6),r=t.trim(),s=n?n.get(i):void 0;""!==r&&r!==s&&this.tryLoadSchemaForNamespace(r)}),!n&&e.has("")){const t=e.get("");t&&this.tryLoadSchemaForNamespace(t)}}handleSchemaLocationAttributes(t,e){const n=new Set;e.forEach((t,e)=>{t===a.Constants.XML_SCHEMA_INSTANCE_NS_URI&&n.add(e)}),0!==n.size&&t.forEach((t,e)=>{if("xmlns"===e||e.startsWith("xmlns:"))return;const{prefix:i,localName:r}=this.splitQualifiedName(e);if(i&&n.has(i))if("schemaLocation"===r){const e=t.trim().split(/\s+/).filter(t=>t.length>0);if(e.length<2)return;for(let t=0;t+1<e.length;t+=2){const n=e[t],i=e[t+1];this.processSchemaReference(n,i)}}else if("noNamespaceSchemaLocation"===r){const e=t.trim();""!==e&&this.processSchemaReference("",e)}})}tryLoadSchemaForNamespace(t){if(!this.schemaLoadingEnabled)return;if(""===t)return;if(m.XMLSchemaParser.shouldIgnoreNamespace(t))return void this.processedNamespaces.add(t);if(this.processedNamespaces.has(t)||this.failedNamespaces.has(t))return;if(!this.catalog)return;const e=[this.catalog.matchURI(t),this.catalog.matchSystem(t)];for(let n=0;n<e.length;n++){const r=e[n];if(!r)continue;const a=r.startsWith("file://")?(0,s.fileURLToPath)(r):r;if((0,i.existsSync)(a)&&this.loadSchemaDefaults(a,t))return void this.processedNamespaces.add(t)}this.failedNamespaces.add(t)}processSchemaReference(t,e){if(!this.schemaLoadingEnabled)return;if(""===e)return;if(this.processedSchemaLocations.has(e)||this.failedSchemaLocations.has(e))return;const n=this.resolveSchemaLocation(t,e);n&&this.loadSchemaDefaults(n,e)||this.failedSchemaLocations.add(e)}loadSchemaDefaults(t,e){if(this.processedSchemaLocations.has(t))return this.processedSchemaLocations.add(e),!0;try{const n=m.XMLSchemaParser.getInstance(this.catalog).collectDefaultAttributes(t),i=new Map;return n.forEach((t,e)=>{const n=new Map;t.forEach((t,e)=>{const i={localName:t.localName,namespace:t.namespace,lexicalName:t.lexicalName,value:t.value};n.set(e,i)}),i.set(e,n)}),this.mergeSchemaDefaults(i),this.processedSchemaLocations.add(t),this.processedSchemaLocations.add(e),!0}catch(e){if(this.validating)throw e;const n=e instanceof Error?e.message:String(e);return console.warn(`Warning: Could not load XML Schema defaults from ${t}: ${n}`),!1}}resolveSchemaLocation(t,e){let n=e;if(n.startsWith("file://")&&(n=(0,s.fileURLToPath)(n),(0,i.existsSync)(n)))return n;if((0,r.isAbsolute)(e)&&(0,i.existsSync)(e))return e;if(!e.startsWith("http://")&&!e.startsWith("https://")&&!e.startsWith("urn:")){if(this.currentFile){const t=(0,r.dirname)(this.currentFile),n=(0,r.resolve)(t,e);if((0,i.existsSync)(n))return n}const t=(0,r.resolve)(e);if((0,i.existsSync)(t))return t}if(this.catalog){const n=[this.catalog.matchURI(e),this.catalog.matchSystem(e)];t&&(n.push(this.catalog.matchURI(t)),n.push(this.catalog.matchSystem(t)));for(const t of n){if(!t)continue;const e=t.startsWith("file://")?(0,s.fileURLToPath)(t):t;if((0,i.existsSync)(e))return e}}}mergeSchemaDefaults(t){t.forEach((t,e)=>{if(0===t.size)return;const n=this.schemaDefaultAttributes.get(e)??new Map;t.forEach((t,e)=>{const i={localName:t.localName,namespace:t.namespace,lexicalName:t.lexicalName,value:t.value};n.set(e,i)}),n.size>0&&this.schemaDefaultAttributes.set(e,n)})}splitQualifiedName(t){const e=t.indexOf(":");return-1===e?{localName:t}:{prefix:t.substring(0,e),localName:t.substring(e+1)}}getNamespaceUriForElement(t){if(0===this.namespaceContextStack.length)return;const e=this.namespaceContextStack[this.namespaceContextStack.length-1],n=this.splitQualifiedName(t);return void 0===n.prefix?e.get(""):e.get(n.prefix)}cleanCharacterRun(){""!==this.characterRun&&(this.rootParsed?0===this.elementStack?this.contentHandler?.ignorableWhitespace(this.characterRun):this.contentHandler?.characters(this.characterRun):this.contentHandler?.ignorableWhitespace(this.characterRun),this.characterRun="")}parseComment(){this.cleanCharacterRun();let t="",e=!1;for(this.pointer+=4;;){if(this.ensureLookahead(3),this.pointer>=this.buffer.length){if(this.sourceEnded)throw new Error("Malformed XML document: unterminated comment");if(this.streamingMode)throw new l.NeedMoreDataError}if(this.lookingAt("--\x3e"))break;const n=this.buffer.codePointAt(this.pointer);f.XMLUtils.ensureValidXmlCodePoint(this.xmlVersion,n,"comment");const i=String.fromCodePoint(n);if("-"===i){if(e)throw new Error('Malformed XML document: comment cannot contain "--"');e=!0}else e=!1;t+=i,this.pointer+=i.length}if(t.endsWith("-"))throw new Error('Malformed XML document: comment cannot end with "-"');this.buffer=this.buffer.substring(this.pointer+3),this.pointer=0,this.contentHandler?.comment(t)}parseProcessingInstruction(){this.cleanCharacterRun();let t="",e="",n="";for(this.pointer+=2;;){if(this.ensureLookahead(2),this.pointer>=this.buffer.length){if(this.sourceEnded)throw new Error("Malformed XML document: unterminated processing instruction");if(this.streamingMode)throw new l.NeedMoreDataError}if(this.lookingAt("?>"))break;const e=this.buffer.codePointAt(this.pointer);f.XMLUtils.ensureValidXmlCodePoint(this.xmlVersion,e,"processing instruction");const n=String.fromCodePoint(e);t+=n,this.pointer+=n.length}if(t=t.trim(),0===t.length)throw new Error("Malformed XML document: processing instruction missing target");let i=0;for(;i<t.length;i++){let n=t[i];if(f.XMLUtils.isXmlSpace(n))break;e+=n}if(0===e.length)throw new Error("Malformed XML document: processing instruction missing target");if("xml"===e.toLowerCase())throw new Error('Malformed XML document: XML declaration must use lowercase "<?xml"');for(;i<t.length;i++){let e=t[i];if(!f.XMLUtils.isXmlSpace(e))break}if(n=t.substring(i),this.buffer=this.buffer.substring(this.pointer+2),this.pointer=0,this.contentHandler?.processingInstruction(e,n),"xml-model"===e){const t=this.parseAttributes(n),e=t.get("href"),i=t.get("schematypens");if(e&&(i?i===a.Constants.RELAXNG_NS_URI:e.endsWith(".rng")))try{this.parseRelaxNG(e)}catch(t){if(this.validating)throw t;const n=t instanceof Error?t.message:String(t);console.warn(`Warning: Could not load RelaxNG defaults from ${e}: ${n}`)}}}parseRelaxNG(t){let e;try{if(t.startsWith("file://"))e=(0,s.fileURLToPath)(t);else if((0,r.isAbsolute)(t))e=t;else{const n=this.currentFile?(0,r.dirname)(this.currentFile):void 0;e=n?(0,r.resolve)(n,t):(0,r.resolve)(t)}if(!(0,i.existsSync)(e)&&this.catalog){const n=[this.catalog.matchSystem(t),this.catalog.matchURI(t),this.catalog.matchPublic(t)];let r;for(const t of n){if(!t)continue;const e=t.startsWith("file://")?(0,s.fileURLToPath)(t):t;if((0,i.existsSync)(e)){r=e;break}}if(!r){if(this.validating)throw new Error(`RelaxNG schema file not found: ${t}`);return}e=r}else if(!(0,i.existsSync)(e)){if(this.validating)throw new Error(`RelaxNG schema file not found: ${t}`);return}let n=new c.RelaxNGParser(e,this.catalog);this.relaxNGDefaultAttributes=n.getElements(),this.isRelaxNG=!0}catch(e){if(e instanceof Error)throw new Error(`Error accessing RelaxNG schema at ${t}: ${e.message}`,{cause:e});throw new Error(`Error accessing RelaxNG schema at ${t}: ${String(e)}`)}}processInternalSubset(t,e=!1){if(0===t.trim().length)return;if(e&&this.internalSubsetApplied)return;const n=this.contentHandler?.getGrammar(),i=this.currentFile?(0,r.dirname)(this.currentFile):void 0,s=n instanceof p.DTDGrammar?new g.DTDParser(n,i):new g.DTDParser(void 0,i);let a;s.setValidating(this.validating),s.setXmlVersion(this.xmlVersion),this.catalog&&s.setCatalog(this.catalog),s.setOverrideExistingDeclarations(!0);try{a=s.parseString(t)}catch(t){if(this.validating)throw t}finally{s.setOverrideExistingDeclarations(!1)}a&&this.contentHandler?.setGrammar(a),this.internalSubsetApplied=!0}parseDoctype(){for(this.cleanCharacterRun(),this.pointer+=9;;){if(this.ensureLookahead(1),this.pointer>=this.buffer.length){if(this.sourceEnded)throw new Error("Malformed DOCTYPE declaration");if(this.streamingMode)throw new l.NeedMoreDataError}let t=this.buffer[this.pointer];if(!f.XMLUtils.isXmlSpace(t))break;this.pointer++}let t="";for(;;){if(this.ensureLookahead(1),this.pointer>=this.buffer.length){if(this.sourceEnded)throw new Error("Malformed DOCTYPE declaration: missing root name");if(this.streamingMode)throw new l.NeedMoreDataError}let e=this.buffer.charAt(this.pointer);if(f.XMLUtils.isXmlSpace(e))break;t+=e,this.pointer++}for(;;){if(this.ensureLookahead(1),this.pointer>=this.buffer.length){if(this.sourceEnded)break;if(this.streamingMode)throw new l.NeedMoreDataError}let t=this.buffer[this.pointer];if(!f.XMLUtils.isXmlSpace(t))break;this.pointer++}let e="";this.lookingAt("SYSTEM")&&(e=this.parseSystemDeclaration());let n="";if(this.lookingAt("PUBLIC")){let t=this.parsePublicDeclaration();n=t[0],e=t[1]}for(this.contentHandler?.startDTD(t,n,e);;){if(this.ensureLookahead(1),this.pointer>=this.buffer.length){if(this.sourceEnded)break;if(this.streamingMode)throw new l.NeedMoreDataError}let t=this.buffer[this.pointer];if(!f.XMLUtils.isXmlSpace(t))break;this.pointer++}let i="";if(this.lookingAt("[")){this.pointer++;let t=1,e=!1,n="";for(;t>0;){if(this.ensureLookahead(1),this.pointer>=this.buffer.length){if(this.sourceEnded)throw new Error("Malformed DOCTYPE declaration: unterminated internal subset");if(this.streamingMode)throw new l.NeedMoreDataError}const r=this.buffer.charAt(this.pointer);if(e)i+=r,this.pointer++,r===n&&(e=!1,n="");else if('"'!==r&&"'"!==r)if("["!==r)if("]"!==r)i+=r,this.pointer++;else{if(t--,this.pointer++,0===t)break;i+=r}else t++,i+=r,this.pointer++;else e=!0,n=r,i+=r,this.pointer++}}if(""!==i){if(/(<\?xml)(?=[\s?>])/i.test(i))throw new Error("Malformed DOCTYPE declaration: XML declaration is not allowed inside the internal subset");this.processInternalSubset(i)}for(;;){if(this.ensureLookahead(1),this.pointer>=this.buffer.length){if(this.sourceEnded)break;if(this.streamingMode)throw new l.NeedMoreDataError}let t=this.buffer[this.pointer];if(!f.XMLUtils.isXmlSpace(t))break;this.pointer++}this.pointer++,this.buffer=this.buffer.substring(this.pointer),this.pointer=0,""===e&&""===n||this.processExternalSubset(n,e),""!==i&&this.contentHandler?.internalSubset(i),this.processInternalSubset(i,!0),this.contentHandler?.endDTD()}processExternalSubset(t,e){if(""===e&&""===t)return;const n=this.resolveExternalSubsetLocation(t,e);if(!n){const n=e||t;if(this.validating)throw new Error(`External subset not found: ${n}`);return void console.warn(`Warning: External subset not found: ${n}`)}const i=this.contentHandler?.getGrammar(),s=this.readingFromFile&&this.currentFile?(0,r.dirname)(this.currentFile):void 0,a=i instanceof p.DTDGrammar?new g.DTDParser(i,s):new g.DTDParser(void 0,s);a.setValidating(this.validating),a.setXmlVersion(this.xmlVersion),this.catalog&&a.setCatalog(this.catalog),a.setOverrideExistingDeclarations(!1);try{const t=a.parseDTD(n);this.contentHandler?.setGrammar(t)}catch(t){if(this.validating)throw t;console.warn(`Warning: Failed to parse external subset ${n}: ${t.message}`)}}resolveExternalSubsetLocation(t,e){const n=this.catalog?.resolveEntity(t,e);if(n)return n;if(!e)return;const s=e.toLowerCase();if(s.startsWith("http://")||s.startsWith("https://")){if(this.validating)throw new Error(`External subset retrieval over HTTP is not supported: ${e}`);return void console.warn(`Warning: External subset over HTTP/HTTPS is not supported: ${e}`)}if(this.readingFromFile&&this.currentFile){const t=(0,r.dirname)(this.currentFile),n=(0,r.resolve)(t,e);if((0,i.existsSync)(n))return n}if((0,r.isAbsolute)(e)&&(0,i.existsSync)(e))return e;const a=(0,r.resolve)(e);return(0,i.existsSync)(a)?a:void 0}parsePublicDeclaration(){for(this.pointer+=6;;){if(this.ensureLookahead(1),this.pointer>=this.buffer.length){if(this.sourceEnded)throw new Error("Malformed PUBLIC declaration");if(this.streamingMode)throw new l.NeedMoreDataError}let t=this.buffer[this.pointer];if(!f.XMLUtils.isXmlSpace(t))break;this.pointer++}let t="",e="";for(;;){if(this.ensureLookahead(1),this.pointer>=this.buffer.length){if(this.sourceEnded)throw new Error("Malformed PUBLIC declaration: unterminated public identifier");if(this.streamingMode)throw new l.NeedMoreDataError}let n=this.buffer[this.pointer];if(""===t){if("'"===n||'"'===n){t=n,this.pointer++;continue}throw new Error("Malformed PUBLIC declaration: missing opening quote")}if(n===t){this.pointer++;break}e+=n,this.pointer++}for(;;){if(this.ensureLookahead(1),this.pointer>=this.buffer.length){if(this.sourceEnded)break;if(this.streamingMode)throw new l.NeedMoreDataError}let t=this.buffer[this.pointer];if(!f.XMLUtils.isXmlSpace(t))break;this.pointer++}t="";let n="";for(;;){if(this.ensureLookahead(1),this.pointer>=this.buffer.length){if(this.sourceEnded)throw new Error("Malformed PUBLIC declaration: unterminated system identifier");if(this.streamingMode)throw new l.NeedMoreDataError}let e=this.buffer[this.pointer];if(""===t){if("'"===e||'"'===e){t=e,this.pointer++;continue}throw new Error("Malformed PUBLIC declaration: missing system identifier quote")}if(e===t){this.pointer++;break}n+=e,this.pointer++}return[e,n]}parseSystemDeclaration(){for(this.pointer+=6;;){if(this.ensureLookahead(1),this.pointer>=this.buffer.length){if(this.sourceEnded)throw new Error("Malformed SYSTEM declaration");if(this.streamingMode)throw new l.NeedMoreDataError}let t=this.buffer[this.pointer];if(!f.XMLUtils.isXmlSpace(t))break;this.pointer++}let t="",e="";for(;;){if(this.ensureLookahead(1),this.pointer>=this.buffer.length){if(this.sourceEnded)throw new Error("Malformed SYSTEM declaration: unterminated system identifier");if(this.streamingMode)throw new l.NeedMoreDataError}let n=this.buffer[this.pointer];if(""===t){if("'"===n||'"'===n){t=n,this.pointer++;continue}throw new Error("Malformed SYSTEM declaration: missing opening quote")}if(n===t){this.pointer++;break}e+=n,this.pointer++}return e}parseXMLDeclaration(){if(this.xmlDeclarationParsed)throw new Error("Malformed XML declaration: multiple declarations are not allowed");if(this.rootParsed)throw new Error("Malformed XML declaration: declaration cannot appear after the root element");if(this.leadingContentBeforeXmlDeclaration)throw new Error("Malformed XML declaration: declaration must be the first content in the document");let t="";for(this.pointer+=6;;){if(this.ensureLookahead(2),this.pointer>=this.buffer.length){if(this.sourceEnded)throw new Error("Malformed XML declaration: unterminated declaration");if(this.streamingMode)throw new l.NeedMoreDataError}if(this.lookingAt("?>"))break;const e=this.buffer.codePointAt(this.pointer);f.XMLUtils.ensureValidXmlCodePoint(this.xmlVersion,e,"XML declaration");const n=String.fromCodePoint(e);t+=n,this.pointer+=n.length}t=t.trim();const e=this.parseAttributePairs(t),n=new Map;e.forEach(t=>n.set(t.name,t.value));const i=new Set(["version","encoding","standalone"]);e.forEach((t,n)=>{const r=t.name;if(!i.has(r))throw new Error('Malformed XML declaration: invalid pseudo-attribute "'+r+'"');if("version"===r&&0!==n)throw new Error('Malformed XML declaration: "version" pseudo-attribute must appear first');if("encoding"===r){if(0===n)throw new Error('Malformed XML declaration: "encoding" pseudo-attribute must follow "version"');if("version"!==e[n-1].name)throw new Error('Malformed XML declaration: "encoding" pseudo-attribute must immediately follow "version"')}if("standalone"===r){if(0===n)throw new Error('Malformed XML declaration: "standalone" pseudo-attribute must follow "version"');const t=new Set(e.slice(0,n).map(t=>t.name));if(!t.has("version"))throw new Error('Malformed XML declaration: "standalone" pseudo-attribute requires "version"');if(t.has("encoding")&&"encoding"!==e[n-1].name)throw new Error('Malformed XML declaration: "standalone" pseudo-attribute must follow "encoding" when both are present')}});const r=n.get("version");if(!r)throw new Error('Malformed XML declaration: missing required "version" pseudo-attribute');const s=n.get("encoding");let a="UTF-8";if(void 0!==s){const t=this.validateEncodingValue(s);n.set("encoding",t),a=t}const o=n.get("standalone");if(void 0!==o&&"yes"!==o&&"no"!==o)throw new Error('Malformed XML declaration: invalid value "'+o+'" for "standalone"');this.buffer=this.buffer.substring(this.pointer+2),this.pointer=0;const c=r;this.xmlVersion=c,this.contentHandler?.xmlDeclaration(c,a,n.get("standalone")),this.xmlDeclarationParsed=!0,this.leadingContentBeforeXmlDeclaration=!1}lookingAt(t){const e=t.length;try{this.ensureLookahead(e)}catch(t){if(t instanceof l.NeedMoreDataError)throw t;throw t}if(this.pointer+e>this.buffer.length)return!1;for(let n=0;n<e;n++)if(this.buffer[this.pointer+n]!==t[n])return!1;return!0}parseAttributePairs(t){const e=t,n=[],i=new Set;let r=0;for(;r<t.length;){for(;r<t.length&&f.XMLUtils.isXmlSpace(t.charAt(r));)r++;if(r>=t.length)break;const s=t.charAt(r);if("?"===s||"/"===s||">"===s)break;const a=r;for(;r<t.length;){const e=t.charAt(r);if("="===e||f.XMLUtils.isXmlSpace(e))break;r++}const o=t.substring(a,r);if(""===o)throw new Error('Malformed attributes list in "'+e+'"');for(;r<t.length&&f.XMLUtils.isXmlSpace(t.charAt(r));)r++;if(r>=t.length||"="!==t.charAt(r))throw new Error('Malformed attributes list in "'+e+'": missing "=" after attribute name "'+o+'"');for(r++;r<t.length&&f.XMLUtils.isXmlSpace(t.charAt(r));)r++;if(r>=t.length)throw new Error('Malformed attributes list in "'+e+'": missing attribute value for "'+o+'"');const l=t.charAt(r);if('"'!==l&&"'"!==l)throw new Error('Malformed attributes list in "'+e+'": attribute "'+o+'" must start with quote');r++;const c=r;for(;r<t.length&&t.charAt(r)!==l;)r++;if(r>=t.length)throw new Error('Malformed attributes list in "'+e+'": attribute "'+o+'" is missing closing quote');const h=t.substring(c,r);if(-1!==h.indexOf("<"))throw new Error('Malformed attributes list in "'+e+'": attribute "'+o+'" contains forbidden character "<"');if(r++,r<t.length){const n=t.charAt(r);if("?"===n||"/"===n||">"===n);else if(!f.XMLUtils.isXmlSpace(n))throw new Error('Malformed attributes list: attribute "'+o+'" must be followed by whitespace in "'+e+'"')}if(i.has(o))throw new Error(`Malformed attributes list: duplicate attribute "${o}" in "${e}"`);i.add(o),n.push({name:o,value:h})}return n}parseAttributes(t){const e=new Map;return this.parseAttributePairs(t).forEach(t=>{e.set(t.name,t.value)}),e}validateEncodingValue(t){if(!b.ENCODING_NAME_PATTERN.test(t))throw new Error('Malformed XML declaration: invalid encoding name "'+t+'"');const e=t.toUpperCase(),n=b.SUPPORTED_ENCODINGS.get(e);if(!n)throw new Error('Malformed XML declaration: unsupported encoding "'+t+'"');return n}normalizeDTDAttributes(t,e){const n=this.contentHandler?.getGrammar();if(!(n instanceof p.DTDGrammar))return e;const i=n.getElementAttributesMap(t);if(!i||0===i.size)return e;const r=new Map;return e.forEach((t,e)=>{const s=this.decodeAttributeEntities(t,n);f.XMLUtils.ensureValidXmlCharacters(this.xmlVersion,s,"attribute value");const a=i.get(e);r.set(e,this.normalizeAttributeValue(t,s,a))}),r}normalizeAttributeValue(t,e,n){const i=this.containsNumericCharReference(t,10),r=this.containsNumericCharReference(t,13),s=this.containsNumericCharReference(t,9);let a=e;return(-1!==t.indexOf("\n")||-1!==t.indexOf("\r"))&&(a=a.replaceAll("\r\n","\n")),r||(a=a.replaceAll("\r","\n")),n&&"CDATA"!==n.getType()?(a=a.replaceAll("\n"," ").replaceAll("\r"," ").replaceAll("\t"," "),a.replaceAll(/ +/g," ").trim()):(i||(a=a.replaceAll("\n"," ")),r||(a=a.replaceAll("\r"," ")),s||(a=a.replaceAll("\t"," ")),a)}containsNumericCharReference(t,e){const n=/&#(x[0-9a-fA-F]+|\d+);/g;let i;for(;null!==(i=n.exec(t));){const t=i[1];let n;if(n="x"===t[0]||"X"===t[0]?Number.parseInt(t.substring(1),16):Number.parseInt(t,10),n===e)return!0}return!1}decodeAttributeEntities(t,e){if(-1===t.indexOf("&"))return t;let n="",i=0;for(;i<t.length;){const r=t.indexOf("&",i);if(-1===r){const e=t.substring(i);f.XMLUtils.ensureValidXmlCharacters(this.xmlVersion,e,"attribute value"),n+=e;break}const s=t.substring(i,r);f.XMLUtils.ensureValidXmlCharacters(this.xmlVersion,s,"attribute value"),n+=s;const a=t.indexOf(";",r+1);if(-1===a)throw new Error("Malformed XML document: unterminated entity reference in attribute value");const o=t.substring(r+1,a);if(0===o.length)throw new Error("Malformed XML document: empty entity reference in attribute value");if(o.startsWith("#x")){const t=Number.parseInt(o.substring(2),16);f.XMLUtils.ensureValidXmlCodePoint(this.xmlVersion,t,`character reference &#x${o.substring(2)}; in attribute value`),n+=String.fromCodePoint(t)}else if(o.startsWith("#")){const t=Number.parseInt(o.substring(1),10);f.XMLUtils.ensureValidXmlCodePoint(this.xmlVersion,t,`character reference &#${o.substring(1)}; in attribute value`),n+=String.fromCodePoint(t)}else if("lt"===o)n+="<";else if("gt"===o)n+=">";else if("amp"===o)n+="&";else if("apos"===o)n+="'";else if("quot"===o)n+='"';else{const t=e?.resolveEntity(o);if(void 0===t)throw new Error(`Malformed XML document: undefined general entity &${o}; in attribute value`);n+=this.expandEntityReplacement(t,e,0,new Set([o]))}i=a+1}return f.XMLUtils.ensureValidXmlCharacters(this.xmlVersion,n,"attribute value"),n}expandEntityReplacement(t,e,n=0,i=new Set){if(n>50)throw new Error(`Entity expansion depth exceeded (possible recursion): ${Array.from(i).join(" -> ")}`);let r="",s=0;for(;s<t.length;){const a=t.indexOf("&",s);if(-1===a){const e=t.substring(s);f.XMLUtils.ensureValidXmlCharacters(this.xmlVersion,e,"entity replacement text"),r+=e;break}const o=t.substring(s,a);f.XMLUtils.ensureValidXmlCharacters(this.xmlVersion,o,"entity replacement text"),r+=o;const l=t.indexOf(";",a+1);if(-1===l){r+=t.substring(a);break}const c=t.substring(a+1,l);if(0!==c.length){if("lt"===c||"gt"===c||"amp"===c||"apos"===c||"quot"===c)r+="&"+c+";";else if(c.startsWith("#x")){const t=Number.parseInt(c.substring(2),16);f.XMLUtils.ensureValidXmlCodePoint(this.xmlVersion,t,`character reference &#x${c.substring(2)}; in entity replacement`),r+=String.fromCodePoint(t)}else if(c.startsWith("#")){const t=Number.parseInt(c.substring(1),10);f.XMLUtils.ensureValidXmlCodePoint(this.xmlVersion,t,`character reference &#${c.substring(1)}; in entity replacement`),r+=String.fromCodePoint(t)}else{const t=e?.resolveEntity(c);if(void 0!==t){if(i.has(c)){const t=Array.from(i).concat(c).join(" -> ");throw new Error(`Recursive entity reference detected: ${t}`)}const s=new Set(i);s.add(c),r+=this.expandEntityReplacement(t,e,n+1,s)}else r+="&"+c+";"}s=l+1}else r+="&;",s=l+1}return f.XMLUtils.ensureValidXmlCharacters(this.xmlVersion,r,"entity replacement text"),r}startCDATA(){this.cleanCharacterRun(),this.pointer+=9,this.buffer=this.buffer.substring(this.pointer),this.pointer=0,this.inCDATASection=!0,this.contentHandler?.startCDATA()}endCDATA(){this.cleanCharacterRun(),this.pointer+=3,this.buffer=this.buffer.substring(this.pointer),this.pointer=0,this.inCDATASection=!1,this.contentHandler?.endCDATA()}}e.SAXParser=b},6110(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.StreamReader=void 0;const i=n(9080);e.StreamReader=class{encoding;chunks;finished;constructor(t){this.encoding=t,this.chunks=[],this.finished=!1}enqueue(t){this.chunks.push(t)}markFinished(){this.finished=!0}read(){if(this.chunks.length>0)return this.chunks.shift();if(this.finished)return"";throw new i.NeedMoreDataError}dataAvailable(){return this.chunks.length>0}isFinished(){return this.finished&&0===this.chunks.length}closeFile(){this.chunks.length=0,this.finished=!0}}},5235(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.StringReader=void 0,e.StringReader=class{data;offset=0;chunkSize;constructor(t,e=8192){this.data=t,this.chunkSize=Math.max(e,1)}read(){if(!this.dataAvailable())return"";const t=Math.min(this.offset+this.chunkSize,this.data.length),e=this.data.substring(this.offset,t);return this.offset=t,e}dataAvailable(){return this.offset<this.data.length}closeFile(){}}},9850(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TextNode=void 0;const i=n(2176),r=n(2823);class s{value;constructor(t){this.value=t}setValue(t){this.value=t}getValue(){return this.value}getNodeType(){return i.Constants.TEXT_NODE}toString(){return r.XMLUtils.cleanString(this.value)}equals(t){return t instanceof s&&this.value===t.value}}e.TextNode=s},2966(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.XMLAttribute=void 0;const i=n(2176),r=n(2823);class s{name;value;constructor(t,e){this.name=t,this.value=e}getName(){return this.name}getValue(){return this.value}setvalue(t){this.value=t}getNamespace(){return-1===this.name.indexOf(":")?"":this.name.substring(0,this.name.indexOf(":"))}getNodeType(){return i.Constants.ATTRIBUTE_NODE}toString(){return this.name+'="'+r.XMLUtils.unquote(r.XMLUtils.cleanString(this.value))+'"'}equals(t){return t instanceof s&&this.name===t.name&&this.value===t.value}}e.XMLAttribute=s},4284(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.XMLCanonicalizer=void 0;const i=n(112),r=n(1882),s=n(2192),a=n(9350),o=n(9850),l=n(7871),c=n(9162),h=n(3429),u=n(2714);e.XMLCanonicalizer=class{document;parseFile(t,e){const n=new r.DOMBuilder,i=new a.SAXParser;i.setContentHandler(n),i.parseFile(t,e),this.document=n.getDocument()}parseString(t,e){const n=new r.DOMBuilder,i=new a.SAXParser;i.setContentHandler(n),i.parseString(t,e),this.document=n.getDocument()}async parseStream(t,e){const n=new r.DOMBuilder,i=new a.SAXParser;i.setContentHandler(n),await i.parseStream(t,e),this.document=n.getDocument()}setDocument(t){this.document=t}getDocument(){return this.document}toString(){if(!this.document)throw new Error("Canonicalizer has no document. Parse an XML source first.");return this.renderDocument(this.document)}renderDocument(t){const e=[];for(const n of t.contentIterator())e.push(this.renderTopLevelNode(n));return e.join("")}renderTopLevelNode(t){if(t instanceof c.XMLDeclaration||t instanceof l.XMLComment||t instanceof h.XMLDocumentType)return"";if(t instanceof s.ProcessingInstruction)return this.renderProcessingInstruction(t);if(t instanceof u.XMLElement)return this.renderElement(t);if(t instanceof o.TextNode||t instanceof i.CData){const e=this.getNodeValue(t);return this.isWhitespaceOnly(e)?"":this.escapeData(e)}return""}renderElement(t){const e=[];return e.push("<"+t.getName()),[...t.getAttributes()].sort((t,e)=>t.getName().localeCompare(e.getName())).forEach(t=>{e.push(" "+t.getName()+'="'+this.escapeData(t.getValue())+'"')}),e.push(">"),t.getContent().forEach(t=>{t instanceof u.XMLElement?e.push(this.renderElement(t)):t instanceof o.TextNode||t instanceof i.CData?e.push(this.escapeData(this.getNodeValue(t))):t instanceof s.ProcessingInstruction&&e.push(this.renderProcessingInstruction(t))}),e.push("</"+t.getName()+">"),e.join("")}renderProcessingInstruction(t){const e=this.escapeProcessingInstructionData(t.getData());return`<?${t.getTarget()} ${e}?>`}getNodeValue(t){return o.TextNode,t.getValue()}escapeData(t){const e=t.replaceAll("\r\n","\n");let n="";for(let t=0;t<e.length;t++){const i=e.charAt(t);switch(i){case"&":n+="&amp;";break;case"<":n+="&lt;";break;case">":n+="&gt;";break;case'"':n+="&quot;";break;case"\t":n+="&#9;";break;case"\n":n+="&#10;";break;case"\r":n+="&#13;";break;default:n+=i}}return n}escapeProcessingInstructionData(t){const e=t.replaceAll("\r\n","\n");let n="";for(let t=0;t<e.length;t++){const i=e.charAt(t);n+="&"===i?"&amp;":"\r"===i?"&#13;":i}return n}isWhitespaceOnly(t){if(0===t.length)return!0;for(let e=0;e<t.length;e++){const n=t.charAt(e);if(" "!==n&&"\t"!==n&&"\n"!==n&&"\r"!==n)return!1}return!0}}},7871(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.XMLComment=void 0;const i=n(2176);class r{value;constructor(t){this.value=t}setValue(t){this.value=t}getValue(){return this.value}getNodeType(){return i.Constants.COMMENT_NODE}toString(){return"\x3c!--"+this.value+"--\x3e"}equals(t){return t instanceof r&&this.value===t.value}}e.XMLComment=r},9162(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.XMLDeclaration=void 0;const i=n(2176);class r{version;encoding;standalone;constructor(t,e,n){if(""!==t&&"1.0"!==t&&"1.1"!==t)throw new Error("Incorrect XML version");if(this.version=t,this.encoding=e,void 0!==n){if("yes"!==n&&"no"!==n)throw new Error('Incorrect "standalone" value');this.standalone=n}}getVersion(){return this.version}setVersion(t){this.version=t}getEncoding(){return this.encoding}setEncoding(t){this.encoding=t}getStandalone(){return this.standalone}setStandalone(t){this.standalone=t}getNodeType(){return i.Constants.XML_DECLARATION_NODE}toString(){return"<?xml"+(""!==this.version?' version="'+this.version+'"':"")+(""!==this.encoding?' encoding="'+this.encoding+'"':"")+(this.standalone?' standalone="'+this.standalone+'"':"")+"?>"}equals(t){return t instanceof r&&this.version===t.version&&this.encoding===t.encoding&&this.standalone===t.standalone}}e.XMLDeclaration=r},6245(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.XMLDocument=void 0;const i=n(2176),r=n(9162),s=n(2714),a=n(2823);class o{content;documentType;constructor(){this.content=new Array}contentIterator(){return this.content.values()}setRoot(t){this.content.push(t)}getRoot(){for(let t of this.content)if(t instanceof s.XMLElement)return t}setDocumentType(t){this.documentType=t,this.content.push(t)}getDocumentType(){return this.documentType}setXmlDeclaration(t){this.content.unshift(t)}getXmlDeclaration(){if(this.content[0]instanceof r.XMLDeclaration)return this.content[0]}addComment(t){this.content.push(t)}addProcessingInstruction(t){this.content.push(t)}addTextNode(t){this.content.push(t)}getNodeType(){return i.Constants.DOCUMENT_NODE}toString(){let t="",e=!0,n=this.getXmlDeclaration();return n&&(e="1.0"===n.getVersion()),this.content.forEach(n=>{t+=e?a.XMLUtils.validXml10Chars(n.toString()):a.XMLUtils.validXml11Chars(n.toString())}),t}equals(t){if(t instanceof o){if(this.content.length!==t.content.length)return!1;for(let e=0;e<this.content.length;e++)if(!this.content[e].equals(t.content[e]))return!1;return!0}return!1}}e.XMLDocument=o},3429(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.XMLDocumentType=void 0;const i=n(2176);class r{name;systemId;publicId;internalSubset;constructor(t,e,n){this.name=t,this.publicId=e,this.systemId=n}setSystemId(t){this.systemId=t}getSystemId(){return this.systemId}setPublicId(t){this.publicId=t}getPublicId(){return this.publicId}setInternalSubset(t){this.internalSubset=t}getInternalSubset(){return this.internalSubset}getNodeType(){return i.Constants.DOCUMENT_TYPE_NODE}toString(){let t="<!DOCTYPE "+this.name;return this.publicId&&this.systemId?t+=' PUBLIC "'+this.publicId+'" "'+this.systemId+'"':this.systemId?t+=' SYSTEM "'+this.systemId+'"':this.publicId&&(t+=' PUBLIC "'+this.publicId+'"'),this.internalSubset&&(t+=" ["+this.internalSubset.toString()+"]"),t+">"}equals(t){if(t instanceof r){const e=this.publicId===t.publicId,n=this.systemId===t.systemId,i=this.internalSubset===t.internalSubset;return e&&n&&i}return!1}}e.XMLDocumentType=r},2714(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.XMLElement=void 0;const i=n(2192),r=n(9850),s=n(2176);class a{name;attributes;content;constructor(t){this.name=t,this.attributes=new Map,this.content=new Array}getName(){return this.name}getNamespace(){return-1===this.name.indexOf(":")?"":this.name.substring(0,this.name.indexOf(":"))}hasAttribute(t){return this.attributes.has(t)}getAttribute(t){return this.attributes.get(t)}setAttribute(t){this.attributes.set(t.getName(),t)}removeAttribute(t){this.attributes.delete(t)}setAttributes(t){this.attributes.clear(),t.forEach(t=>{this.attributes.set(t.getName(),t)})}getAttributes(){let t=new Array;return this.attributes.forEach(e=>{t.push(e)}),t}addString(t){this.addTextNode(new r.TextNode(t))}addTextNode(t){if(this.content.length>0&&this.content[this.content.length-1].getNodeType()===s.Constants.TEXT_NODE){let e=this.content[this.content.length-1];return void e.setValue(e.getValue()+t.getValue())}this.content.push(t)}addElement(t){this.content.push(t)}addComment(t){this.content.push(t)}addProcessingInstruction(t){this.content.push(t)}addCData(t){this.content.push(t)}setContent(t){this.content=t}getContent(){return this.content}getNodeType(){return s.Constants.ELEMENT_NODE}getHead(){let t="<"+this.name;return this.attributes.forEach(e=>{t+=" "+e.toString()}),t+=">",t}getTail(){return"</"+this.name+">"}toString(){let t="<"+this.name;return this.attributes.forEach(e=>{t+=" "+e.toString()}),this.content.length>0?(t+=">",this.content.forEach(e=>{t+=e.toString()}),t+"</"+this.name+">"):t+"/>"}equals(t){if(t instanceof a){if(this.name!==t.name||this.attributes.size!==t.attributes.size||this.content.length!==t.content.length)return!1;let e=!0;if(this.attributes.forEach((n,i)=>{let r=t.getAttribute(i);void 0!==r&&n.getValue()===r.getValue()||(e=!1)}),!e)return!1;for(let e=0;e<this.content.length;e++)if(!this.content[e].equals(t.content[e]))return!1;return!0}return!1}getChildren(){let t=new Array;return this.content.forEach(e=>{e instanceof a&&t.push(e)}),t}getChild(t){let e,n=this.content.length;for(let i=0;i<n;i++){let n=this.content[i];if(n instanceof a&&n.getName()===t){e=n;break}}return e}removeChild(t){let e=this.content.length;for(let n=0;n<e;n++){let e=this.content[n];if(e instanceof a&&e.equals(t)){this.content.splice(n,1);break}}}getText(){let t="";return this.content.forEach(e=>{e instanceof r.TextNode&&(t+=e.getValue()),e instanceof a&&(t+=e.getText())}),t}getPI(t){let e,n=this.content.length;for(let r=0;r<n;r++){let n=this.content[r];if(n instanceof i.ProcessingInstruction&&n.getTarget()===t){e=n;break}}return e}}e.XMLElement=a},3020(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.XMLSchemaParser=void 0;const i=n(3024),r=n(6760),s=n(3136),a=n(2176),o=n(1882),l=n(9350);class c{static instance;static IGNORED_NAMESPACES=new Set([a.Constants.XML_SCHEMA_INSTANCE_NS_URI]);catalog;schemaCache;schemaProcessingStack;visitedSchemas;complexTypeDefinitions;attributeGroupDefinitions;attributeDefinitions;elementDefinitions;collectedDefaults;complexTypeDefaultCache;attributeGroupDefaultCache;constructor(t){this.catalog=t,this.schemaCache=new Map,this.schemaProcessingStack=new Set,this.visitedSchemas=new Set,this.complexTypeDefinitions=new Map,this.attributeGroupDefinitions=new Map,this.attributeDefinitions=new Map,this.elementDefinitions=new Map,this.collectedDefaults=new Map,this.complexTypeDefaultCache=new Map,this.attributeGroupDefaultCache=new Map}static getInstance(t){return c.instance?t&&(c.instance.catalog=t):c.instance=new c(t),c.instance}collectDefaultAttributes(t){const e=this.normalizePath(t),n=this.schemaCache.get(e);if(n)return this.cloneDefaults(n);if(this.schemaProcessingStack.has(e))return new Map;this.schemaProcessingStack.add(e);try{this.resetWorkingState(),this.walkSchema(e),this.elementDefinitions.forEach((t,e)=>{const n=this.computeDefaultsForElement(t);0!==n.size&&(this.collectedDefaults.set(e,this.cloneAttributeDefaultMap(n)),this.collectedDefaults.has(t.localName)||this.collectedDefaults.set(t.localName,this.cloneAttributeDefaultMap(n)))});const t=this.cloneDefaults(this.collectedDefaults);return this.schemaCache.set(e,t),this.cloneDefaults(t)}finally{this.schemaProcessingStack.delete(e)}}resetWorkingState(){this.visitedSchemas=new Set,this.complexTypeDefinitions=new Map,this.attributeGroupDefinitions=new Map,this.attributeDefinitions=new Map,this.elementDefinitions=new Map,this.collectedDefaults=new Map,this.complexTypeDefaultCache=new Map,this.attributeGroupDefaultCache=new Map}cloneDefaults(t){const e=new Map;return t.forEach((t,n)=>{e.set(n,this.cloneAttributeDefaultMap(t))}),e}cloneAttributeDefaultMap(t){const e=new Map;return t.forEach((t,n)=>{const i={localName:t.localName,namespace:t.namespace,lexicalName:t.lexicalName,value:t.value};e.set(n,i)}),e}computeDefaultsForElement(t){const e=this.buildElementKey(t.localName,t.namespace);if(this.collectedDefaults.has(e)){const t=this.collectedDefaults.get(e);return t?this.cloneAttributeDefaultMap(t):new Map}const n=new Map,i=new Set;return this.collectDefaultsFromElementDeclaration(t.element,n,i,t.namespace),n}collectDefaultsFromElementDeclaration(t,e,n,i){const r=t.getChildren();for(let t=0;t<r.length;t++){const s=r[t],a=this.getLocalName(s.getName());"complexType"===a&&this.collectDefaultsFromComplexType(s,e,n,i),"defaultAttributes"===a&&this.collectDefaultsFromAttributeContainer(s,e,n,i)}const s=t.getAttribute("type");if(s){const t=this.resolveTypeDefaults(s.getValue(),i,n);this.mergeMaps(e,t)}}collectDefaultsFromComplexType(t,e,n,i){const r=t.getAttribute("name");if(r){const t=this.buildTypeKey(r.getValue(),i);if(n.has(t))return;n.add(t)}this.collectDefaultsFromAttributeContainer(t,e,n,i)}collectDefaultsFromAttributeContainer(t,e,n,i){const r=t.getChildren();for(let t=0;t<r.length;t++){const s=r[t],a=this.getLocalName(s.getName());if("attribute"!==a){if("attributeGroup"===a){const t=s.getAttribute("ref");if(!t)continue;const n=this.resolveAttributeGroupDefaults(t.getValue(),i);this.mergeMaps(e,n);continue}if("defaultAttributes"!==a)if("complexContent"!==a&&"simpleContent"!==a){if("extension"===a||"restriction"===a){const t=s.getAttribute("base");if(t){const r=this.resolveTypeDefaults(t.getValue(),i,n);this.mergeMaps(e,r)}this.collectDefaultsFromAttributeContainer(s,e,n,i);continue}"complexType"===a&&this.collectDefaultsFromComplexType(s,e,n,i)}else this.collectDefaultsFromAttributeContainer(s,e,n,i);else this.collectDefaultsFromAttributeContainer(s,e,n,i)}else this.recordAttributeDefault(s,e,i)}}recordAttributeDefault(t,e,n){const i=t.getAttribute("default"),r=t.getAttribute("fixed");let s=i??r;const a=t.getAttribute("name"),o=t.getAttribute("ref"),l=t.getAttribute("use"),c=o?this.lookupAttribute(o.getValue(),n):void 0,h=c?c.element:void 0;let u,d,f=c?c.namespace:void 0;if(o?(u=o.getValue(),d=this.getLocalName(u)):a&&(d=a.getValue(),u=d),!d&&h){const t=h.getAttribute("name");t&&(d=t.getValue(),u=t.getValue())}if(!f){const e=t.getAttribute("form");e&&"qualified"===e.getValue()&&(f=n)}if(!u&&d&&(u=d),!d)return;if(l&&"prohibited"===l.getValue()){const t=this.buildAttributeKey(d,f);return e.delete(t),void(f&&e.delete(d))}if(!s&&h){const t=h.getAttribute("fixed");s=h.getAttribute("default")??t??void 0}if(!s)return;const m={localName:d,namespace:f,lexicalName:u??d,value:s.getValue()};this.setAttributeDefault(e,m)}resolveTypeDefaults(t,e,n){const i=this.getLocalName(t),r=this.buildTypeKey(i,e),s=this.complexTypeDefaultCache.get(r);if(s)return this.cloneAttributeDefaultMap(s);const a=this.lookupComplexType(t);if(!a)return new Map;const o=n?new Set(n):new Set;if(o.has(r))return new Map;const l=new Map;return this.collectDefaultsFromComplexType(a,l,o,e),this.complexTypeDefaultCache.set(r,this.cloneAttributeDefaultMap(l)),l}resolveAttributeGroupDefaults(t,e,n){const i=this.getLocalName(t),r=this.buildTypeKey(i,e),s=this.attributeGroupDefaultCache.get(r);if(s)return this.cloneAttributeDefaultMap(s);const a=this.lookupAttributeGroup(t);if(!a)return new Map;const o=n?new Set(n):new Set;if(o.has(r))return new Map;o.add(r);const l=new Map,c=a.getChildren();for(let t=0;t<c.length;t++){const n=c[t],i=this.getLocalName(n.getName());if("attribute"!==i){if("attributeGroup"===i){const t=n.getAttribute("ref");if(!t)continue;const i=this.resolveAttributeGroupDefaults(t.getValue(),e,o);this.mergeMaps(l,i)}}else this.recordAttributeDefault(n,l,e)}return this.attributeGroupDefaultCache.set(r,this.cloneAttributeDefaultMap(l)),l}lookupComplexType(t){const e=this.complexTypeDefinitions.get(t);if(e)return e;const n=this.getLocalName(t),i=this.complexTypeDefinitions.get(n);if(i)return i;const r=Array.from(this.complexTypeDefinitions.entries());for(let t=0;t<r.length;t++){const e=r[t],i=e[0];if(i.endsWith("|"+n)||i===n)return e[1]}}lookupAttributeGroup(t){const e=this.attributeGroupDefinitions.get(t);if(e)return e;const n=this.getLocalName(t),i=this.attributeGroupDefinitions.get(n);if(i)return i;const r=Array.from(this.attributeGroupDefinitions.entries());for(let t=0;t<r.length;t++){const e=r[t],i=e[0];if(i.endsWith("|"+n)||i===n)return e[1]}}lookupAttribute(t,e){const n=this.attributeDefinitions.get(t);if(n)return n;const i=this.getLocalName(t),r=this.buildAttributeKey(i,e),s=this.attributeDefinitions.get(r);if(s)return s;const a=this.attributeDefinitions.get(i);if(a)return a;const o=Array.from(this.attributeDefinitions.entries());for(let t=0;t<o.length;t++){const e=o[t],n=e[0];if(n.endsWith("|"+i)||n===i)return e[1]}}mergeMaps(t,e){e.forEach(e=>{this.setAttributeDefault(t,e)})}walkSchema(t){const e=this.normalizePath(t);if(this.visitedSchemas.has(e))return;if(!(0,i.existsSync)(e))throw new Error(`XML Schema file not found: ${t}`);this.visitedSchemas.add(e);const n=new o.DOMBuilder,s=new l.SAXParser;this.catalog&&s.setCatalog(this.catalog),s.setSchemaLoadingEnabled(!1),s.setContentHandler(n),s.parseFile(e);const a=n.getDocument();if(!a)return;const c=a.getRoot();if(!c)return;const h=c.getAttribute("targetNamespace"),u=h?h.getValue():void 0;this.registerSchemaComponents(c,u),this.processSchemaReferences(c,(0,r.dirname)(e))}processSchemaReferences(t,e){const n=t.getChildren();for(let t=0;t<n.length;t++){const i=n[t],r=this.getLocalName(i.getName());if("include"!==r&&"import"!==r&&"redefine"!==r)continue;const s=i.getAttribute("schemaLocation"),a=i.getAttribute("namespace"),o=s?s.getValue():void 0,l=a?a.getValue():void 0;if(l&&c.shouldIgnoreNamespace(l))continue;const h=this.resolveReference(o,e,l);h&&this.walkSchema(h)}}static shouldIgnoreNamespace(t){return c.IGNORED_NAMESPACES.has(t)}registerSchemaComponents(t,e){const n=t.getChildren();for(let t=0;t<n.length;t++){const i=n[t],r=this.getLocalName(i.getName());if("element"===r){const t=i.getAttribute("name");if(!t)continue;const n=t.getValue(),r=this.buildElementKey(n,e);if(!this.elementDefinitions.has(r)){const t={element:i,namespace:e,localName:n};this.elementDefinitions.set(r,t)}continue}if("complexType"===r){const t=i.getAttribute("name");if(!t)continue;const n=t.getValue(),r=this.buildTypeKey(n,e);this.complexTypeDefinitions.has(r)||this.complexTypeDefinitions.set(r,i),this.complexTypeDefinitions.has(n)||this.complexTypeDefinitions.set(n,i);const s=this.getLocalName(n);this.complexTypeDefinitions.has(s)||this.complexTypeDefinitions.set(s,i);continue}if("attributeGroup"===r){const t=i.getAttribute("name");if(!t)continue;const n=t.getValue(),r=this.buildTypeKey(n,e);this.attributeGroupDefinitions.has(r)||this.attributeGroupDefinitions.set(r,i),this.attributeGroupDefinitions.has(n)||this.attributeGroupDefinitions.set(n,i);const s=this.getLocalName(n);this.attributeGroupDefinitions.has(s)||this.attributeGroupDefinitions.set(s,i);continue}if("attribute"===r){const t=i.getAttribute("name");if(!t)continue;const n=t.getValue(),r=this.buildAttributeKey(n,e),s={element:i,namespace:e};this.attributeDefinitions.has(r)||this.attributeDefinitions.set(r,s),this.attributeDefinitions.has(n)||this.attributeDefinitions.set(n,s);const a=this.getLocalName(n);this.attributeDefinitions.has(a)||this.attributeDefinitions.set(a,s)}}}resolveReference(t,e,n){if(t){if(t.startsWith("file://")){const e=(0,s.fileURLToPath)(t);if((0,i.existsSync)(e))return e}else if((0,r.isAbsolute)(t)){if((0,i.existsSync)(t))return t}else if(!t.startsWith("http://")&&!t.startsWith("https://")){const n=(0,r.resolve)(e,t);if((0,i.existsSync)(n))return n}if(this.catalog){const e=[this.catalog.matchURI(t),this.catalog.matchSystem(t)];for(const t of e){if(!t)continue;const e=t.startsWith("file://")?(0,s.fileURLToPath)(t):t;if((0,i.existsSync)(e))return e}}}if(n&&this.catalog){const t=[this.catalog.matchURI(n),this.catalog.matchSystem(n)];for(const e of t){if(!e)continue;const t=e.startsWith("file://")?(0,s.fileURLToPath)(e):e;if((0,i.existsSync)(t))return t}}if(!t)return;if(t.startsWith("http://")||t.startsWith("https://"))return;const a=(0,r.resolve)(e,t);return(0,i.existsSync)(a)?a:void 0}normalizePath(t){return t.startsWith("file://")?(0,s.fileURLToPath)(t):(0,r.isAbsolute)(t)?t:(0,r.resolve)(t)}getLocalName(t){const e=t.indexOf(":");return-1===e?t:t.substring(e+1)}buildElementKey(t,e){return e?`${e}|${t}`:t}buildTypeKey(t,e){const n=this.getLocalName(t);return e?`${e}|${n}`:n}buildAttributeKey(t,e){const n=this.getLocalName(t);return e?e+"|"+n:n}setAttributeDefault(t,e){const n=this.buildAttributeKey(e.localName,e.namespace),i=[];t.forEach((t,r)=>{if(t.localName!==e.localName)return;const s=t.namespace===e.namespace;s&&r===n||(s||e.namespace&&!t.namespace)&&i.push(r)});for(let e=0;e<i.length;e++)t.delete(i[e]);const r={localName:e.localName,namespace:e.namespace,lexicalName:e.lexicalName,value:e.value};t.set(n,r)}}e.XMLSchemaParser=c},2823(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.XMLUtils=void 0;class n{static SPACES=" \t\r\n";static cleanString(t){let e=n.replaceAll(t,"&","&amp;");return e=n.replaceAll(e,"<","&lt;"),n.replaceAll(e,">","&gt;")}static unquote(t){return n.replaceAll(t,'"',"&quot;")}static normalizeLines(t){let e=n.replaceAll(t,"\r\n","\n");return n.replaceAll(e,"\r","\n")}static isXmlSpace(t){return this.SPACES.includes(t)}static hasParameterEntity(t){let e=t.indexOf("%");if(-1===e)return!1;let n=t.length;for(let i=e+1;i<n;i++){let e=t.charAt(i);if(this.isXmlSpace(e))return!1;if(";"===e)return!0}return!1}static normalizeSpaces(t){return String(t).replaceAll(/\s+/g," ")}static replaceAll(t,e,n){return String(t).split(e).join(n)}static escapeRegExpChars(t){let e="",n=t.length;for(let i=0;i<n;i++){let n=t.charAt(i);"[]{}()^$?*+.".includes(n)&&(e+="\\"),e+=n}return e}static validXml10Chars(t){let e="";for(let i=0;i<t.length;){const r=t.codePointAt(i);n.isValidXml10Char(r)&&(e+=String.fromCodePoint(r)),i+=r>65535?2:1}return e}static isValidXml10Char(t){return 9===t||10==t||13===t||t>=32&&t<=55295||t>=57344&&t<=65533||t>=65536&&t<=1114111}static validXml11Chars(t){let e="";for(let i=0;i<t.length;){const r=t.codePointAt(i);n.isValidXml11Char(r)&&(e+=String.fromCodePoint(r)),i+=r>65535?2:1}return e}static isValidXmlChar(t,e){return"1.1"===t?n.isValidXml11Char(e):n.isValidXml10Char(e)}static ensureValidXmlCodePoint(t,e,i){if(!n.isValidXmlChar(t,e)){const t=e.toString(16).toUpperCase().padStart(4,"0");throw new Error("Malformed XML document: forbidden character U+"+t+" in "+i)}}static ensureValidXmlCharacters(t,e,i){for(let r=0;r<e.length;){const s=e.codePointAt(r);n.ensureValidXmlCodePoint(t,s,i),r+=s>65535?2:1}}static isValidXml11Char(t){return t>=1&&t<=55295||t>=57344&&t<=65533||t>=65536&&t<=1114111}static lookingAt(t,e,n){let i=t.length;if(i+n>e.length)return!1;for(let r=0;r<i;r++)if(e[n+r]!==t[r])return!1;return!0}static isValidXMLName(t){if(0===t.length)return!1;const e=t.charAt(0);if(!n.isNameStartChar(e))return!1;for(let e=1;e<t.length;e++){const i=t.charAt(e);if(!n.isNameChar(i))return!1}return!0}static isNameStartChar(t){const e=t.codePointAt(0);return void 0!==e&&(":"===t||"_"===t||e>=65&&e<=90||e>=97&&e<=122||e>=192&&e<=214||e>=216&&e<=246||e>=248&&e<=767||e>=880&&e<=893||e>=895&&e<=8191||e>=8204&&e<=8205||e>=8304&&e<=8591||e>=11264&&e<=12271||e>=12289&&e<=55295||e>=63744&&e<=64975||e>=65008&&e<=65533||e>=65536&&e<=983039)}static isNameChar(t){const e=t.codePointAt(0);return void 0!==e&&(!!n.isNameStartChar(t)||"-"===t||"."===t||e>=48&&e<=57||183===e||e>=768&&e<=879||e>=8255&&e<=8256)}static isValidNCName(t){if(0===t.length)return!1;if(t.includes(":"))return!1;const e=t.charAt(0);if(!n.isNCNameStartChar(e))return!1;for(let e=1;e<t.length;e++){const i=t.charAt(e);if(!n.isNameChar(i))return!1}return!0}static isNCNameStartChar(t){const e=t.codePointAt(0);return void 0!==e&&("_"===t||e>=65&&e<=90||e>=97&&e<=122||e>=192&&e<=214||e>=216&&e<=246||e>=248&&e<=767||e>=880&&e<=893||e>=895&&e<=8191||e>=8204&&e<=8205||e>=8304&&e<=8591||e>=11264&&e<=12271||e>=12289&&e<=55295||e>=63744&&e<=64975||e>=65008&&e<=65533||e>=65536&&e<=983039)}static isValidNMTOKEN(t){if(0===t.length)return!1;for(let e=0;e<t.length;e++){const i=t.charAt(e);if(!n.isNameChar(i))return!1}return!0}}e.XMLUtils=n},4823(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.XMLWriter=void 0;const i=n(3024),r=n(9162);e.XMLWriter=class{file;options={encoding:"utf8"};started;constructor(t){this.file=t,this.started=!1}writeNode(t){if(t instanceof r.XMLDeclaration&&"UTF-16LE"===t.getEncoding()&&(this.options.encoding="utf16le",this.started||((0,i.writeFileSync)(this.file,"\ufeff",this.options),this.started=!0)),!this.started)return this.started=!0,void(0,i.writeFileSync)(this.file,t.toString(),this.options);(0,i.appendFileSync)(this.file,t.toString(),this.options)}writeString(t){if(!this.started)return this.started=!0,void(0,i.writeFileSync)(this.file,t,this.options);(0,i.appendFileSync)(this.file,t,this.options)}static writeDocument(t,e){let n={encoding:"utf8"},r=t.getXmlDeclaration();r&&"UTF-16LE"===r.getEncoding()&&(n.encoding="utf16le"),"utf16le"!==n.encoding?(0,i.writeFileSync)(e,t.toString(),n):(0,i.writeFileSync)(e,"\ufeff"+t.toString(),n)}}},9445(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AttDecl=void 0;const i=n(2176),r=n(2823);class s{name;attType;defaultDecl;defaultValue;enumeration=[];notationValues=[];constructor(t,e,n,i){this.name=t,this.attType=e,this.defaultDecl=n,this.defaultValue=i,this.getType()}getName(){return this.name}getType(){if(!["CDATA","ID","IDREF","IDREFS","NMTOKEN","NMTOKENS","ENTITY","ENTITIES"].includes(this.attType))if(this.attType.startsWith("NOTATION"))this.notationValues=this.parseNotationType(this.attType);else{if(!this.attType.startsWith("(")||!this.attType.endsWith(")"))throw new Error(`Invalid attribute type: ${this.attType}`);this.enumeration=this.parseEnumerationValues(this.attType)}return this.attType}getDefaultDecl(){return this.defaultDecl}getDefaultValue(){return this.defaultValue}getNodeType(){return i.Constants.ATTRIBUTE_DECL_NODE}equals(t){return t instanceof s&&this.name===t.name&&this.attType===t.attType&&this.defaultDecl===t.defaultDecl&&this.defaultValue===t.defaultValue}toString(){let t=this.name+" "+this.attType+" "+this.defaultDecl;return this.defaultValue&&(this.defaultValue.includes(" ")&&!this.defaultValue.startsWith('"')?t+=' "'+this.defaultValue+'"':t+=" "+this.defaultValue),t.trim()}isValid(t){return"CDATA"===this.attType||("ID"===this.attType||"IDREF"===this.attType?r.XMLUtils.isValidXMLName(t):"IDREFS"===this.attType?t.split(/\s+/).every(t=>r.XMLUtils.isValidXMLName(t)):"NMTOKEN"===this.attType?r.XMLUtils.isValidNMTOKEN(t):"NMTOKENS"===this.attType?t.split(/\s+/).every(t=>r.XMLUtils.isValidNMTOKEN(t)):"ENTITY"===this.attType?r.XMLUtils.isValidXMLName(t):"ENTITIES"===this.attType?t.split(/\s+/).every(t=>r.XMLUtils.isValidXMLName(t)):this.attType.startsWith("(")?(0===this.enumeration.length&&(this.enumeration=this.parseEnumerationValues(this.attType)),this.enumeration.includes(t)):!this.attType.startsWith("NOTATION")||(0===this.notationValues.length&&(this.notationValues=this.parseNotationType(this.attType)),this.notationValues.includes(t)))}parseNotationType(t){const e=t.indexOf("("),n=t.lastIndexOf(")");if(-1===e||-1===n||n<=e+1)throw new Error(`Invalid NOTATION attribute type: ${t}`);if("NOTATION"!==t.substring(0,e).trim())throw new Error(`Invalid NOTATION attribute type: ${t}`);if(0!==t.substring(n+1).trim().length)throw new Error(`Invalid NOTATION attribute type: ${t}`);const i=t.substring(e+1,n).split("|").map(t=>t.trim()).filter(t=>t.length>0);if(0===i.length)throw new Error(`Empty NOTATION name list: ${t}`);for(const e of i)if(!r.XMLUtils.isValidXMLName(e))throw new Error(`Invalid NOTATION name "${e}" in attribute type: ${t}`);return i}parseEnumerationValues(t){const e=t.substring(1,t.length-1).split("|").map(t=>t.trim()).filter(t=>t.length>0);if(0===e.length)throw new Error(`Empty enumeration attribute type: ${t}`);for(const n of e)if(!r.XMLUtils.isValidNMTOKEN(n))throw new Error(`Invalid enumeration value "${n}" for attribute type: ${t}`);return e}getEnumeration(){return this.enumeration}}e.AttDecl=s},4241(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AttListDecl=void 0;const i=n(2176),r=n(2823),s=n(9445);class a{name;attributes;static attTypes=["CDATA","ID","IDREF","IDREFS","ENTITY","ENTITIES","NMTOKEN","NMTOKENS"];constructor(t,e){this.name=t,this.attributes=new Map,this.parseAttributes(e)}getName(){return this.name}getAttributes(){return this.attributes}parseAttributes(t){const e=this.split(t),n={index:0};let i=0;for(;n.index<e.length;){const a=e[n.index++];if(!a)continue;if(!r.XMLUtils.isValidXMLName(a))throw new Error("Invalid attribute name in ATTLIST declaration: '"+a+"'");const o=this.locateToken(t,a,i);if(i=o.position+o.length,n.index>=e.length)throw new Error("Missing attribute type for attribute '"+a+"'");const l=this.readAttributeType(e,n);if(!this.isValidAttributeType(l))throw new Error("Invalid attribute type in ATTLIST declaration: '"+l+"'");const c=this.locateToken(t,l,i);i=c.position+c.length;let h="",u="";if(n.index<e.length){const s=e[n.index];if("#REQUIRED"===s||"#IMPLIED"===s){const e=this.locateToken(t,s,i);this.ensureSeparated(t,i,e.position,l,s),i=e.position+e.length,h=s,n.index++}else if("#FIXED"===s){const r=this.locateToken(t,s,i);if(this.ensureSeparated(t,i,r.position,l,s),i=r.position+r.length,h=s,n.index++,n.index>=e.length)throw new Error("Invalid attribute declaration: missing value for #FIXED attribute '"+a+"'");const o=e[n.index++],c=this.locateToken(t,o,i);this.ensureSeparated(t,i,c.position,s,o),u=this.isQuotedValue(o)?this.trimQuotes(o):o,i=c.position+c.length}else if(s&&this.isQuotedValue(s)){const e=this.locateToken(t,s,i);this.ensureSeparated(t,i,e.position,l,s),h=s,u=this.trimQuotes(s),i=e.position+e.length,n.index++}else if(s&&!r.XMLUtils.isValidXMLName(s))throw new Error("Invalid attribute declaration: unexpected token '"+s+"' after attribute type '"+l+"'")}const d=new s.AttDecl(a,l,h,u);this.attributes.set(a,d)}}split(t){let e=[],n="",i=!1,r="";for(let s=0;s<t.length;s++){let a=t.charAt(s);'"'!==a&&"'"!==a||i?i&&a===r?(i=!1,r="",n+=a,n.length>0&&(e.push(n),n="")):" "!==a&&"\n"!==a&&"\r"!==a&&"\t"!==a||i?n+=a:n.length>0&&(e.push(n),n=""):(n.length>0&&(e.push(n),n=""),i=!0,r=a,n+=a)}return n.length>0&&e.push(n),e}readAttributeType(t,e){let n=t[e.index++];if("NOTATION"===n){if(e.index>=t.length)throw new Error("Expected NOTATION enumeration in ATTLIST declaration");let n=t[e.index++];return n=this.readParenthesized(n,t,e),"NOTATION "+n}return n.includes("(")?this.readParenthesized(n,t,e):n}readParenthesized(t,e,n){let i=t,r=this.countParenthesis(t);for(;r>0;){if(n.index>=e.length)throw new Error("Unterminated parenthesized list in ATTLIST declaration");const t=e[n.index++];i+=" "+t,r+=this.countParenthesis(t)}return this.normalizeEnumeration(i)}countParenthesis(t){let e=0;for(const n of t)"("===n?e++:")"===n&&e--;return e}normalizeEnumeration(t){let e=t.replaceAll(/\s+/g," ");return e=e.replaceAll(/\s*\|\s*/g,"|"),e=e.replaceAll(/\(\s*/g,"("),e=e.replaceAll(/\s*\)/g,")"),e.trim()}isQuotedValue(t){return t.startsWith('"')&&t.endsWith('"')||t.startsWith("'")&&t.endsWith("'")}trimQuotes(t){return this.isQuotedValue(t)?t.substring(1,t.length-1):t}isValidAttributeType(t){if(a.attTypes.includes(t))return!0;if(t.startsWith("NOTATION ")){const e=t.substring(9).trim();return e.startsWith("(")&&e.endsWith(")")}return!(!t.startsWith("(")||!t.endsWith(")"))}locateToken(t,e,n){const i=t.indexOf(e,n);if(-1!==i)return{position:i,length:e.length};if(e.startsWith("(")&&e.endsWith(")")){const i=this.normalizeEnumeration(e);let r=n;for(;r<t.length;){const e=t.indexOf("(",r);if(-1===e)break;let n=0,s=e;for(;s<t.length;){const r=t.charAt(s);if("("===r)n++;else if(")"===r&&(n--,0===n)){const n=t.substring(e,s+1);if(this.normalizeEnumeration(n)===i)return{position:e,length:n.length};s++;break}s++}if(n>0)break;r=s}}throw new Error("Invalid attribute declaration: unable to locate token '"+e+"'")}ensureSeparated(t,e,n,i,r){if(n<e)throw new Error("Invalid attribute declaration: unexpected ordering between '"+i+"' and '"+r+"'");const s=t.substring(e,n);if(!this.containsWhitespace(s))throw new Error("Invalid attribute declaration: missing whitespace between '"+i+"' and '"+r+"'")}containsWhitespace(t){for(const e of t)if(r.XMLUtils.isXmlSpace(e))return!0;return!1}getNodeType(){return i.Constants.ATTRIBUTE_LIST_DECL_NODE}toString(){let t="<!ATTLIST "+this.name+"\n";return this.attributes.forEach(e=>{t+=" "+e.toString()+"\n"}),t+">"}equals(t){if(t instanceof a){let e=t.getAttributes();if(this.name!==t.getName()||this.attributes.size!==e.size)return!1;for(let[t,n]of this.attributes){let i=e.get(t);if(void 0===i)return!1;if(!n.equals(i))return!1}return!0}return!1}}e.AttListDecl=a},5614(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ContentModel=e.ContentModelType=e.Cardinality=void 0;const i=n(6645),r=n(9541),s=n(2711),a=n(2097);e.Cardinality={NONE:0,OPTIONAL:1,ZEROMANY:2,ONEMANY:3},e.ContentModelType={EMPTY:"EMPTY",ANY:"ANY",MIXED:"Mixed",PCDATA:"#PCDATA",CHILDREN:"Children"};class o{content;type=e.ContentModelType.EMPTY;constructor(t,e){this.content=t,this.type=e}static parse(t){return new o([],e.ContentModelType.EMPTY).parseSpec(t)}getContent(){return this.content}getType(){return this.type}validateParentheses(t){let e=0;for(let n of t)if("("==n?e++:")"==n&&e--,e<0)throw new Error("Unbalanced parentheses in content model: "+t);if(0!=e)throw new Error("Unbalanced parentheses in content model: "+t)}parseSpec(t){let n=t.replaceAll(/\s+/g,"");const i=t.match(/\S\s+([*+?])/);if(i){const t=i[1];throw new Error('Invalid content model: whitespace not allowed before "'+t+'"')}try{this.validateParentheses(n)}catch(t){throw t}if(-1!==n.indexOf(e.ContentModelType.PCDATA)&&!n.startsWith("(#PCDATA"))throw new Error("Invalid mixed content model: #PCDATA must be the first token");let a=new Array,l=e.ContentModelType.CHILDREN;if(n===e.ContentModelType.EMPTY)return l=e.ContentModelType.EMPTY,new o(a,l);if(n===e.ContentModelType.ANY)return l=e.ContentModelType.ANY,new o(a,l);if("(#PCDATA)"===n)return a.push(new s.DTDPCData),new o(a,e.ContentModelType.MIXED);if(n.startsWith("(#PCDATA")&&(l=e.ContentModelType.MIXED,!n.endsWith(")*")))throw new Error("Invalid mixed content model: "+t);const c=[];let h="";for(let t=0;t<n.length;t++){const e=n[t];"()|,?*+".includes(e)?(h.trim().length>0&&(c.push(h.trim()),h=""),c.push(e)):h+=e}h.trim().length>0&&c.push(h.trim());const u=[];let d=[];for(let t of c)if("("===t)u.push(d),d=[];else if(")"===t){const t=this.processGroup(d);d=u.pop(),d.push(t)}else if("*"===t||"+"===t||"?"===t){if(0===d.length)throw new Error('Cardinality operator "'+t+'" must follow a valid particle');const n=d[d.length-1];if(!this.isContentParticle(n))throw new Error('Cardinality operator "'+t+'" must follow a valid particle');const i="?"===t?e.Cardinality.OPTIONAL:"*"===t?e.Cardinality.ZEROMANY:e.Cardinality.ONEMANY;n.setCardinality(i)}else"|"===t||","===t?d.push(t):t===e.ContentModelType.PCDATA?d.push(new s.DTDPCData):d.push(new r.DTDName(t));for(const t of d){if(!this.isContentParticle(t))throw new Error("Invalid object in content model: "+t);a.push(t)}return new o(a,l)}isContentParticle(t){return t instanceof r.DTDName||t instanceof i.DTDChoice||t instanceof a.DTDSecuence||t instanceof s.DTDPCData}processGroup(t){if(0===t.length)throw new Error("Empty group found in content model");if(1===t.length){let e=t[0];if("string"==typeof e)return new r.DTDName(e);if(e instanceof i.DTDChoice)return e;if(e instanceof a.DTDSecuence)return e;if(e instanceof r.DTDName)return e;if(e instanceof s.DTDPCData)return e;throw new Error("Invalid object in content model group: "+e)}let e=null;for(let n of t)if("string"==typeof n&&("|"===n||","===n)){e=n;break}if(null===e)throw new Error("No separator found when parsing group");let n="|"===e?new i.DTDChoice:new a.DTDSecuence;for(let e of t)if("|"!==e&&","!==e)if("string"==typeof e)n.addParticle(new r.DTDName(e));else if(e instanceof i.DTDChoice)n.addParticle(e);else if(e instanceof a.DTDSecuence)n.addParticle(e);else if(e instanceof r.DTDName)n.addParticle(e);else{if(!(e instanceof s.DTDPCData))throw new Error("Invalid object in content model group: "+e);n.addParticle(e)}return n}toString(){if(this.type===e.ContentModelType.EMPTY)return e.ContentModelType.EMPTY;if(this.type===e.ContentModelType.ANY)return e.ContentModelType.ANY;if(0===this.content.length)return"";let t="";if(this.type===e.ContentModelType.MIXED){t+="(";for(let e=0;e<this.content.length;e++)t+=this.content[e].toString(),e<this.content.length-1&&(t+="|");return t+=")*",t}for(let e=0;e<this.content.length;e++)t+=this.content[e].toString(),e<this.content.length-1&&(t+=",");return t}isMixed(){return this.type===e.ContentModelType.MIXED}getChildren(){if(this.type===e.ContentModelType.EMPTY)return new Set;const t=new Set;for(const e of this.content){if(e instanceof r.DTDName&&t.add(e.getName()),e instanceof i.DTDChoice){const n=e;for(const e of n.getChildren())t.add(e)}if(e instanceof a.DTDSecuence){const n=e;for(const e of n.getChildren())t.add(e)}}return t}validateChildren(t){if(this.type===e.ContentModelType.MIXED){const e=this.getChildren();for(const n of t)if(!e.has(n))return!1;return!0}if(this.type!==e.ContentModelType.CHILDREN)return!0;if(0===this.content.length)return 0===t.length;let n=0;for(const e of this.content){const i=this.matchParticle(e,t,n);if(-1===i)return!1;n=i}return n===t.length}matchParticle(t,e,n){return t instanceof r.DTDName?this.matchNameParticle(t,e,n):t instanceof a.DTDSecuence?this.matchSequenceParticle(t,e,n):t instanceof i.DTDChoice?this.matchChoiceParticle(t,e,n):t instanceof s.DTDPCData?n:-1}matchNameParticle(t,e,n){const i=this.getMinOccurs(t.getCardinality()),r=this.getMaxOccurs(t.getCardinality());let s=n,a=0;for(;s<e.length&&a<r&&e[s]===t.getName();)s++,a++;return a<i?-1:s}matchSequenceParticle(t,e,n){const i=this.getMinOccurs(t.getCardinality()),r=this.getMaxOccurs(t.getCardinality());let s=n,a=0;for(;a<r;){const n=s,i=this.matchSequenceOnce(t,e,n);if(-1===i)break;if(s=i,a++,i===n)break}return a<i?-1:s}matchChoiceParticle(t,e,n){const i=this.getMinOccurs(t.getCardinality()),r=this.getMaxOccurs(t.getCardinality());let s=n,a=0;for(;a<r;){const n=s;let i=!1;for(const r of t.getParticles()){const t=this.matchParticle(r,e,n);if(-1!==t){s=t,i=!0;break}}if(!i)break;if(a++,s===n)break}return a<i?-1:s}matchSequenceOnce(t,e,n){let i=n;for(const n of t.getParticles()){const t=this.matchParticle(n,e,i);if(-1===t)return-1;i=t}return i}getMinOccurs(t){switch(t){case e.Cardinality.OPTIONAL:case e.Cardinality.ZEROMANY:return 0;case e.Cardinality.ONEMANY:case e.Cardinality.NONE:default:return 1}}getMaxOccurs(t){switch(t){case e.Cardinality.ZEROMANY:case e.Cardinality.ONEMANY:return Number.MAX_SAFE_INTEGER;case e.Cardinality.OPTIONAL:case e.Cardinality.NONE:default:return 1}}}e.ContentModel=o},2684(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DTDChoiceModel=void 0;const i=n(2823),r=n(4485);e.DTDChoiceModel=class{cardinality="";choices=[];constructor(t){t&&(this.choices=t)}getType(){return"choice"}addChoice(t){this.choices.push(t)}getChoices(){return this.choices}validate(){if(this.cardinality&&!["*","+","?"].includes(this.cardinality))return!1;if(0===this.choices.length)return!1;for(const t of this.choices){if(!t.validate())return!1;if(t instanceof r.DTDElementNameParticle){const e=t.getName();if("#PCDATA"!==e&&!i.XMLUtils.isValidXMLName(e))return!1}}return!0}toBNF(){return this.choices.map(t=>t.toBNF()).join(" | ")+(this.cardinality?this.cardinality:"")}}},9603(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DTDContentModelParser=void 0;const i=n(2823),r=n(2684),s=n(8631),a=n(4485),o=n(2826);e.DTDContentModelParser=class{tokens;pos=0;constructor(t){const e=new s.DTDContentModelTokenizer(t);this.tokens=e.tokenize()}parseParticle(){const t=this.peek();if(!t)throw new Error("Unexpected end of content model");if("("===t.type){this.next();const t=this.peek();return t&&"PCDATA"===t.type?this.parseMixed():this.parseGroup()}if("NAME"===t.type)return this.parseNameParticle();throw new Error("Expected (, or NAME in particle")}parse(){if(0===this.tokens.length)throw new Error("Empty content model");return this.parseParticle()}parseGroup(){let t=[],e=null,n=!0,i=!1;for(;;){const r=this.peek();if(!r)throw new Error("Unexpected end of content model");if(")"===r.type){this.next();break}if(n){if("PCDATA"===r.type)return this.parseMixed();let e=this.parseParticle();if(!e)throw new Error("Expected particle in group");t.push(e),n=!1,i=!1}else{if(","!==r.type&&"|"!==r.type){if(")"===r.type){this.next();break}throw new Error("Expected , | or ) in group")}if(e&&e!==r.type)throw new Error("Mixed separators in group");e=r.type,this.next(),n=!0,i=!0}}if(0===t.length)throw new Error("Empty group not allowed");if(i)throw new Error("Trailing separator in group");if(!e&&t.length>1)throw new Error("Missing separator in group");let s=this.parseCardinality();if("|"===e){const e=new r.DTDChoiceModel(t);return e.cardinality=s,e}if(","===e){const e=new o.DTDSequenceModel(t);return e.cardinality=s,e}if(1===t.length)return s&&"cardinality"in t[0]&&(t[0].cardinality=s),t[0];throw new Error("Invalid group structure")}parseMixed(){this.expect("PCDATA");let t=new r.DTDChoiceModel;for(t.addChoice(new a.DTDElementNameParticle("#PCDATA"));this.match("|");)if(this.expect("|"),this.match("NAME")){let e=this.expect("NAME").value;t.addChoice(new a.DTDElementNameParticle(e))}else{if(!this.match("PCDATA"))throw new Error("Expected NAME or #PCDATA in mixed content");this.expect("PCDATA"),t.addChoice(new a.DTDElementNameParticle("#PCDATA"))}this.expect(")");let e=this.parseCardinality();if(e&&"*"!==e)throw new Error("Mixed content must end with )* or be (#PCDATA)");return t.cardinality=e,t}parseNameParticle(){let t=this.expect("NAME").value;if(!i.XMLUtils.isValidXMLName(t))throw new Error("Invalid XML name in content model: "+t);let e=this.parseCardinality();return new a.DTDElementNameParticle(t,e)}parseCardinality(){return this.match("*")?this.expect("*").value:this.match("+")?this.expect("+").value:this.match("?")?this.expect("?").value:""}match(t){return this.peek()?.type===t}peek(){if(!(this.pos>=this.tokens.length))return this.tokens[this.pos]}expect(t){if(!this.match(t))throw new Error("Expected "+t+", got "+(this.peek()?.type||"EOF"));if(this.pos>=this.tokens.length)throw new Error("Unexpected end of input");return this.tokens[this.pos++]}next(){if(!(this.pos>=this.tokens.length))return this.tokens[this.pos++]}}},8631(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DTDContentModelTokenizer=void 0;const i=n(2823);e.DTDContentModelTokenizer=class{input;pos=0;tokens=[];constructor(t){this.input=t}tokenize(){for(;this.pos<this.input.length;){let t=this.input[this.pos];if(/\s/.test(t))this.pos++;else if("("!==t&&")"!==t&&","!==t&&"|"!==t&&"*"!==t&&"+"!==t&&"?"!==t){if(!this.input.startsWith("#PCDATA",this.pos)){if(this.pos<this.input.length&&i.XMLUtils.isNameStartChar(this.input[this.pos])){const t=this.pos;for(this.pos++;this.pos<this.input.length&&i.XMLUtils.isNameChar(this.input[this.pos]);)this.pos++;const e=this.input.substring(t,this.pos);this.tokens.push({type:"NAME",value:e});continue}throw new Error("Unexpected character in content model: "+t)}this.tokens.push({type:"PCDATA",value:"#PCDATA"}),this.pos+=7}else this.tokens.push({type:t,value:t}),this.pos++}return this.tokens}}},4485(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DTDElementNameParticle=void 0;const i=n(2823);e.DTDElementNameParticle=class{name;cardinality="";constructor(t,e){this.name=t,e&&(this.cardinality=e)}getType(){return"element"}getName(){return this.name}getCardinality(){return this.cardinality}validate(){return!(this.cardinality&&!["*","+","?"].includes(this.cardinality))&&("#PCDATA"===this.name||!!this.name&&i.XMLUtils.isValidXMLName(this.name))}toBNF(){return this.name+(this.cardinality?this.cardinality:"")}}},8717(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DTDGrammar=void 0;const i=n(9542),r=n(2823),s=n(5614),a=n(2243);e.DTDGrammar=class{models;entitiesMap;attributesMap;elementDeclMap;notationsMap;constructor(){this.models=new Map,this.elementDeclMap=new Map,this.attributesMap=new Map,this.entitiesMap=new Map,this.notationsMap=new Map,this.addPredefinedEntities()}addPredefinedEntities(){this.addEntity(new a.EntityDecl("lt",!1,"<","","","")),this.addEntity(new a.EntityDecl("gt",!1,">","","","")),this.addEntity(new a.EntityDecl("amp",!1,"&","","","")),this.addEntity(new a.EntityDecl("apos",!1,"'","","","")),this.addEntity(new a.EntityDecl("quot",!1,'"',"","",""))}getContentModel(t){return this.models.get(t)}toString(){let t="";return this.models.forEach(e=>{t=t+e.toString()+"\n"}),t}addElement(t,e=!1){const n=t.getName();!e&&this.elementDeclMap.has(n)||this.elementDeclMap.set(n,t)}addAttributes(t,e,n=!1,i){let r=this.attributesMap.get(t);r||(r=new Map,this.attributesMap.set(t,r)),n?e.forEach((t,e)=>{i&&i.has(e)?r.set(e,t):r.has(e)||r.set(e,t)}):e.forEach((t,e)=>{r.has(e)||r.set(e,t)})}resolveParameterEntities(t){for(;r.XMLUtils.hasParameterEntity(t);){let e=t.indexOf("%"),n=t.indexOf(";"),i=t.substring(e+1,n),r=this.getParameterEntity(i);if(void 0===r)throw new Error("Unknown entity: "+i);t=t.replaceAll("%"+i+";",r.getValue())}return t}addEntity(t,e=!1){const n=t.isParameterEntity()?`%${t.getName()}`:t.getName();!e&&this.entitiesMap.has(n)||this.entitiesMap.set(n,t)}getEntity(t){return this.entitiesMap.get(t)}getParameterEntity(t){return this.entitiesMap.get(`%${t}`)}addNotation(t,e=!1){const n=t.getName();!e&&this.notationsMap.has(n)||this.notationsMap.set(n,t)}merge(t){t.getEntitiesMap().forEach((t,e)=>{this.entitiesMap.has(e)||this.entitiesMap.set(e,t)}),t.getAttributesMap().forEach((t,e)=>{this.attributesMap.has(e)||this.attributesMap.set(e,t)}),t.getElementDeclMap().forEach((t,e)=>{this.elementDeclMap.has(e)||this.elementDeclMap.set(e,t)}),t.getNotationsMap().forEach((t,e)=>{this.notationsMap.has(e)||this.notationsMap.set(e,t)})}getNotationsMap(){return this.notationsMap}getElementDeclMap(){return this.elementDeclMap}getEntitiesMap(){return this.entitiesMap}processModels(){this.elementDeclMap.forEach(t=>{let e=t.getName();r.XMLUtils.hasParameterEntity(e)&&(e=this.resolveParameterEntities(e));let n=t.getContentSpec();r.XMLUtils.hasParameterEntity(n)&&(n=this.resolveParameterEntities(n));let i=s.ContentModel.parse(n);this.models.set(e,i)})}getAttributesMap(){return this.attributesMap}getElementAttributesMap(t){return this.attributesMap.get(t)}validateElement(t,e){if(-1!==t.indexOf(":"))return i.ValidationResult.success();if(!this.elementDeclMap.get(t))return i.ValidationResult.error('Element "'+t+'" is not declared in the DTD');const n=this.getContentModel(t);return n?"EMPTY"===n.getType()&&e.length>0?i.ValidationResult.error('Element "'+t+'" is declared as EMPTY but has child elements'):n.getType()===s.ContentModelType.ANY?i.ValidationResult.success():n.getType()===s.ContentModelType.PCDATA?e.length>0?i.ValidationResult.error('Element "'+t+'" is declared as #PCDATA but has child elements'):i.ValidationResult.success():n.getType()===s.ContentModelType.MIXED||n.getType()===s.ContentModelType.CHILDREN?n.validateChildren(e)?i.ValidationResult.success():i.ValidationResult.error('Element "'+t+'" has invalid child elements as per CHILDREN content model:'+n.toString()):i.ValidationResult.success():i.ValidationResult.error('No content model found for element "'+t+'" in the DTD')}validateAttributes(t,e){const n=this.getElementAttributes(t);if(0===n.size){for(const[n,r]of e)if(!["xml:lang","xml:space","xml:base","xml:id"].includes(n))return i.ValidationResult.error('Undeclared attribute "'+n+'" found in element "'+t+'"');return i.ValidationResult.success()}const r=this.attributesMap.get(t);for(const[s,a]of e){if(!n.has(s))return i.ValidationResult.error('Undeclared attribute "'+s+'" found in element "'+t+'"');if(r){const e=r.get(s);if(e){const n=this.validateAttributeValue(s,a,e,t);if(!n.isValid)return n}}}for(const[r,s]of n)if("required"===s.use&&!e.has(r))return i.ValidationResult.error('Required attribute "'+r+'" is missing from element "'+t+'"');return i.ValidationResult.success()}validateAttributeValue(t,e,n,r){const s=n.getType();if("ID"===s||"IDREF"===s||"IDREFS"===s)return i.ValidationResult.success();if(!n.isValid(e))return i.ValidationResult.error("Invalid value "+e+" for attribute "+t+" of type "+s+" in element "+r);if("ENTITY"===s){if(!this.entityExists(e))return i.ValidationResult.error('Entity "'+e+'" referenced in attribute "'+t+'" is not declared in element "'+r+'"')}else if("ENTITIES"===s){const n=e.split(/\s+/);for(const e of n)if(!this.entityExists(e))return i.ValidationResult.error('Entity "'+e+'" referenced in attribute "'+t+'" is not declared in element "'+r+'"')}if(s.startsWith("NOTATION")&&!this.notationExists(e))return i.ValidationResult.error('Notation "'+e+'" referenced in attribute "'+t+'" is not declared in element "'+r+'"');if(s.startsWith("(")&&s.endsWith(")")&&!n.getEnumeration().includes(e))return i.ValidationResult.error('Value "'+e+'" for attribute "'+t+'" is not in the enumeration '+n.getType()+' in element "'+r+'"');const a=this.extractEntityReferences(e);for(const e of a)if(!this.entityExists(e))return i.ValidationResult.error('Entity "'+e+'" referenced in attribute "'+t+'" is not declared in element "'+r+'"');return i.ValidationResult.success()}entityExists(t){return void 0!==this.getEntity(t)}notationExists(t){return this.notationsMap.has(t)}extractEntityReferences(t){const e=[];let n=0;for(;n<t.length;){const i=t.indexOf("&",n);if(-1===i)break;const s=t.indexOf(";",i+1);if(-1===s)break;const a=t.substring(i+1,s);a.length>0&&r.XMLUtils.isValidXMLName(a)&&e.push(a),n=s+1}return e}getElementAttributes(t){if(-1!==t.indexOf(":"))return new Map;const e=new Map,n=this.getElementAttributesMap(t);return n&&n.forEach((t,n)=>{const r=this.mapDTDAttributeUse(t),s=t.getType(),a=t.getDefaultValue();e.set(n,new i.AttributeInfo(n,s,r,a))}),e}getDefaultAttributes(t){if(-1!==t.indexOf(":"))return new Map;const e=new Map,n=this.getElementAttributesMap(t);return n&&n.forEach((t,n)=>{const i=t.getDefaultValue();i&&"#IMPLIED"!==t.getDefaultDecl()&&"#REQUIRED"!==t.getDefaultDecl()&&e.set(n,i)}),e}resolveEntity(t){const e=this.getEntity(t);if(!e)return;const n=e.getUnresolvedError();if(n)throw new Error(n);return e.getValue()}getGrammarType(){return i.GrammarType.DTD}getTargetNamespace(){}getNamespaceDeclarations(){return new Map}mapDTDAttributeUse(t){switch(t.getDefaultDecl()){case"#REQUIRED":return i.AttributeUse.REQUIRED;case"#IMPLIED":return i.AttributeUse.IMPLIED;case"#FIXED":return i.AttributeUse.FIXED;default:return i.AttributeUse.OPTIONAL}}}},449(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DTDParser=void 0;const i=n(3024),r=n(6760),s=n(6964),a=n(2823),o=n(4241),l=n(8717),c=n(4786),h=n(2243),u=n(5390);class d{grammar;catalog;pointer=0;source="";currentFile="";baseDirectory="";validating=!1;overrideExistingDeclarations=!1;preexistingEntityKeys=new Set;preexistingAttributeKeys=new Map;unresolvedExternalEntities=new Map;parsingInternalSubset=!1;xmlVersion="1.0";openConditionalSections=0;constructor(t,e){this.grammar=t||new l.DTDGrammar,e&&(this.baseDirectory=e)}setGrammar(t){this.grammar=t}setOverrideExistingDeclarations(t){this.overrideExistingDeclarations=t}setValidating(t){this.validating=t}setCatalog(t){this.catalog=t}setXmlVersion(t){this.xmlVersion="1.1"!==t?"1.0":"1.1"}parseDTD(t){if(this.parseFile(t),this.grammar.processModels(),0!==this.openConditionalSections)throw new Error("Malformed conditional section: missing closing ']]>'");return this.grammar}parseFile(t){const e=this.parsingInternalSubset;this.parsingInternalSubset=!1;try{this.source="";let e=(0,i.statSync)(t,{bigint:!1,throwIfNoEntry:!0});this.currentFile=t;let n=e.blksize,r=(0,i.openSync)(t,"r"),s=Buffer.alloc(n),a=(0,i.readSync)(r,s,0,n,0);for(;a>0;)this.source+=s.toString("utf8",0,a),a=(0,i.readSync)(r,s,0,n,this.source.length);return(0,i.closeSync)(r),this.parse()}finally{this.parsingInternalSubset=e}}parseString(t){const e=this.parsingInternalSubset;this.parsingInternalSubset=!0;try{return this.source=t,this.parse(),this.grammar.processModels(),this.grammar}finally{this.parsingInternalSubset=e}}parse(){if(this.pointer=0,this.preexistingEntityKeys=new Set,this.preexistingAttributeKeys=new Map,this.unresolvedExternalEntities.clear(),this.openConditionalSections=0,this.overrideExistingDeclarations){for(const t of this.grammar.getEntitiesMap().keys())this.preexistingEntityKeys.add(t);this.grammar.getAttributesMap().forEach((t,e)=>{const n=new Set;t.forEach((t,e)=>{n.add(e)}),this.preexistingAttributeKeys.set(e,n)})}for(;this.pointer<this.source.length;){if(this.lookingAt("<!ELEMENT")){let t=this.findDeclarationEnd(this.pointer);if(-1===t)throw new Error("Malformed element declaration");let e=this.source.substring(this.pointer,t+1),n=e.length,i=this.parseElementDeclaration(e);this.grammar.addElement(i,this.overrideExistingDeclarations),this.pointer+=n;continue}if(this.lookingAt("<!ATTLIST")){let t=this.findDeclarationEnd(this.pointer);if(-1===t)throw new Error("Malformed attribute declaration");let e=this.source.substring(this.pointer,t+1),n=e.length,i=this.parseAttributesListDeclaration(e);const r=this.overrideExistingDeclarations?this.preexistingAttributeKeys.get(i.getName()):void 0;this.grammar.addAttributes(i.getName(),i.getAttributes(),this.overrideExistingDeclarations,r),this.pointer+=n;continue}if(this.lookingAt("<!ENTITY")){let t=this.findDeclarationEnd(this.pointer);if(-1===t)throw new Error("Malformed entity declaration");let e=this.source.substring(this.pointer,t+1),n=this.parseEntityDeclaration(e);const i=n.isParameterEntity()?`%${n.getName()}`:n.getName(),r=this.grammar.getEntitiesMap().has(i),s=this.preexistingEntityKeys.has(i);if(r&&this.overrideExistingDeclarations&&!s){this.pointer+=e.length;continue}this.grammar.addEntity(n,this.overrideExistingDeclarations&&s),this.pointer+=e.length;continue}if(this.lookingAt("<!NOTATION")){let t=this.findDeclarationEnd(this.pointer);if(-1===t)throw new Error("Malformed notation declaration");let e=this.source.substring(this.pointer,t+1);a.XMLUtils.hasParameterEntity(e)&&(e=this.resolveEntities(e));let n=this.parseNotationDeclaration(e);this.grammar.addNotation(n,this.overrideExistingDeclarations),this.pointer+=e.length;continue}if(this.lookingAt("<![")){this.parseConditionalSection();continue}if(this.lookingAt("]]>")){this.endConditionalSection();continue}if(this.lookingAt("<?")){let t=this.source.indexOf("?>",this.pointer);if(-1===t)throw new Error("Malformed processing instruction");this.pointer=t+2;continue}if(this.lookingAt("\x3c!--")){let t=this.source.indexOf("--\x3e",this.pointer);if(-1===t)throw new Error("Malformed comment");this.pointer=t+3;continue}if(this.lookingAt("%")){let t=this.source.indexOf(";",this.pointer);if(-1==t)throw new Error("Malformed entity reference");let e=this.source.substring(this.pointer+1,t),n=this.grammar.getParameterEntity(e);if(!n&&this.catalog){let t=this.catalog.matchPublic(e);if(t)try{let i=this.readFileContent(t),r=new h.EntityDecl(e,!0,i,"","","");this.grammar.addEntity(r,this.overrideExistingDeclarations),n=r,this.extractAndImportEntities(t)}catch(e){console.warn(`Warning: Could not extract entities from ${t}: ${e.message}`)}else console.warn("entity not found in catalog: "+e)}if(void 0===n)throw new Error("Unknown entity: "+e+" in parsing loop");let i=n.getValue();if(""!==i){let e=this.source.substring(0,this.pointer),n=this.source.substring(t+1);this.source=e+i+n}else if(""!==n.getSystemId()||""!==n.getPublicId()){let e=this.resolveEntity(n.getPublicId(),n.getSystemId()),i=new d(this.grammar);i.setXmlVersion(this.xmlVersion),i.setValidating(this.validating),this.catalog&&i.setCatalog(this.catalog);let r=i.parseFile(e);this.grammar.merge(r),this.pointer=t+1}else this.pointer=t+1;continue}let t=this.source.charAt(this.pointer);if(!a.XMLUtils.isXmlSpace(t))throw new Error("Error parsing "+this.currentFile+" at "+this.source.substring(this.pointer-10,this.pointer)+" @ "+this.source.substring(this.pointer,this.pointer+30));this.pointer++}return this.grammar}importAllEntities(t,e){t.getEntitiesMap().forEach((t,n)=>{e.getEntity(n)||e.addEntity(t)}),t.getElementDeclMap().forEach((t,n)=>{e.getElementDeclMap().has(n)||e.addElement(t)}),t.getAttributesMap().forEach((t,n)=>{let i=e.getAttributesMap().get(n);i&&0!==i.size||e.addAttributes(n,t)}),t.getNotationsMap().forEach((t,n)=>{e.getNotationsMap().has(n)||e.addNotation(t)})}extractAndImportEntities(t){try{let e=this.readFileContent(t),n=this.currentFile,i=this.source,r=this.pointer;this.currentFile=t,this.source=e,this.pointer=0;try{this.parse()}finally{this.currentFile=n,this.source=i,this.pointer=r}}catch(e){if(this.validating)throw e;console.warn(`Warning: Could not parse external DTD file ${t}: ${e.message}`)}}readFileContent(t){let e=(0,i.statSync)(t,{bigint:!1,throwIfNoEntry:!0}).blksize,n=(0,i.openSync)(t,"r"),r=Buffer.alloc(e),s="",a=(0,i.readSync)(n,r,0,e,0);for(;a>0;)s+=r.toString("utf8",0,a),a=(0,i.readSync)(n,r,0,e,s.length);return(0,i.closeSync)(n),s}endConditionalSection(){if(0===this.openConditionalSections)throw new Error("Malformed conditional section: unexpected closing ']]>' without matching '<!['");this.openConditionalSections--,this.pointer+=3}parseConditionalSection(){for(this.pointer+=3;this.pointer<this.source.length;this.pointer++){let t=this.source.charAt(this.pointer);if(!a.XMLUtils.isXmlSpace(t))break}let t="";for(;this.pointer<this.source.length;this.pointer++){let e=this.source.charAt(this.pointer);if(a.XMLUtils.isXmlSpace(e)||"["===e)break;t+=e}if(a.XMLUtils.hasParameterEntity(t)){let e=this.resolveEntities(t);const n=e.indexOf("[");if(-1!==n){const t=e.substring(n+1);if(e=e.substring(0,n),"["!==this.source.charAt(this.pointer))this.source=this.source.substring(0,this.pointer)+"["+t+this.source.substring(this.pointer);else if(t.length>0){const e=this.pointer+1;this.source=this.source.substring(0,e)+t+this.source.substring(e)}}t=e.trim()}if("INCLUDE"===t){for(;this.pointer<this.source.length&&"["!==this.source.charAt(this.pointer);this.pointer++);this.pointer++,this.openConditionalSections++}else{if("IGNORE"!==t)throw new Error("Malformed conditional section");this.skipIgnoreSection()}}skipIgnoreSection(){let t=1;for(;this.pointer<this.source.length;)if(this.lookingAt("<!["))t++,this.pointer+=3;else if(this.lookingAt("]]>")){if(t--,this.pointer+=3,0===t)return}else this.pointer++;throw new Error("Malformed conditional section: conditional IGNORE section not closed with ']]>'")}resolveEntities(t,e=0){if(e>50)throw new Error("Parameter entity resolution depth exceeded (possible recursion in parameter entities)");let n="",i=!1,r="",s=0;for(;s<t.length;){const a=t.charAt(s);if("%"===a){if(i&&0===e){n+=a,s++;continue}const r=t.indexOf(";",s+1);if(-1===r)throw new Error('Malformed parameter entity reference while resolving "'+t+'"');const o=t.substring(s+1,r).trim();if(0===o.length){n+=t.substring(s,r+1),s=r+1;continue}const l=this.grammar.getParameterEntity(o);if(void 0===l){const e=t.substring(s,Math.min(t.length,s+80));throw new Error("Unknown entity: "+o+' in resolveEntities while processing "'+e+'"')}if(l.isExternal()&&!l.isExternalContentLoaded()){const t=this.loadExternalEntity(l.getPublicId(),l.getSystemId(),!0,l.getName(),l.isParameterEntity());l.setValue(t)}let c=l.getValue();if(""!==c){c=this.resolveEntities(c,e+1);const i=n.length>0?n.charAt(n.length-1):"",a=r+1<t.length?t.charAt(r+1):"",o=s>0?t.charAt(s-1):"",l=a;this.needsSeparatorBefore(i,c,o)&&(c=" "+c),this.needsSeparatorAfter(a,c,l)&&(c+=" "),n+=c}s=r+1;continue}i?(n+=a,s++,a===r&&(i=!1,r="")):'"'!==a&&"'"!==a?(n+=a,s++):(i=!0,r=a,n+=a,s++)}return n}parseEntityDeclaration(t){this.requireWhitespaceAfterKeyword(t,"<!ENTITY","ENTITY declaration");let e="",n=8,i=t.charAt(n);for(;n<t.length&&(i=t.charAt(n),a.XMLUtils.isXmlSpace(i));n++);let r=!1;if("%"===i)for(r=!0,n++;n<t.length&&(i=t.charAt(n),a.XMLUtils.isXmlSpace(i));n++);for(;n<t.length&&(i=t.charAt(n),!a.XMLUtils.isXmlSpace(i));n++)e+=i;if(!a.XMLUtils.isValidXMLName(e))throw new Error(`Invalid entity name in DTD: "${e}" - XML names must be valid`);for(a.XMLUtils.hasParameterEntity(e)&&(e=this.resolveEntities(e));n<t.length&&(i=t.charAt(n),a.XMLUtils.isXmlSpace(i));n++);if(r){if(a.XMLUtils.lookingAt("PUBLIC",t,n)){for(n+=6;n<t.length&&(i=t.charAt(n),a.XMLUtils.isXmlSpace(i));n++);let s=t.charAt(n);n++;let o="";for(;n<t.length&&(i=t.charAt(n),i!==s);n++)o+=i;for(n++,a.XMLUtils.hasParameterEntity(o)&&(o=this.resolveEntities(o));n<t.length&&(i=t.charAt(n),a.XMLUtils.isXmlSpace(i));n++);s=t.charAt(n),n++;let l="";for(;n<t.length&&(i=t.charAt(n),i!==s);n++)l+=i;return a.XMLUtils.hasParameterEntity(l)&&(l=this.resolveEntities(l)),this.attachUnresolvedError(e,new h.EntityDecl(e,r,"",l,o,""))}if(a.XMLUtils.lookingAt("SYSTEM",t,n)){for(n+=6;n<t.length&&(i=t.charAt(n),a.XMLUtils.isXmlSpace(i));n++);let s=t.charAt(n);n++;let o="";for(;n<t.length&&(i=t.charAt(n),i!==s);n++)o+=i;return a.XMLUtils.hasParameterEntity(o)&&(o=this.resolveEntities(o)),this.attachUnresolvedError(e,new h.EntityDecl(e,r,"",o,"",""))}{let s=t.charAt(n);n++;let a="";for(;n<t.length&&(i=t.charAt(n),i!==s);n++)a+=i;const o=this.currentFile||this.baseDirectory||"DTD";if(this.ensureParameterReferenceSyntax(a,"parameter entity",`%${e}`,o),this.parsingInternalSubset&&this.containsParameterEntityReference(a))throw new Error(`Invalid parameter entity "%${e}"${o?` in ${o}`:""}: parameter entity references are not allowed in replacement text within the internal subset`);return a=this.normalizeEntityLiteral(a),this.validateParameterEntityValue(a,e,o),this.validateParsedEntityValue(a,e,o,!0),this.attachUnresolvedError(e,new h.EntityDecl(e,r,a,"","",""))}}if(a.XMLUtils.lookingAt("PUBLIC",t,n)){for(n+=6;n<t.length&&(i=t.charAt(n),a.XMLUtils.isXmlSpace(i));n++);let s=t.charAt(n);n++;let o="";for(;n<t.length&&(i=t.charAt(n),i!==s);n++)o+=i;for(n++,a.XMLUtils.hasParameterEntity(o)&&(o=this.resolveEntities(o));n<t.length&&(i=t.charAt(n),a.XMLUtils.isXmlSpace(i));n++);s=t.charAt(n),n++;let l="";for(;n<t.length&&(i=t.charAt(n),i!==s);n++)l+=i;for(n++,a.XMLUtils.hasParameterEntity(l)&&(l=this.resolveEntities(l));n<t.length&&(i=t.charAt(n),a.XMLUtils.isXmlSpace(i));n++);if(a.XMLUtils.lookingAt("NDATA",t,n)){for(n+=5;n<t.length&&(i=t.charAt(n),a.XMLUtils.isXmlSpace(i));n++);let s="";for(;n<t.length&&(i=t.charAt(n),!a.XMLUtils.isXmlSpace(i));n++)s+=i;return a.XMLUtils.hasParameterEntity(s)&&(s=this.resolveEntities(s)),this.attachUnresolvedError(e,new h.EntityDecl(e,r,"",l,o,s))}const c=this.loadExternalEntity(o,l,!1,e,r);return this.attachUnresolvedError(e,new h.EntityDecl(e,r,c,l,o,""))}if(a.XMLUtils.lookingAt("SYSTEM",t,n)){for(n+=6;n<t.length&&(i=t.charAt(n),a.XMLUtils.isXmlSpace(i));n++);let s=t.charAt(n);n++;let o="";for(;n<t.length&&(i=t.charAt(n),i!==s);n++)o+=i;for(a.XMLUtils.hasParameterEntity(o)&&(o=this.resolveEntities(o));n<t.length&&(i=t.charAt(n),a.XMLUtils.isXmlSpace(i));n++);if(a.XMLUtils.lookingAt("NDATA",t,n)){for(n+=5;n<t.length&&(i=t.charAt(n),a.XMLUtils.isXmlSpace(i));n++);let s="";for(;n<t.length&&(i=t.charAt(n),!a.XMLUtils.isXmlSpace(i));n++)s+=i;return a.XMLUtils.hasParameterEntity(s)&&(s=this.resolveEntities(s)),this.attachUnresolvedError(e,new h.EntityDecl(e,r,"",o,"",s))}const l=this.loadExternalEntity("",o,!1,e,r);return this.attachUnresolvedError(e,new h.EntityDecl(e,r,l,o,"",""))}{let s=t.charAt(n);n++;let o="";for(;n<t.length&&(i=t.charAt(n),i!==s);n++)o+=i;const l=this.currentFile||this.baseDirectory||"DTD";if(this.ensureParameterReferenceSyntax(o,"general entity",e,l),a.XMLUtils.hasParameterEntity(o)){if(this.parsingInternalSubset){const t=this.currentFile||this.baseDirectory||"DTD";throw new Error(`Invalid general entity "${e}"${t?` in ${t}`:""}: parameter entity references are not allowed in replacement text within the internal subset`)}o=this.resolveEntities(o)}return o=this.normalizeEntityLiteral(o),this.validateParsedEntityValue(o,e,l,!1),this.attachUnresolvedError(e,new h.EntityDecl(e,r,o,"","",""))}}attachUnresolvedError(t,e){const n=this.unresolvedExternalEntities.get(t);return n&&(e.markUnresolved(n),this.unresolvedExternalEntities.delete(t)),e}normalizeEntityLiteral(t){let e=t.replaceAll("\r\n","\n");return e=e.replaceAll("\r","\n"),e}validateParameterEntityValue(t,e,n){if(!this.validating)return;if(0===t.length)return;const i=n?` in ${n}`:"";let r=!1,s=!1,a=0,o=0;for(;o<t.length;){const n=t.charAt(o);if(s||"'"!==n)if(r||'"'!==n)if(r||s)o++;else if("("!==n)if(")"!==n){if(t.startsWith("\x3c!--",o)){const n=t.indexOf("--\x3e",o+4);if(-1===n)throw new Error(`Invalid parameter entity "%${e}"${i}: comment opened but not closed`);o=n+3;continue}if(t.startsWith("<![",o)){const n=t.indexOf("]]>",o+3);if(-1===n)throw new Error(`Invalid parameter entity "%${e}"${i}: conditional section opened but not closed`);o=n+3;continue}if(t.startsWith("<!",o)){const n=t.indexOf(">",o+2);if(-1===n)throw new Error(`Invalid parameter entity "%${e}"${i}: markup declaration started but not closed`);o=n+1;continue}o++}else{if(0===a)throw new Error(`Invalid parameter entity "%${e}"${i}: unmatched ')' in replacement text`);a--,o++}else a++,o++;else s=!s,o++;else r=!r,o++}if(r||s)throw new Error(`Invalid parameter entity "%${e}"${i}: quote mismatch in replacement text`);if(0!==a)throw new Error(`Invalid parameter entity "%${e}"${i}: parentheses are not balanced`)}ensureParameterReferenceSyntax(t,e,n,i){if(!this.validating||0===t.length)return;const r=i?` in ${i}`:"";let s=0;for(;s<t.length;){if("%"!==t.charAt(s)){s++;continue}const i=this.readParameterEntityReference(t,s);if(null===i)throw new Error(`Invalid ${e} "${n}"${r}: malformed parameter entity reference in replacement text`);s=i+1}}validateParsedEntityValue(t,e,n,i){if(!this.validating||0===t.length)return;const r=n?` in ${n}`:"",s=i?`%${e}`:e,o=i?"parameter entity":"general entity";i||this.ensureGeneralEntityDelimitersBalanced(t,s,r),a.XMLUtils.ensureValidXmlCharacters(this.xmlVersion,t,`${o} "${s}" replacement text${r}`);let l=0;for(;l<t.length;){if("&"!==t.charAt(l)){l++;continue}if(l+1>=t.length)throw new Error(`Invalid ${o} "${s}"${r}: unterminated entity reference in replacement text`);const e=t.charAt(l+1);if("#"===e){let e=l+2;if(e>=t.length)throw new Error(`Invalid ${o} "${s}"${r}: malformed character reference in replacement text`);const n=t.charAt(e);let i;"x"===n||"X"===n?(e++,i=/^[0-9a-fA-F]$/):i=/^[0-9]$/;let a=0;for(;e<t.length;){const n=t.charAt(e);if(";"===n)break;if(!i.test(n))throw new Error(`Invalid ${o} "${s}"${r}: malformed character reference in replacement text`);a++,e++}if(0===a||e>=t.length||";"!==t.charAt(e))throw new Error(`Invalid ${o} "${s}"${r}: unterminated character reference in replacement text`);l=e+1;continue}if(!a.XMLUtils.isNameStartChar(e))throw new Error(`Invalid ${o} "${s}"${r}: unescaped '&' in replacement text`);let n=l+2;for(;n<t.length&&a.XMLUtils.isNameChar(t.charAt(n));)n++;if(n>=t.length||";"!==t.charAt(n))throw new Error(`Invalid ${o} "${s}"${r}: unterminated entity reference in replacement text`);l=n+1}}ensureGeneralEntityDelimitersBalanced(t,e,n){const i=this.decodeCharacterReferencesForValidation(t);let r=0,s=!1,a=!1;for(;r<i.length;){const t=i.charAt(r);if(a||"'"!==t)if(s||'"'!==t)if(s||a)r++;else{if(i.startsWith("<![CDATA[",r)){const t=i.indexOf("]]>",r+9);if(-1===t)throw new Error(`Invalid general entity "${e}"${n}: CDATA section start delimiter appears without matching end`);r=t+3;continue}if(i.startsWith("\x3c!--",r)){const t=i.indexOf("--\x3e",r+4);if(-1===t)throw new Error(`Invalid general entity "${e}"${n}: comment opened but not closed in replacement text`);r=t+3;continue}if(i.startsWith("<?",r)){const t=i.indexOf("?>",r+2);if(-1===t)throw new Error(`Invalid general entity "${e}"${n}: processing instruction opened but not closed in replacement text`);r=t+2;continue}r++}else a=!a,r++;else s=!s,r++}}decodeCharacterReferencesForValidation(t){let e="",n=0;for(;n<t.length;){const i=t.charAt(n);if("&"===i){if(t.startsWith("&#x",n)||t.startsWith("&#X",n)){const i=t.indexOf(";",n+3);if(-1===i){e+="&",n++;continue}const r=t.substring(n+3,i),s=Number.parseInt(r,16);Number.isNaN(s)||(e+=String.fromCodePoint(s)),n=i+1;continue}if(t.startsWith("&#",n)){const i=t.indexOf(";",n+2);if(-1===i){e+="&",n++;continue}const r=t.substring(n+2,i),s=Number.parseInt(r,10);Number.isNaN(s)||(e+=String.fromCodePoint(s)),n=i+1;continue}t.startsWith("&lt;",n)?(e+="<",n+=4):t.startsWith("&gt;",n)?(e+=">",n+=4):t.startsWith("&amp;",n)?(e+="&",n+=5):t.startsWith("&apos;",n)?(e+="'",n+=6):t.startsWith("&quot;",n)?(e+='"',n+=6):(e+=i,n++)}else e+=i,n++}return e}parseNotationDeclaration(t){if(this.requireWhitespaceAfterKeyword(t,"<!NOTATION","NOTATION declaration"),this.parsingInternalSubset&&this.hasParameterEntityReferenceOutsideLiterals(t)){const t=this.currentFile||this.baseDirectory||"DTD";throw new Error(`Invalid NOTATION declaration${t?` in ${t}`:""}: parameter entity references are not allowed inside markup declarations in the internal subset`)}let e="",n=10,i=t.charAt(n);for(;n<t.length&&(i=t.charAt(n),a.XMLUtils.isXmlSpace(i));n++);for(;n<t.length&&(i=t.charAt(n),!a.XMLUtils.isXmlSpace(i));n++)e+=i;if(!a.XMLUtils.isValidXMLName(e))throw new Error(`Invalid notation name in DTD: "${e}" - XML names must be valid`);for(;n<t.length&&(i=t.charAt(n),a.XMLUtils.isXmlSpace(i));n++);let r="",s="";if(a.XMLUtils.lookingAt("PUBLIC",t,n)){for(n+=6;n<t.length&&(i=t.charAt(n),a.XMLUtils.isXmlSpace(i));n++);let e=t.charAt(n);for(n++;n<t.length&&(i=t.charAt(n),i!==e);n++)r+=i;for(n++,a.XMLUtils.hasParameterEntity(r)&&(r=this.resolveEntities(r));n<t.length&&(i=t.charAt(n),a.XMLUtils.isXmlSpace(i));n++);for(e=t.charAt(n),n++;n<t.length&&(i=t.charAt(n),i!==e);n++)s+=i}else{if(!a.XMLUtils.lookingAt("SYSTEM",t,n))throw new Error("Malformed notation declaration");{for(n+=6;n<t.length&&(i=t.charAt(n),a.XMLUtils.isXmlSpace(i));n++);let e=t.charAt(n);for(n++;n<t.length&&(i=t.charAt(n),i!==e);n++)s+=i}}return new u.NotationDecl(e,r,s)}parseAttributesListDeclaration(t){if(this.requireWhitespaceAfterKeyword(t,"<!ATTLIST","ATTLIST declaration"),this.parsingInternalSubset&&this.hasParameterEntityReferenceOutsideLiterals(t)){const t=this.currentFile||this.baseDirectory||"DTD";throw new Error(`Invalid ATTLIST declaration${t?` in ${t}`:""}: parameter entity references are not allowed inside markup declarations in the internal subset`)}let e=9,n=(t=this.resolveEntities(t)).charAt(e);for(;e<t.length&&(n=t.charAt(e),a.XMLUtils.isXmlSpace(n));e++);let i="";for(;e<t.length&&(n=t.charAt(e),!a.XMLUtils.isXmlSpace(n));e++)i+=n;for(;e<t.length&&(n=t.charAt(e),a.XMLUtils.isXmlSpace(n));e++);let r="";for(;e<t.length&&(n=t.charAt(e),">"!==n);e++)r+=n;if(!a.XMLUtils.isValidXMLName(i))throw new Error(`Invalid element name in ATTLIST declaration: "${i}"`);r=this.expandParameterEntities(r);let s=new o.AttListDecl(i,r);return this.validateAttributeDefaultEntities(s),s}parseElementDeclaration(t){if(this.requireWhitespaceAfterKeyword(t,"<!ELEMENT","ELEMENT declaration"),this.parsingInternalSubset&&this.hasParameterEntityReferenceOutsideLiterals(t)){const t=this.currentFile||this.baseDirectory||"DTD";throw new Error(`Invalid ELEMENT declaration${t?` in ${t}`:""}: parameter entity references are not allowed inside markup declarations in the internal subset`)}let e="",n=9,i=(t=this.resolveEntities(t)).charAt(n);for(;n<t.length&&(i=t.charAt(n),a.XMLUtils.isXmlSpace(i));n++);for(;n<t.length&&(i=t.charAt(n),!a.XMLUtils.isXmlSpace(i));n++)e+=i;if(!a.XMLUtils.isValidXMLName(e))throw new Error(`Invalid element name in DTD: "${e}" - XML names must be valid`);for(;n<t.length&&(i=t.charAt(n),a.XMLUtils.isXmlSpace(i));n++);let r="";for(;n<t.length&&(i=t.charAt(n),">"!==i);n++)r+=i;return new c.ElementDecl(e,r)}lookingAt(t){let e=t.length;if(this.pointer+e>this.source.length)return!1;for(let n=0;n<e;n++)if(this.source[this.pointer+n]!==t[n])return!1;return!0}findDeclarationEnd(t){let e=t,n=!1,i="";for(;e<this.source.length&&!a.XMLUtils.isXmlSpace(this.source.charAt(e))&&">"!==this.source.charAt(e);)e++;for(;e<this.source.length;){let t=this.source.charAt(e);if(n||'"'!==t&&"'"!==t){if(n&&t===i)n=!1,i="";else if(!n&&">"===t)return e}else n=!0,i=t;e++}return-1}resolveEntity(t,e){let n=this.catalog?.resolveEntity(t,e);if(n||""===e||e.startsWith("http")||(n=this.makeAbsolute(e)),n)return n;if(e.startsWith("http"))return e;throw new Error('Entity not found: "'+t+'" "'+e+'"')}makeAbsolute(t){return(this.baseDirectory||(0,r.dirname)(this.currentFile))+r.sep+t}loadExternalEntity(t,e,n=!1,i="",r=!1){let a;try{let n=this.resolveEntity(t,e);a=new s.FileReader(n);let o="";for(;a.dataAvailable();)o+=a.read();this.validateTextContent(o,n),o=o.replaceAll("\r\n","\n").replaceAll("\r","\n"),o=this.removeTextDeclaration(o);const l=i||e||t||"[external entity]";return r&&this.validateParameterEntityValue(o,l,n),this.validateParsedEntityValue(o,l,n,r),i&&this.unresolvedExternalEntities.delete(i),o}catch(r){const s=t||e,a=s.startsWith("http://")||s.startsWith("https://"),o=`Could not load external entity "${s}": ${r.message}`;if(n||this.validating&&!a)throw new Error(o);return i&&this.unresolvedExternalEntities.set(i,o),""}finally{if(a)try{a.closeFile()}catch(t){console.error(`Error closing file reader: ${t.message}`)}}}validateTextContent(t,e){if(t.includes("\0"))throw new Error(`External entity "${e}" contains binary data (null bytes) and cannot be used as XML text`);let n=t;65279===n.codePointAt(0)&&(n=n.substring(1));const i=n.search(/\S/);if(-1!==i&&n.startsWith("<?xml",i)){const t=n.indexOf("?>",i);if(-1===t)throw new Error(`External entity "${e}" has an unterminated text declaration`);const r=n.substring(i,t+2);if(!/encoding\s*=\s*(['"]).+?\1/i.test(r))throw new Error(`External entity "${e}" text declaration must include an encoding pseudo-attribute`);if(n.substring(t+2).match(/<\?xml\s+/i))throw new Error(`External entity "${e}" contains multiple XML declarations`)}else if(n.match(/<\?xml\s+/i))throw new Error(`External entity "${e}" contains XML declaration in invalid position`);let r=0;const s=Math.min(n.length,1e3);for(let t=0;t<s;t++){const e=n.codePointAt(t)??-1;(e<9||e>13&&e<32||127===e)&&r++}if(s>0&&r/s>.2)throw new Error(`External entity "${e}" appears to contain binary data and cannot be used as XML text`)}removeTextDeclaration(t){let e=0;for(;e<t.length&&a.XMLUtils.isXmlSpace(t.charAt(e));)e++;if(e>=t.length)return t;if(!t.startsWith("<?xml",e))return t;const n=t.charAt(e+5);if(!a.XMLUtils.isXmlSpace(n))return t;let i=e+5,r=null;for(;i<t.length;){const n=t.charAt(i);if(r)n===r&&(r=null),i++;else if('"'!==n&&"'"!==n){if(i+1<t.length&&"?"===t.charAt(i)&&">"===t.charAt(i+1))return t.substring(0,e)+t.substring(i+2);i++}else r=n,i++}return t}expandParameterEntities(t){let e=t,n=0;for(;n<50;){const t=this.findParameterEntityReferences(e);if(0===t.length)break;let i=!1;for(const n of t){const t=this.grammar.getParameterEntity(n.name);if(!t)continue;const r=t.getValue();let s=0;for(;;){const t=e.indexOf(n.reference,s);if(-1===t)break;const a=t>0?e.charAt(t-1):"",o=t+n.reference.length,l=o<e.length?e.charAt(o):"",c=a,h=l;let u=r;this.needsSeparatorBefore(a,u,c)&&(u=" "+u),this.needsSeparatorAfter(l,u,h)&&(u+=" "),e=e.substring(0,t)+u+e.substring(o),s=t+u.length,i=!0}}if(!i)break;n++}return n>=50&&console.warn("Parameter entity expansion reached maximum iterations (50), some entities may not be fully expanded"),e}containsParameterEntityReference(t){for(let e=0;e<t.length;e++)if("%"===t.charAt(e)&&null!==this.readParameterEntityReference(t,e))return!0;return!1}validateAttributeDefaultEntities(t){const e=this.currentFile||this.baseDirectory||"DTD",n=e?` in ${e}`:"";t.getAttributes().forEach((t,e)=>{const i=t.getDefaultValue();if(!i)return;let r=0;for(;r<i.length;){const t=i.indexOf("&",r);if(-1===t)break;const s=i.indexOf(";",t+1);if(-1===s)throw new Error(`Invalid ATTLIST declaration${n}: unterminated entity reference in default value of attribute "${e}"`);const a=i.substring(t+1,s);if(0===a.length)throw new Error(`Invalid ATTLIST declaration${n}: empty entity reference in default value of attribute "${e}"`);if(a.startsWith("#"))r=s+1;else if(this.isPredefinedGeneralEntity(a))r=s+1;else{if(!this.grammar.getEntity(a))throw new Error(`Invalid ATTLIST declaration${n}: entity "${a}" must be declared before it is referenced in default value of attribute "${e}"`);r=s+1}}})}isPredefinedGeneralEntity(t){switch(t){case"lt":case"gt":case"amp":case"apos":case"quot":return!0;default:return!1}}requireWhitespaceAfterKeyword(t,e,n){if(t.length<=e.length)return;const i=t.charAt(e.length);if(("%"!==i||null===this.readParameterEntityReference(t,e.length))&&!a.XMLUtils.isXmlSpace(i)){const t=this.currentFile||this.baseDirectory||"DTD";throw new Error(`Invalid ${n}${t?` in ${t}`:""}: whitespace is required after the keyword`)}}hasParameterEntityReferenceOutsideLiterals(t){let e=!1,n=!1,i=0;for(;i<t.length;){const r=t.charAt(i);if(n||"'"!==r)if(e||'"'!==r)if(e||n)i++;else{if("<"===r&&t.startsWith("\x3c!--",i)){const e=t.indexOf("--\x3e",i+4);if(-1===e)return!1;i=e+3;continue}if("%"===r&&null!==this.readParameterEntityReference(t,i))return!0;i++}else n=!n,i++;else e=!e,i++}return!1}readParameterEntityReference(t,e){const n=e+1;if(n>=t.length)return null;const i=t.charAt(n);if(!a.XMLUtils.isNameStartChar(i))return null;let r=n+1;for(;r<t.length&&a.XMLUtils.isNameChar(t.charAt(r));)r++;return r<t.length&&";"===t.charAt(r)?r:null}needsSeparatorBefore(t,e,n=""){if(0===e.length)return!1;if(""===t)return!1;if("%"===t)return!1;if(";"===n||"%"===n)return!1;if(a.XMLUtils.isXmlSpace(t))return!1;if(this.isMarkupDelimiter(t))return!1;const i=e.charAt(0);return!("%"===i||a.XMLUtils.isXmlSpace(i)||'"'!==i&&"'"!==i&&this.isMarkupDelimiter(i))}needsSeparatorAfter(t,e,n=""){if(0===e.length)return!1;if(""===t)return!1;if("%"===t)return!1;if("%"===n||";"===n)return!1;if(a.XMLUtils.isXmlSpace(t))return!1;if(this.isMarkupDelimiter(t))return!1;const i=e.charAt(e.length-1);return"%"!==i&&!a.XMLUtils.isXmlSpace(i)&&!this.isMarkupDelimiter(i)}isMarkupDelimiter(t){return""!==t&&["<",">","[","]","(",")",'"',"'","|","?","*","+","=",",",";",":","/"].includes(t)}findParameterEntityReferences(t){const e=[];let n=!1,i="",r=0;for(;r<t.length;){const s=t.charAt(r);if(n)s===i&&(n=!1,i=""),r++;else if('"'!==s&&"'"!==s){if("%"===s){let n=t.indexOf(";",r+1);if(-1===n)break;const i=t.substring(r+1,n).trim();i.length>0&&a.XMLUtils.isValidXMLName(i)&&e.push({reference:`%${i};`,name:i}),r=n+1;continue}r++}else n=!0,i=s,r++}return e}getGrammar(){return this.grammar}}e.DTDParser=d},2826(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DTDSequenceModel=void 0;const i=n(2823),r=n(4485);e.DTDSequenceModel=class{cardinality="";children=[];constructor(t){t&&(this.children=t)}getType(){return"sequence"}addChild(t){this.children.push(t)}getChildren(){return this.children}validate(){if(this.cardinality&&!["*","+","?"].includes(this.cardinality))return!1;if(0===this.children.length)return!1;for(const t of this.children){if(!t.validate())return!1;if(t instanceof r.DTDElementNameParticle&&!i.XMLUtils.isValidXMLName(t.getName()))return!1}return!0}toBNF(){return this.children.map(t=>t.toBNF()).join(", ")+(this.cardinality?this.cardinality:"")}}},4786(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ElementDecl=void 0;const i=n(2176),r=n(9603);class s{name;contentSpec;constructor(t,e){this.name=t,this.contentSpec=e,this.validateContentSpec()}validateContentSpec(){if(["EMPTY","ANY"].includes(this.contentSpec))return;let t=this.contentSpec.replaceAll(/\r?\n/g," ");if(t=t.replaceAll(/\s+/g,"").trim(),!new r.DTDContentModelParser(t).parse().validate())throw new Error("Invalid content specification: "+t)}getName(){return this.name}getContentSpec(){return this.contentSpec}getNodeType(){return i.Constants.ELEMENT_DECL_NODE}toString(){return"<!ELEMENT "+this.name+" "+this.contentSpec+">"}equals(t){return t instanceof s&&this.name===t.name&&this.contentSpec===t.contentSpec}}e.ElementDecl=s},2243(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.EntityDecl=void 0;const i=n(2176);class r{name;parameterEntity;value;systemId;publicId;ndata;externalContentLoaded=!1;unresolvedExternalError=null;constructor(t,e,n,i,r,s){this.name=t,this.parameterEntity=e,this.value=n,this.systemId=i,this.publicId=r,this.ndata=s}getName(){return this.name}getValue(){return this.value}setValue(t){this.value=t,(this.systemId||this.publicId)&&(this.externalContentLoaded=!0),this.unresolvedExternalError=null}isExternalContentLoaded(){return this.externalContentLoaded}markUnresolved(t){this.unresolvedExternalError=t}getUnresolvedError(){return this.unresolvedExternalError}isParameterEntity(){return this.parameterEntity}getSystemId(){return this.systemId}getPublicId(){return this.publicId}getNotationName(){return this.ndata}isExternal(){return""!==this.systemId||""!==this.publicId}getNodeType(){return i.Constants.ENTITY_DECL_NODE}toString(){let t="<!ENTITY "+(this.parameterEntity?"% ":"")+this.name;return""!==this.publicId&&""!==this.systemId?t+=' PUBLIC "'+this.publicId+'" "'+this.systemId+'">':""!==this.systemId?t+=' SYSTEM "'+this.systemId+'">':t+=' "'+this.value+'">',t}equals(t){return t instanceof r&&this.name===t.name&&this.parameterEntity===t.parameterEntity&&this.value===t.value&&this.systemId===t.systemId&&this.publicId===t.publicId&&this.ndata===t.ndata}}e.EntityDecl=r},5390(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NotationDecl=void 0;const i=n(2176);class r{name;publicId;systemId;constructor(t,e,n){this.name=t,this.publicId=e,this.systemId=n}getName(){return this.name}getPublicId(){return this.publicId}getSystemId(){return this.systemId}getNodeType(){return i.Constants.NOTATION_DECL_NODE}toString(){let t="<!NOTATION "+this.name;return this.publicId&&this.publicId.length>0&&(t+=' PUBLIC "'+this.publicId+'"'),this.systemId&&this.systemId.length>0&&(this.publicId&&this.publicId.length>0?t+=' "'+this.systemId+'"':t+=' SYSTEM "'+this.systemId+'"'),t+=">",t}equals(t){return t instanceof r&&this.name===t.name&&this.publicId===t.publicId&&this.systemId===t.systemId}}e.NotationDecl=r},5829(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ContentParticleType=void 0,e.ContentParticleType={PCDATA:0,NAME:1,SEQUENCE:2,CHOICE:3}},6645(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DTDChoice=void 0;const i=n(5614),r=n(5829),s=n(9541),a=n(2097);class o{cardinality;content;constructor(){this.content=new Array,this.cardinality=i.Cardinality.NONE}addParticle(t){this.content.push(t)}getType(){return r.ContentParticleType.CHOICE}getCardinality(){return this.cardinality}setCardinality(t){this.cardinality=t}toString(){let t="(";for(let e=0;e<this.content.length;e++)t+=this.content[e].toString(),e<this.content.length-1&&(t+="|");switch(t+=")",this.cardinality){case i.Cardinality.NONE:return t;case i.Cardinality.OPTIONAL:return t+"?";case i.Cardinality.ONEMANY:return t+"+";case i.Cardinality.ZEROMANY:return t+"*"}return t}getParticles(){return this.content}getChildren(){const t=new Set;for(const e of this.content){if(e instanceof s.DTDName&&t.add(e.getName()),e instanceof o){let n=e;for(const e of n.getChildren())t.add(e)}if(e instanceof a.DTDSecuence){let n=e;for(const e of n.getChildren())t.add(e)}}return t}}e.DTDChoice=o},9541(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DTDName=void 0;const i=n(5614),r=n(5829);e.DTDName=class{name;cardinality;constructor(t){this.name=t,this.cardinality=i.Cardinality.NONE}getName(){return this.name}getType(){return r.ContentParticleType.NAME}addParticle(t){}getParticles(){let t=new Array;return t.push(this),t}getChildren(){const t=new Set;return t.add(this.name),t}getCardinality(){return this.cardinality}setCardinality(t){this.cardinality=t}toString(){switch(this.cardinality){case i.Cardinality.NONE:return this.name;case i.Cardinality.OPTIONAL:return this.name+"?";case i.Cardinality.ONEMANY:return this.name+"+";case i.Cardinality.ZEROMANY:return this.name+"*";default:return""}}}},2711(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DTDPCData=void 0;const i=n(5614),r=n(5829);e.DTDPCData=class{getType(){return r.ContentParticleType.PCDATA}addParticle(t){}setCardinality(t){}getCardinality(){return i.Cardinality.NONE}getParticles(){return new Array}getChildren(){return new Set}toString(){return"#PCDATA"}}},2097(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DTDSecuence=void 0;const i=n(5614),r=n(5829),s=n(6645),a=n(9541);class o{cardinality;content;constructor(){this.content=new Array,this.cardinality=i.Cardinality.NONE}addParticle(t){this.content.push(t)}getType(){return r.ContentParticleType.SEQUENCE}setCardinality(t){this.cardinality=t}getCardinality(){return this.cardinality}toString(){let t="(";for(let e=0;e<this.content.length;e++)t+=this.content[e].toString(),e<this.content.length-1&&(t+=",");switch(t+=")",this.cardinality){case i.Cardinality.NONE:return t.toString();case i.Cardinality.OPTIONAL:return t+"?";case i.Cardinality.ONEMANY:return t+"+";case i.Cardinality.ZEROMANY:return t+"*"}return t.toString()}getParticles(){return this.content}getChildren(){const t=new Set;for(const e of this.content){if(e instanceof a.DTDName&&t.add(e.getName()),e instanceof s.DTDChoice){let n=e;for(const e of n.getChildren())t.add(e)}if(e instanceof o){let n=e;for(const e of n.getChildren())t.add(e)}}return t}}e.DTDSecuence=o},9542(t,e){"use strict";var n,i;Object.defineProperty(e,"__esModule",{value:!0}),e.GrammarType=e.ValidationResult=e.ValidationWarning=e.ValidationError=e.ValidationContext=e.AttributeUse=e.AttributeInfo=void 0,e.AttributeInfo=class{name;datatype;use;defaultValue;fixedValue;namespace;constructor(t,e,n,i,r,s){this.name=t,this.datatype=e,this.use=n,this.defaultValue=i,this.fixedValue=r,this.namespace=s}},function(t){t.REQUIRED="required",t.OPTIONAL="optional",t.IMPLIED="implied",t.FIXED="fixed",t.PROHIBITED="prohibited"}(n||(e.AttributeUse=n={})),e.ValidationContext=class{childrenNames;attributes;parent;attributeOnly;constructor(t,e,n,i=!1){this.childrenNames=t,this.attributes=e,this.parent=n,this.attributeOnly=i}};class r{message;location;constructor(t,e){this.message=t,this.location=e}}e.ValidationError=r;class s{message;location;constructor(t,e){this.message=t,this.location=e}}e.ValidationWarning=s;class a{isValid;errors;warnings;constructor(t,e=[],n=[]){this.isValid=t,this.errors=e,this.warnings=n}static success(){return new a(!0)}static error(t,e){return new a(!1,[new r(t,e)])}static warning(t,e){const n=new a(!0);return n.warnings.push(new s(t,e)),n}}e.ValidationResult=a,function(t){t.DTD="dtd",t.XML_SCHEMA="xmlschema",t.RELAX_NG="relaxng",t.NONE="none"}(i||(e.GrammarType=i={}))},9817(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.xmlDocumentToJsonObject=e.xmlStreamToJsonObject=e.xmlFileToJsonObject=e.xmlStringToJsonObject=e.ValidationWarning=e.ValidationResult=e.ValidationError=e.ValidationContext=e.GrammarType=e.AttributeUse=e.AttributeInfo=e.ContentParticleType=e.NotationDecl=e.EntityDecl=e.ElementDecl=e.DTDSecuence=e.DTDSequenceModel=e.DTDPCData=e.DTDName=e.DTDGrammar=e.DTDElementNameParticle=e.DTDContentModelTokenizer=e.DTDContentModelParser=e.DTDChoiceModel=e.DTDChoice=e.DTDParser=e.ContentModelType=e.ContentModel=e.Cardinality=e.AttListDecl=e.AttDecl=e.XMLWriter=e.XMLUtils=e.XMLElement=e.XMLDocumentType=e.XMLDocument=e.XMLDeclaration=e.XMLComment=e.XMLCanonicalizer=e.XMLAttribute=e.TextNode=e.SAXParser=e.RelaxNGParser=e.ProcessingInstruction=e.Indenter=e.FileReader=e.DOMBuilder=e.Constants=e.Catalog=e.CData=void 0,e.jsonStreamToXmlFile=e.jsonFileToXmlFile=e.jsonStringToXmlFile=e.jsonObjectToXmlFile=e.jsonStreamToXmlDocument=e.jsonFileToXmlDocument=e.jsonStringToXmlDocument=e.jsonObjectToXmlDocument=e.xmlDocumentToJsonFile=e.xmlStreamToJsonFile=e.xmlFileToJsonFile=e.xmlStringToJsonFile=void 0;var i=n(112);Object.defineProperty(e,"CData",{enumerable:!0,get:function(){return i.CData}});var r=n(8922);Object.defineProperty(e,"Catalog",{enumerable:!0,get:function(){return r.Catalog}});var s=n(2176);Object.defineProperty(e,"Constants",{enumerable:!0,get:function(){return s.Constants}});var a=n(1882);Object.defineProperty(e,"DOMBuilder",{enumerable:!0,get:function(){return a.DOMBuilder}});var o=n(6964);Object.defineProperty(e,"FileReader",{enumerable:!0,get:function(){return o.FileReader}});var l=n(7060);Object.defineProperty(e,"Indenter",{enumerable:!0,get:function(){return l.Indenter}});var c=n(2192);Object.defineProperty(e,"ProcessingInstruction",{enumerable:!0,get:function(){return c.ProcessingInstruction}});var h=n(8271);Object.defineProperty(e,"RelaxNGParser",{enumerable:!0,get:function(){return h.RelaxNGParser}});var u=n(9350);Object.defineProperty(e,"SAXParser",{enumerable:!0,get:function(){return u.SAXParser}});var d=n(9850);Object.defineProperty(e,"TextNode",{enumerable:!0,get:function(){return d.TextNode}});var f=n(2966);Object.defineProperty(e,"XMLAttribute",{enumerable:!0,get:function(){return f.XMLAttribute}});var m=n(4284);Object.defineProperty(e,"XMLCanonicalizer",{enumerable:!0,get:function(){return m.XMLCanonicalizer}});var p=n(7871);Object.defineProperty(e,"XMLComment",{enumerable:!0,get:function(){return p.XMLComment}});var g=n(9162);Object.defineProperty(e,"XMLDeclaration",{enumerable:!0,get:function(){return g.XMLDeclaration}});var b=n(6245);Object.defineProperty(e,"XMLDocument",{enumerable:!0,get:function(){return b.XMLDocument}});var E=n(3429);Object.defineProperty(e,"XMLDocumentType",{enumerable:!0,get:function(){return E.XMLDocumentType}});var y=n(2714);Object.defineProperty(e,"XMLElement",{enumerable:!0,get:function(){return y.XMLElement}});var v=n(2823);Object.defineProperty(e,"XMLUtils",{enumerable:!0,get:function(){return v.XMLUtils}});var w=n(4823);Object.defineProperty(e,"XMLWriter",{enumerable:!0,get:function(){return w.XMLWriter}});var x=n(9445);Object.defineProperty(e,"AttDecl",{enumerable:!0,get:function(){return x.AttDecl}});var D=n(4241);Object.defineProperty(e,"AttListDecl",{enumerable:!0,get:function(){return D.AttListDecl}});var N=n(5614);Object.defineProperty(e,"Cardinality",{enumerable:!0,get:function(){return N.Cardinality}}),Object.defineProperty(e,"ContentModel",{enumerable:!0,get:function(){return N.ContentModel}}),Object.defineProperty(e,"ContentModelType",{enumerable:!0,get:function(){return N.ContentModelType}});var M=n(449);Object.defineProperty(e,"DTDParser",{enumerable:!0,get:function(){return M.DTDParser}});var T=n(6645);Object.defineProperty(e,"DTDChoice",{enumerable:!0,get:function(){return T.DTDChoice}});var A=n(2684);Object.defineProperty(e,"DTDChoiceModel",{enumerable:!0,get:function(){return A.DTDChoiceModel}});var C=n(9603);Object.defineProperty(e,"DTDContentModelParser",{enumerable:!0,get:function(){return C.DTDContentModelParser}});var S=n(8631);Object.defineProperty(e,"DTDContentModelTokenizer",{enumerable:!0,get:function(){return S.DTDContentModelTokenizer}});var P=n(4485);Object.defineProperty(e,"DTDElementNameParticle",{enumerable:!0,get:function(){return P.DTDElementNameParticle}});var L=n(8717);Object.defineProperty(e,"DTDGrammar",{enumerable:!0,get:function(){return L.DTDGrammar}});var I=n(9541);Object.defineProperty(e,"DTDName",{enumerable:!0,get:function(){return I.DTDName}});var O=n(2711);Object.defineProperty(e,"DTDPCData",{enumerable:!0,get:function(){return O.DTDPCData}});var X=n(2826);Object.defineProperty(e,"DTDSequenceModel",{enumerable:!0,get:function(){return X.DTDSequenceModel}});var k=n(2097);Object.defineProperty(e,"DTDSecuence",{enumerable:!0,get:function(){return k.DTDSecuence}});var V=n(4786);Object.defineProperty(e,"ElementDecl",{enumerable:!0,get:function(){return V.ElementDecl}});var _=n(2243);Object.defineProperty(e,"EntityDecl",{enumerable:!0,get:function(){return _.EntityDecl}});var j=n(5390);Object.defineProperty(e,"NotationDecl",{enumerable:!0,get:function(){return j.NotationDecl}});var U=n(5829);Object.defineProperty(e,"ContentParticleType",{enumerable:!0,get:function(){return U.ContentParticleType}});var R=n(9542);Object.defineProperty(e,"AttributeInfo",{enumerable:!0,get:function(){return R.AttributeInfo}}),Object.defineProperty(e,"AttributeUse",{enumerable:!0,get:function(){return R.AttributeUse}}),Object.defineProperty(e,"GrammarType",{enumerable:!0,get:function(){return R.GrammarType}}),Object.defineProperty(e,"ValidationContext",{enumerable:!0,get:function(){return R.ValidationContext}}),Object.defineProperty(e,"ValidationError",{enumerable:!0,get:function(){return R.ValidationError}}),Object.defineProperty(e,"ValidationResult",{enumerable:!0,get:function(){return R.ValidationResult}}),Object.defineProperty(e,"ValidationWarning",{enumerable:!0,get:function(){return R.ValidationWarning}});var F=n(1276);Object.defineProperty(e,"xmlStringToJsonObject",{enumerable:!0,get:function(){return F.xmlStringToJsonObject}}),Object.defineProperty(e,"xmlFileToJsonObject",{enumerable:!0,get:function(){return F.xmlFileToJsonObject}}),Object.defineProperty(e,"xmlStreamToJsonObject",{enumerable:!0,get:function(){return F.xmlStreamToJsonObject}}),Object.defineProperty(e,"xmlDocumentToJsonObject",{enumerable:!0,get:function(){return F.xmlDocumentToJsonObject}}),Object.defineProperty(e,"xmlStringToJsonFile",{enumerable:!0,get:function(){return F.xmlStringToJsonFile}}),Object.defineProperty(e,"xmlFileToJsonFile",{enumerable:!0,get:function(){return F.xmlFileToJsonFile}}),Object.defineProperty(e,"xmlStreamToJsonFile",{enumerable:!0,get:function(){return F.xmlStreamToJsonFile}}),Object.defineProperty(e,"xmlDocumentToJsonFile",{enumerable:!0,get:function(){return F.xmlDocumentToJsonFile}}),Object.defineProperty(e,"jsonObjectToXmlDocument",{enumerable:!0,get:function(){return F.jsonObjectToXmlDocument}}),Object.defineProperty(e,"jsonStringToXmlDocument",{enumerable:!0,get:function(){return F.jsonStringToXmlDocument}}),Object.defineProperty(e,"jsonFileToXmlDocument",{enumerable:!0,get:function(){return F.jsonFileToXmlDocument}}),Object.defineProperty(e,"jsonStreamToXmlDocument",{enumerable:!0,get:function(){return F.jsonStreamToXmlDocument}}),Object.defineProperty(e,"jsonObjectToXmlFile",{enumerable:!0,get:function(){return F.jsonObjectToXmlFile}}),Object.defineProperty(e,"jsonStringToXmlFile",{enumerable:!0,get:function(){return F.jsonStringToXmlFile}}),Object.defineProperty(e,"jsonFileToXmlFile",{enumerable:!0,get:function(){return F.jsonFileToXmlFile}}),Object.defineProperty(e,"jsonStreamToXmlFile",{enumerable:!0,get:function(){return F.jsonStreamToXmlFile}})},1276(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.xmlStringToJsonObject=g,e.xmlFileToJsonObject=async function(t,e){const n=e?.mode??"simple",r=e?.encoding??"utf8",s=await(0,i.readFile)(t,{encoding:r});return"roundtrip"===n?g(s,{mode:"roundtrip"}):g(s)},e.xmlStreamToJsonObject=async function(t,e){const{mode:n="simple",...i}=e??{},r=await N(t,i);return"roundtrip"===n?b(r,{mode:"roundtrip"}):b(r)},e.xmlDocumentToJsonObject=b,e.xmlStringToJsonFile=async function(t,e,n,r=2,s="utf8"){const a=g(t,n),o=JSON.stringify(a,null,r);await(0,i.writeFile)(e,o,{encoding:s})},e.xmlFileToJsonFile=async function(t,e,n="utf8",r=2,s="utf8",a){const o=await async function(t,e="utf8"){return D(await(0,i.readFile)(t,{encoding:e}))}(t,n);await E(o,e,r,s,a)},e.xmlStreamToJsonFile=async function(t,e,n,i=2,r="utf8"){const{mode:s="simple",...a}=n??{},o=await N(t,a);"roundtrip"===s?await E(o,e,i,r,{mode:"roundtrip"}):await E(o,e,i,r)},e.xmlDocumentToJsonFile=E,e.jsonObjectToXmlDocument=y,e.jsonStringToXmlDocument=v,e.jsonFileToXmlDocument=w,e.jsonStreamToXmlDocument=x,e.jsonObjectToXmlFile=async function(t,e,n="json",r="utf8"){const s=y(t,n);await(0,i.writeFile)(e,s.toString(),{encoding:r})},e.jsonStringToXmlFile=async function(t,e,n="json",r="utf8"){const s=v(t,n);await(0,i.writeFile)(e,s.toString(),{encoding:r})},e.jsonFileToXmlFile=async function(t,e,n="json",r="utf8",s="utf8"){const a=await w(t,n,r);await(0,i.writeFile)(e,a.toString(),{encoding:s})},e.jsonStreamToXmlFile=async function(t,e,n="json",r="utf8",s="utf8"){const a=await x(t,n,r);await(0,i.writeFile)(e,a.toString(),{encoding:s})};const i=n(1455),r=n(1882),s=n(9350),a=n(6245),o=n(2714),l=n(2966),c=n(9850),h=n(112),u=n(7871),d=n(2192),f=n(9162),m=n(3429),p=new Set(["_attributes","_text","_cdata","_comments","_processingInstructions","_content"]);function g(t,e){const{mode:n="simple",...i}=e??{},r=D(t,i);return"roundtrip"===n?b(r,{mode:"roundtrip"}):b(r)}function b(t,e){const n=t.getRoot();if(!n)throw new Error("XML document does not contain a root element");const i=e?.mode??"simple",r=M(n,{includeOrderedContent:"roundtrip"===i});if("roundtrip"!==i)return r;const s={rootName:n.getName(),root:r},a=t.getXmlDeclaration();if(a){const t={};a.getVersion()&&(t.version=a.getVersion()),a.getEncoding()&&(t.encoding=a.getEncoding());const e=a.getStandalone();void 0!==e&&(t.standalone=e),Object.keys(t).length>0&&(s.declaration=t)}const l=t.getDocumentType();if(l){const t={name:l.name},e=l.getPublicId();e&&(t.publicId=e);const n=l.getSystemId();n&&(t.systemId=n);const i=l.getInternalSubset();i&&(t.internalSubset=i),s.doctype=t}const h=[],p=[];let g=!1,b=!1;for(const e of t.contentIterator())if(!(e instanceof f.XMLDeclaration))if(e instanceof m.XMLDocumentType)b=!0;else if(e instanceof o.XMLElement)g||(g=!0);else if(e instanceof u.XMLComment)if(g){const t={type:"comment",value:e.getValue()};p.push(t)}else{const t={type:"comment",value:e.getValue()};b&&(t.afterDoctype=!0),h.push(t)}else{if(e instanceof d.ProcessingInstruction){const t=e.getData(),n={type:"processingInstruction",target:e.getTarget()};if(t&&t.length>0&&(n.data=t),g)p.push(n);else{const t={...n};b&&(t.afterDoctype=!0),h.push(t)}continue}if(e instanceof c.TextNode){const t={type:"text",value:e.getValue()};if(g)p.push(t);else{const e={...t};b&&(e.afterDoctype=!0),h.push(e)}}}return h.length>0&&(s.prolog=h),p.length>0&&(s.epilog=p),s}async function E(t,e,n=2,r="utf8",s){const a=b(t,s),o=JSON.stringify(a,null,n);await(0,i.writeFile)(e,o,{encoding:r})}function y(t,e){return function(t){if(!t||"object"!=typeof t)return!1;const e=t;return"string"==typeof e.rootName&&void 0!==e.root}(t)?function(t){const e=new a.XMLDocument;if(t.declaration){const n=t.declaration.version??"1.0",i=t.declaration.encoding??"utf-8",r=new f.XMLDeclaration(n,i,t.declaration.standalone);e.setXmlDeclaration(r)}const n=t.prolog??[];for(const t of n)t.afterDoctype||T(e,t);if(t.doctype){const n=t.doctype.publicId??"",i=t.doctype.systemId??"",r=new m.XMLDocumentType(t.doctype.name,n,i);t.doctype.internalSubset&&r.setInternalSubset(t.doctype.internalSubset),e.setDocumentType(r)}for(const t of n)t.afterDoctype&&T(e,t);const i=A(t.rootName,t.root,t.rootName);if(e.setRoot(i),t.epilog)for(const n of t.epilog)T(e,n);return e}(t):function(t,e){const n=new a.XMLDocument,i=A(e,t,e);return n.setRoot(i),n}(t,void 0!==e?e:function(t){if(null==t)return;if(Array.isArray(t))return;if("object"!=typeof t)return;const e=t,n=Object.keys(e).filter(t=>!p.has(t));return 1===n.length?n[0]:void 0}(t)??"json")}function v(t,e="json"){return y(JSON.parse(t),e)}async function w(t,e="json",n="utf8"){return v(await(0,i.readFile)(t,{encoding:n}),e)}async function x(t,e="json",n="utf8"){const i=await async function(t,e){return new Promise((n,i)=>{const r=new Array;t.setEncoding(e),t.on("data",t=>{r.push(t)}),t.once("error",i),t.once("end",()=>{n(r.join(""))})})}(t,n);return v(i,e)}function D(t,e){const n=new r.DOMBuilder;n.initialize();const i=new s.SAXParser;i.setContentHandler(n),i.parseString(t,e);const a=n.getDocument();if(!a)throw new Error("Unable to parse XML string");return a}async function N(t,e){const n=new r.DOMBuilder;n.initialize();const i=new s.SAXParser;i.setContentHandler(n),await i.parseStream(t,e);const a=n.getDocument();if(!a)throw new Error("Unable to parse XML stream");return a}function M(t,e){const n=t.getAttributes(),i=new Map,r=new Array,s=new Array,a=new Array,l=new Array,f=e.includeOrderedContent?new Array:void 0,m=e.includeOrderedContent?new Map:void 0;for(const n of t.getContent()){if(n instanceof o.XMLElement){const t=n.getName(),r=M(n,e);let s=i.get(t);if(s||(s=new Array,i.set(t,s)),s.push(r),f&&m){const e=m.get(t)??0;m.set(t,e+1),f.push({kind:"element",name:t,occurrence:e})}continue}if(n instanceof c.TextNode)r.push(n.getValue()),f&&f.push({kind:"text",value:n.getValue()});else if(n instanceof h.CData)s.push(n.getValue()),f&&f.push({kind:"cdata",value:n.getValue()});else if(n instanceof u.XMLComment)a.push(n.getValue()),f&&f.push({kind:"comment",value:n.getValue()});else if(n instanceof d.ProcessingInstruction){const t={target:n.getTarget()},e=n.getData();e&&e.length>0&&(t.data=e),l.push(t),f&&f.push({kind:"processingInstruction",target:n.getTarget(),data:e})}}const p=i.size>0,g=r.join(""),b=r.length>0&&(!p||r.some(t=>t.trim().length>0)),E=n.length>0,y=s.length>0,v=a.length>0,w=l.length>0;if(!(E||p||y||v||w))return b?g:"";if(!(E||v||w||y||b||1!==i.size)){const[e,n]=[...i.entries()][0];if(e===P(t.getName()))return n}const x={};if(E){const t={};for(const e of n)t[e.getName()]=e.getValue();x._attributes=t}b&&(x._text=g),y&&(x._cdata=1===s.length?s[0]:s),v&&(x._comments=1===a.length?a[0]:a),w&&(x._processingInstructions=l);for(const[t,e]of i.entries())1===e.length?x[t]=e[0]:x[t]=e;if(f&&f.length>0){const t=f.map(t=>"element"===t.kind?`element:${t.name}:${t.occurrence}`:t.kind),e=new Array;if(b&&e.push("text"),y)for(let t=0;t<s.length;t++)e.push("cdata");if(v)for(let t=0;t<a.length;t++)e.push("comment");if(w)for(let t=0;t<l.length;t++)e.push("processingInstruction");for(const[t,n]of i.entries())for(let i=0;i<n.length;i++)e.push(`element:${t}:${i}`);(t.length!==e.length||t.some((t,n)=>t!==e[n]))&&(x._content=f)}return E||b||y||v||w||0!==i.size?x:""}function T(t,e){if("comment"===e.type)t.addComment(new u.XMLComment(e.value));else if("processingInstruction"===e.type){const n=e.data??"";t.addProcessingInstruction(new d.ProcessingInstruction(e.target,n))}else t.addTextNode(new c.TextNode(e.value))}function A(t,e,n){const i=new o.XMLElement(t);if(null==e)return i;if(Array.isArray(e)){const t=P(n);for(const n of e){const e=A(t,n,t);i.addElement(e)}return 0===e.length&&i.addString(""),i}if("string"==typeof e)return e.length>0&&i.addString(e),i;if("number"==typeof e||"boolean"==typeof e)return i.addString(String(e)),i;const r=e;if(r._attributes)for(const[t,e]of Object.entries(r._attributes))null!=e&&i.setAttribute(new l.XMLAttribute(t,String(e)));if(r._content&&r._content.length>0)return function(t,e,n){const i=new Map;for(const r of n)switch(r.kind){case"text":t.addTextNode(new c.TextNode(r.value));break;case"cdata":t.addCData(new h.CData(r.value));break;case"comment":t.addComment(new u.XMLComment(r.value));break;case"processingInstruction":{const e=r.data??"";t.addProcessingInstruction(new d.ProcessingInstruction(r.target,e));break}case"element":{const n=C(e,r.name,i)[r.occurrence];if(void 0===n)break;const s=A(r.name,n,r.name);t.addElement(s);break}}}(i,r,r._content),i;if(void 0!==r._text&&r._text.length>0&&i.addString(r._text),void 0!==r._cdata){const t=S(r._cdata);for(const e of t)i.addCData(new h.CData(e))}if(void 0!==r._comments){const t=S(r._comments);for(const e of t)i.addComment(new u.XMLComment(e))}if(r._processingInstructions)for(const t of r._processingInstructions){const e=t.data??"";i.addProcessingInstruction(new d.ProcessingInstruction(t.target,e))}for(const[t,e]of Object.entries(r))if(!p.has(t)&&void 0!==e)if(Array.isArray(e))for(const n of e){const e=A(t,n,t);i.addElement(e)}else{const n=A(t,e,t);i.addElement(n)}return i}function C(t,e,n){let i=n.get(e);if(!i){const r=t[e];i=void 0===r?[]:Array.isArray(r)?r.length>0&&"object"==typeof r[0]&&null!==r[0]&&"kind"in r[0]?[]:r:[r],n.set(e,i)}return i}function S(t){return Array.isArray(t)?t:[t]}function P(t){return t.length>3&&t.endsWith("ies")?t.substring(0,t.length-3)+"y":t.length>1&&t.endsWith("s")?t.substring(0,t.length-1):"item"}},1398(t){"use strict";t.exports=require("vscode")},6982(t){"use strict";t.exports=require("crypto")},3024(t){"use strict";t.exports=require("node:fs")},1455(t){"use strict";t.exports=require("node:fs/promises")},6760(t){"use strict";t.exports=require("node:path")},3136(t){"use strict";t.exports=require("node:url")},7975(t){"use strict";t.exports=require("node:util")},6928(t){"use strict";t.exports=require("path")}},e={},n=function n(i){var r=e[i];if(void 0!==r)return r.exports;var s=e[i]={exports:{}};return t[i].call(s.exports,s,s.exports,n),s.exports}(4265);module.exports=n})();